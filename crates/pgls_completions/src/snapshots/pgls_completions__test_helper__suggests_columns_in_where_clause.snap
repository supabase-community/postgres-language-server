---
source: crates/pgls_completions/src/test_helper.rs
expression: final_snapshot
---
***Setup***

create table instruments (
    id bigint primary key generated always as identity,
    name text not null,
    z text, 
    created_at timestamp with time zone default now()
);

create table others (
    a text,
    b text,
    c text
);


--------------

select name from instruments i join others o on i.z = o.a |
select name from instruments i join others o on i.z = o.a w|

Results:
wait_event - pg_catalog.pg_stat_activity.wait_event (Column)
wait_event_type - pg_catalog.pg_stat_activity.wait_event_type (Column)
waitstart - pg_catalog.pg_locks.waitstart (Column)
wal_buffers_full - pg_catalog.pg_stat_wal.wal_buffers_full (Column)
wal_bytes - pg_catalog.pg_stat_wal.wal_bytes (Column)

--------------

select name from instruments i join others o on i.z = o.a where |

Results:
o.a - public.others.a (Column)
o.b - public.others.b (Column)
o.c - public.others.c (Column)
i.created_at - public.instruments.created_at (Column)
i.id - public.instruments.id (Column)

--------------

select name from instruments i join others o on i.z = o.a where o.|
**should respect alias speciifcation**

Results:
a - public.others.a (Column)
b - public.others.b (Column)
c - public.others.c (Column)

--------------

select name from instruments i join others o on i.z = o.a where o.a |
select name from instruments i join others o on i.z = o.a where o.a = |
**should not prioritize suggest columns or schemas (right side of binary expression)**

Results:
instruments - public.instruments (Table)
others - public.others (Table)
_sqlx_migrations - public._sqlx_migrations (Table)
information_schema - information_schema (Schema)
pg_catalog - pg_catalog (Schema)

--------------

select name from instruments i join others o on i.z = o.a where o.a = i.|
select name from instruments i join others o on i.z = o.a where o.a = i.z |
select name from instruments i join others o on i.z = o.a where o.a = i.z a|

Results:
information_schema.administrable_role_authorizations - information_schema.administrable_role_authorizations (Table)
information_schema.applicable_roles - information_schema.applicable_roles (Table)
information_schema.attributes - information_schema.attributes (Table)
information_schema.collation_character_set_applicability - information_schema.collation_character_set_applicability (Table)
pg_catalog.pg_aggregate - pg_catalog.pg_aggregate (Table)

--------------

select name from instruments i join others o on i.z = o.a where o.a = i.z and |
**should prioritize columns that aren't already mentioned**

Results:
o.b - public.others.b (Column)
o.c - public.others.c (Column)
i.created_at - public.instruments.created_at (Column)
i.id - public.instruments.id (Column)
i.name - public.instruments.name (Column)

--------------

select name from instruments i join others o on i.z = o.a where o.a = i.z and i.|
select name from instruments i join others o on i.z = o.a where o.a = i.z and i.i|
select name from instruments i join others o on i.z = o.a where o.a = i.z and i.id |
select name from instruments i join others o on i.z = o.a where o.a = i.z and i.id > |

Results:
instruments - public.instruments (Table)
others - public.others (Table)
_sqlx_migrations - public._sqlx_migrations (Table)
information_schema - information_schema (Schema)
pg_catalog - pg_catalog (Schema)

--------------

select name from instruments i join others o on i.z = o.a where o.a = i.z and i.id > 5|
select name from instruments i join others o on i.z = o.a where o.a = i.z and i.id > 5; |
