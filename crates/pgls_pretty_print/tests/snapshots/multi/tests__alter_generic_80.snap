---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/alter_generic.sql
snapshot_kind: text
---
create function test_opclass_options_func(internal)
returns VOID
as 'regresslib', 'test_opclass_options_func'
language "c";

set client_min_messages = warning;

drop role if exists regress_alter_generic_user1;

drop role if exists regress_alter_generic_user2;

drop role if exists regress_alter_generic_user3;

reset client_min_messages;

create user regress_alter_generic_user3;

create user regress_alter_generic_user2;

create user regress_alter_generic_user1 in role regress_alter_generic_user3;

create schema "alt_nsp1";

create schema "alt_nsp2";

grant all on schema alt_nsp1, alt_nsp2 to PUBLIC;

set search_path to alt_nsp1, public;

set session authorization regress_alter_generic_user1;

create function alt_func1(INT)
returns INT
language "sql"
as 'SELECT $1 + 1';

create function alt_func2(INT)
returns INT
language "sql"
as 'SELECT $1 - 1';

create aggregate alt_agg1 (
  sfunc1 = int4pl,
  basetype = INT,
  stype1 = INT,
  initcond = 0
);

create aggregate alt_agg2 (
  sfunc1 = int4mi,
  basetype = INT,
  stype1 = INT,
  initcond = 0
);

alter aggregate alt_func1(INT) rename to alt_func3;

alter aggregate alt_func1(INT) owner to regress_alter_generic_user3;

alter AGGREGATE alt_func1(INT) set SCHEMA alt_nsp2;

alter function alt_func1(INT) rename to alt_func2;

alter function alt_func1(INT) rename to alt_func3;

alter function alt_func2(INT) owner to regress_alter_generic_user2;

alter function alt_func2(INT) owner to regress_alter_generic_user3;

alter FUNCTION alt_func2(INT) set SCHEMA alt_nsp1;

alter FUNCTION alt_func2(INT) set SCHEMA alt_nsp2;

alter aggregate alt_agg1(INT) rename to alt_agg2;

alter aggregate alt_agg1(INT) rename to alt_agg3;

alter aggregate alt_agg2(INT) owner to regress_alter_generic_user2;

alter aggregate alt_agg2(INT) owner to regress_alter_generic_user3;

alter AGGREGATE alt_agg2(INT) set SCHEMA alt_nsp2;

set session authorization regress_alter_generic_user2;

create function alt_func1(INT)
returns INT
language "sql"
as 'SELECT $1 + 2';

create function alt_func2(INT)
returns INT
language "sql"
as 'SELECT $1 - 2';

create aggregate alt_agg1 (
  sfunc1 = int4pl,
  basetype = INT,
  stype1 = INT,
  initcond = 100
);

create aggregate alt_agg2 (
  sfunc1 = int4mi,
  basetype = INT,
  stype1 = INT,
  initcond = -100
);

alter function alt_func3(INT) rename to alt_func4;

alter function alt_func1(INT) rename to alt_func4;

alter function alt_func3(INT) owner to regress_alter_generic_user2;

alter function alt_func2(INT) owner to regress_alter_generic_user3;

alter FUNCTION alt_func3(INT) set SCHEMA alt_nsp2;

alter FUNCTION alt_func2(INT) set SCHEMA alt_nsp2;

alter aggregate alt_agg3(INT) rename to alt_agg4;

alter aggregate alt_agg1(INT) rename to alt_agg4;

alter aggregate alt_agg3(INT) owner to regress_alter_generic_user2;

alter aggregate alt_agg2(INT) owner to regress_alter_generic_user3;

alter AGGREGATE alt_agg3(INT) set SCHEMA alt_nsp2;

alter AGGREGATE alt_agg2(INT) set SCHEMA alt_nsp2;

reset session_authorization;

select
  n.nspname,
  proname,
  cast(prorettype as REGTYPE),
  prokind,
  a.rolname
from
  pg_proc as p,
  pg_namespace as n,
  pg_authid as a
where
  p.pronamespace = n.oid and
  p.proowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  proname;

set session authorization regress_alter_generic_user1;

create conversion alt_conv1 for 'LATIN1' to 'UTF8' from iso8859_1_to_utf8;

create conversion alt_conv2 for 'LATIN1' to 'UTF8' from iso8859_1_to_utf8;

alter conversion alt_conv1 rename to alt_conv2;

alter conversion alt_conv1 rename to alt_conv3;

alter conversion alt_conv2 owner to regress_alter_generic_user2;

alter conversion alt_conv2 owner to regress_alter_generic_user3;

alter CONVERSION alt_conv2 set SCHEMA alt_nsp2;

set session authorization regress_alter_generic_user2;

create conversion alt_conv1 for 'LATIN1' to 'UTF8' from iso8859_1_to_utf8;

create conversion alt_conv2 for 'LATIN1' to 'UTF8' from iso8859_1_to_utf8;

alter conversion alt_conv3 rename to alt_conv4;

alter conversion alt_conv1 rename to alt_conv4;

alter conversion alt_conv3 owner to regress_alter_generic_user2;

alter conversion alt_conv2 owner to regress_alter_generic_user3;

alter CONVERSION alt_conv3 set SCHEMA alt_nsp2;

alter CONVERSION alt_conv2 set SCHEMA alt_nsp2;

reset session_authorization;

select
  n.nspname,
  c.conname,
  a.rolname
from
  pg_conversion as c,
  pg_namespace as n,
  pg_authid as a
where
  c.connamespace = n.oid and
  c.conowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  conname;

create FOREIGN DATA WRAPPER alt_fdw1;

create FOREIGN DATA WRAPPER alt_fdw2;

create server alt_fserv1 foreign data wrapper alt_fdw1;

create server alt_fserv2 foreign data wrapper alt_fdw2;

alter foreign data wrapper alt_fdw1 rename to alt_fdw2;

alter foreign data wrapper alt_fdw1 rename to alt_fdw3;

alter server alt_fserv1 rename to alt_fserv2;

alter server alt_fserv1 rename to alt_fserv3;

select fdwname from pg_foreign_data_wrapper where fdwname like 'alt_fdw%';

select srvname from pg_foreign_server where srvname like 'alt_fserv%';

create LANGUAGE alt_lang1 HANDLER plpgsql_call_handler;

create LANGUAGE alt_lang2 HANDLER plpgsql_call_handler;

alter language alt_lang1 owner to regress_alter_generic_user1;

alter language alt_lang2 owner to regress_alter_generic_user2;

set session authorization regress_alter_generic_user1;

alter language alt_lang1 rename to alt_lang2;

alter language alt_lang2 rename to alt_lang3;

alter language alt_lang1 rename to alt_lang3;

alter language alt_lang2 owner to regress_alter_generic_user3;

alter language alt_lang3 owner to regress_alter_generic_user2;

alter language alt_lang3 owner to regress_alter_generic_user3;

reset session_authorization;

select
  lanname,
  a.rolname
from
  pg_language as l,
  pg_authid as a
where
  l.lanowner = a.oid and
  l.lanname like 'alt_lang%'
order by lanname;

set session authorization regress_alter_generic_user1;

create operator @-@ (LEFTARG = INT, RIGHTARG = INT, PROCEDURE = int4mi);

create operator @+@ (LEFTARG = INT, RIGHTARG = INT, PROCEDURE = int4pl);

alter operator @+@ (INT, INT) owner to regress_alter_generic_user2;

alter operator @+@ (INT, INT) owner to regress_alter_generic_user3;

alter OPERATOR @-@ (INT, INT) set SCHEMA alt_nsp2;

set session authorization regress_alter_generic_user2;

create operator @-@ (LEFTARG = INT, RIGHTARG = INT, PROCEDURE = int4mi);

alter operator @+@ (INT, INT) owner to regress_alter_generic_user2;

alter operator @-@ (INT, INT) owner to regress_alter_generic_user3;

alter OPERATOR @+@ (INT, INT) set SCHEMA alt_nsp2;

reset session_authorization;

select
  n.nspname,
  oprname,
  a.rolname,
  cast(oprleft as REGTYPE),
  cast(oprright as REGTYPE),
  cast(oprcode as REGPROC)
from
  pg_operator as o,
  pg_namespace as n,
  pg_authid as a
where
  o.oprnamespace = n.oid and
  o.oprowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  oprname;

create OPERATOR FAMILY alt_opf1 using hash;

create OPERATOR FAMILY alt_opf2 using hash;

alter operator family alt_opf1 using hash owner to regress_alter_generic_user1;

alter operator family alt_opf2 using hash owner to regress_alter_generic_user1;

create OPERATOR class alt_opc1 for type UUID using hash as STORAGE UUID;

create OPERATOR class alt_opc2 for type UUID using hash as STORAGE UUID;

alter operator class alt_opc1 using hash owner to regress_alter_generic_user1;

alter operator class alt_opc2 using hash owner to regress_alter_generic_user1;

set session authorization regress_alter_generic_user1;

alter operator family alt_opf1 using hash rename to alt_opf2;

alter operator family alt_opf1 using hash rename to alt_opf3;

alter operator family alt_opf2 using hash owner to regress_alter_generic_user2;

alter operator family alt_opf2 using hash owner to regress_alter_generic_user3;

alter OPERATOR FAMILY alt_opf2 using hash set SCHEMA alt_nsp2;

alter operator class alt_opc1 using hash rename to alt_opc2;

alter operator class alt_opc1 using hash rename to alt_opc3;

alter operator class alt_opc2 using hash owner to regress_alter_generic_user2;

alter operator class alt_opc2 using hash owner to regress_alter_generic_user3;

alter OPERATOR CLASS alt_opc2 using hash set SCHEMA alt_nsp2;

reset session_authorization;

create OPERATOR FAMILY alt_opf1 using hash;

create OPERATOR FAMILY alt_opf2 using hash;

alter operator family alt_opf1 using hash owner to regress_alter_generic_user2;

alter operator family alt_opf2 using hash owner to regress_alter_generic_user2;

create OPERATOR class alt_opc1 for type MACADDR using hash as STORAGE MACADDR;

create OPERATOR class alt_opc2 for type MACADDR using hash as STORAGE MACADDR;

alter operator class alt_opc1 using hash owner to regress_alter_generic_user2;

alter operator class alt_opc2 using hash owner to regress_alter_generic_user2;

set session authorization regress_alter_generic_user2;

alter operator family alt_opf3 using hash rename to alt_opf4;

alter operator family alt_opf1 using hash rename to alt_opf4;

alter operator family alt_opf3 using hash owner to regress_alter_generic_user2;

alter operator family alt_opf2 using hash owner to regress_alter_generic_user3;

alter OPERATOR FAMILY alt_opf3 using hash set SCHEMA alt_nsp2;

alter OPERATOR FAMILY alt_opf2 using hash set SCHEMA alt_nsp2;

alter operator class alt_opc3 using hash rename to alt_opc4;

alter operator class alt_opc1 using hash rename to alt_opc4;

alter operator class alt_opc3 using hash owner to regress_alter_generic_user2;

alter operator class alt_opc2 using hash owner to regress_alter_generic_user3;

alter OPERATOR CLASS alt_opc3 using hash set SCHEMA alt_nsp2;

alter OPERATOR CLASS alt_opc2 using hash set SCHEMA alt_nsp2;

reset session_authorization;

select
  nspname,
  opfname,
  amname,
  rolname
from
  pg_opfamily as o,
  pg_am as m,
  pg_namespace as n,
  pg_authid as a
where
  o.opfmethod = m.oid and
  o.opfnamespace = n.oid and
  o.opfowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2') and
  not opfname like 'alt_opc%'
order by nspname,
  opfname;

select
  nspname,
  opcname,
  amname,
  rolname
from
  pg_opclass as o,
  pg_am as m,
  pg_namespace as n,
  pg_authid as a
where
  o.opcmethod = m.oid and
  o.opcnamespace = n.oid and
  o.opcowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  opcname;

begin;

create OPERATOR FAMILY alt_opf4 using btree;

alter OPERATOR FAMILY alt_opf4 USING btree
  add OPERATOR 1 < (INT, SMALLINT),
  OPERATOR 2 <= (INT, SMALLINT),
  OPERATOR 3 = (INT, SMALLINT),
  OPERATOR 4 >= (INT, SMALLINT),
  OPERATOR 5 > (INT, SMALLINT),
  FUNCTION 1 btint42cmp(INT, SMALLINT);

alter OPERATOR FAMILY alt_opf4 USING btree
  drop OPERATOR 1 (INT, SMALLINT),
  OPERATOR 2 (INT, SMALLINT),
  OPERATOR 3 (INT, SMALLINT),
  OPERATOR 4 (INT, SMALLINT),
  OPERATOR 5 (INT, SMALLINT),
  FUNCTION 1 (INT, SMALLINT);

drop OPERATOR FAMILY "alt_opf4" USING "btree";

rollback;

create OPERATOR FAMILY alt_opf4 using btree;

alter OPERATOR FAMILY alt_opf4 USING invalid_index_method
  add OPERATOR 1 < (INT, SMALLINT);

alter OPERATOR FAMILY alt_opf4 USING btree add OPERATOR 6 < (INT, SMALLINT);

alter OPERATOR FAMILY alt_opf4 USING btree add OPERATOR 0 < (INT, SMALLINT);

alter OPERATOR FAMILY alt_opf4 USING btree add OPERATOR 1 <;

alter OPERATOR FAMILY alt_opf4 USING btree
  add FUNCTION 0 btint42cmp(INT, SMALLINT);

alter OPERATOR FAMILY alt_opf4 USING btree
  add FUNCTION 7 btint42cmp(INT, SMALLINT);

alter OPERATOR FAMILY alt_opf4 USING btree add STORAGE invalid_storage;

drop OPERATOR FAMILY "alt_opf4" USING "btree";

begin;

create role regress_alter_generic_user5 NOSUPERUSER;

create OPERATOR FAMILY alt_opf5 using btree;

set role to regress_alter_generic_user5;

alter OPERATOR FAMILY alt_opf5 USING btree
  add OPERATOR 1 < (INT, SMALLINT),
  FUNCTION 1 btint42cmp(INT, SMALLINT);

reset role;

drop OPERATOR FAMILY "alt_opf5" USING "btree";

rollback;

begin;

create role regress_alter_generic_user6;

create schema "alt_nsp6";

revoke all on schema alt_nsp6 from regress_alter_generic_user6;

create OPERATOR FAMILY alt_nsp6.alt_opf6 using btree;

set role to regress_alter_generic_user6;

alter OPERATOR FAMILY alt_nsp6.alt_opf6 USING btree
  add OPERATOR 1 < (INT, SMALLINT);

rollback;

create OPERATOR FAMILY alt_opf7 using btree;

alter OPERATOR FAMILY alt_opf7 USING btree add OPERATOR 1 < (INT, SMALLINT);

alter OPERATOR FAMILY alt_opf7 USING btree
  drop OPERATOR 1 (INT, SMALLINT, BIGINT);

drop OPERATOR FAMILY "alt_opf7" USING "btree";

create OPERATOR FAMILY alt_opf8 using btree;

alter OPERATOR FAMILY alt_opf8 USING btree add OPERATOR 1 < (INT, INT);

drop OPERATOR FAMILY "alt_opf8" USING "btree";

create OPERATOR FAMILY alt_opf9 using gist;

alter OPERATOR FAMILY alt_opf9 USING gist
  add OPERATOR 1 < (INT, INT) for order by float_ops;

drop OPERATOR FAMILY "alt_opf9" USING "gist";

create OPERATOR FAMILY alt_opf10 using btree;

alter OPERATOR FAMILY alt_opf10 USING btree
  add OPERATOR 1 < (INT, INT) for order by float_ops;

drop OPERATOR FAMILY "alt_opf10" USING "btree";

create OPERATOR FAMILY alt_opf11 using gist;

alter OPERATOR FAMILY alt_opf11 USING gist
  add OPERATOR 1 < (INT, INT) for order by float_ops;

alter OPERATOR FAMILY alt_opf11 USING gist drop OPERATOR 1 (INT, INT);

drop OPERATOR FAMILY "alt_opf11" USING "gist";

begin;

create OPERATOR FAMILY alt_opf12 using btree;

create function fn_opf12(INT, SMALLINT)
returns BIGINT
as 'SELECT NULL::BIGINT;'
language "sql";

alter OPERATOR FAMILY alt_opf12 USING btree
  add FUNCTION 1 fn_opf12(INT, SMALLINT);

drop OPERATOR FAMILY "alt_opf12" USING "btree";

rollback;

begin;

create OPERATOR FAMILY alt_opf13 using hash;

create function fn_opf13(INT)
returns BIGINT
as 'SELECT NULL::BIGINT;'
language "sql";

alter OPERATOR FAMILY alt_opf13 USING hash add FUNCTION 1 fn_opf13(INT);

drop OPERATOR FAMILY "alt_opf13" USING "hash";

rollback;

begin;

create OPERATOR FAMILY alt_opf14 using btree;

create function fn_opf14(INT)
returns BIGINT
as 'SELECT NULL::BIGINT;'
language "sql";

alter OPERATOR FAMILY alt_opf14 USING btree add FUNCTION 1 fn_opf14(INT);

drop OPERATOR FAMILY "alt_opf14" USING "btree";

rollback;

begin;

create OPERATOR FAMILY alt_opf15 using hash;

create function fn_opf15(INT, SMALLINT)
returns BIGINT
as 'SELECT NULL::BIGINT;'
language "sql";

alter OPERATOR FAMILY alt_opf15 USING hash
  add FUNCTION 1 fn_opf15(INT, SMALLINT);

drop OPERATOR FAMILY "alt_opf15" USING "hash";

rollback;

create OPERATOR FAMILY alt_opf16 using gist;

alter OPERATOR FAMILY alt_opf16 USING gist
  add FUNCTION 1 btint42cmp(INT, SMALLINT);

drop OPERATOR FAMILY "alt_opf16" USING "gist";

create OPERATOR FAMILY alt_opf17 using btree;

alter OPERATOR FAMILY alt_opf17 USING btree
  add OPERATOR 1 < (INT, INT),
  OPERATOR 1 < (INT, INT);

alter OPERATOR FAMILY alt_opf17 USING btree add OPERATOR 1 < (INT, INT);

alter OPERATOR FAMILY alt_opf17 USING btree add OPERATOR 1 < (INT, INT);

alter OPERATOR FAMILY alt_opf17 USING btree
  add OPERATOR 1 < (INT, SMALLINT),
  OPERATOR 2 <= (INT, SMALLINT),
  OPERATOR 3 = (INT, SMALLINT),
  OPERATOR 4 >= (INT, SMALLINT),
  OPERATOR 5 > (INT, SMALLINT),
  FUNCTION 1 btint42cmp(INT, SMALLINT),
  FUNCTION 1 btint42cmp(INT, SMALLINT);

alter OPERATOR FAMILY alt_opf17 USING btree
  add OPERATOR 1 < (INT, SMALLINT),
  OPERATOR 2 <= (INT, SMALLINT),
  OPERATOR 3 = (INT, SMALLINT),
  OPERATOR 4 >= (INT, SMALLINT),
  OPERATOR 5 > (INT, SMALLINT),
  FUNCTION 1 btint42cmp(INT, SMALLINT);

alter OPERATOR FAMILY alt_opf17 USING btree
  add OPERATOR 1 < (INT, SMALLINT),
  OPERATOR 2 <= (INT, SMALLINT),
  OPERATOR 3 = (INT, SMALLINT),
  OPERATOR 4 >= (INT, SMALLINT),
  OPERATOR 5 > (INT, SMALLINT),
  FUNCTION 1 btint42cmp(INT, SMALLINT);

drop OPERATOR FAMILY "alt_opf17" USING "btree";

create OPERATOR FAMILY alt_opf18 using btree;

alter OPERATOR FAMILY alt_opf18 USING btree drop OPERATOR 1 (INT, INT);

alter OPERATOR FAMILY alt_opf18 USING btree
  add OPERATOR 1 < (INT, SMALLINT),
  OPERATOR 2 <= (INT, SMALLINT),
  OPERATOR 3 = (INT, SMALLINT),
  OPERATOR 4 >= (INT, SMALLINT),
  OPERATOR 5 > (INT, SMALLINT),
  FUNCTION 1 btint42cmp(INT, SMALLINT);

alter OPERATOR FAMILY alt_opf18 USING btree
  add FUNCTION 4 (INT,
  SMALLINT) btequalimage(OID);

alter OPERATOR FAMILY alt_opf18 USING btree
  add FUNCTION 6 (INT,
  SMALLINT) btint4skipsupport(internal);

alter OPERATOR FAMILY alt_opf18 USING btree drop FUNCTION 2 (INT, INT);

drop OPERATOR FAMILY "alt_opf18" USING "btree";

create OPERATOR FAMILY alt_opf19 using btree;

alter OPERATOR FAMILY alt_opf19 USING btree
  add FUNCTION 5 test_opclass_options_func(
    internal,
    TEXT[],
    BOOLEAN);

alter OPERATOR FAMILY alt_opf19 USING btree
  add FUNCTION 5 (INT) btint42cmp(INT, SMALLINT);

alter OPERATOR FAMILY alt_opf19 USING btree
  add FUNCTION 5 (INT,
  SMALLINT) btint42cmp(INT, SMALLINT);

alter OPERATOR FAMILY alt_opf19 USING btree
  add FUNCTION 5 (INT) test_opclass_options_func(internal);

alter OPERATOR FAMILY alt_opf19 USING btree drop FUNCTION 5 (INT, INT);

drop OPERATOR FAMILY "alt_opf19" USING "btree";

set session authorization regress_alter_generic_user1;

create table alt_regress_1 (
  a INT,
  b INT
);

create STATISTICS alt_stat1 on "a", "b" from alt_regress_1;

create STATISTICS alt_stat2 on "a", "b" from alt_regress_1;

alter statistics alt_stat1 rename to alt_stat2;

alter statistics alt_stat1 rename to alt_stat3;

alter statistics alt_stat2 owner to regress_alter_generic_user2;

alter statistics alt_stat2 owner to regress_alter_generic_user3;

alter STATISTICS alt_stat2 set SCHEMA alt_nsp2;

set session authorization regress_alter_generic_user2;

create table alt_regress_2 (
  a INT,
  b INT
);

create STATISTICS alt_stat1 on "a", "b" from alt_regress_2;

create STATISTICS alt_stat2 on "a", "b" from alt_regress_2;

alter statistics alt_stat3 rename to alt_stat4;

alter statistics alt_stat1 rename to alt_stat4;

alter statistics alt_stat3 owner to regress_alter_generic_user2;

alter statistics alt_stat2 owner to regress_alter_generic_user3;

alter STATISTICS alt_stat3 set SCHEMA alt_nsp2;

alter STATISTICS alt_stat2 set SCHEMA alt_nsp2;

reset session_authorization;

select
  nspname,
  stxname,
  rolname
from
  pg_statistic_ext as s,
  pg_namespace as n,
  pg_authid as a
where
  s.stxnamespace = n.oid and
  s.stxowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  stxname;

set session authorization regress_alter_generic_user1;

create TEXT SEARCH DICTIONARY alt_ts_dict1 (template = simple);

create TEXT SEARCH DICTIONARY alt_ts_dict2 (template = simple);

alter text search dictionary alt_ts_dict1 rename to alt_ts_dict2;

alter text search dictionary alt_ts_dict1 rename to alt_ts_dict3;

alter text search dictionary alt_ts_dict2 owner to regress_alter_generic_user2;

alter text search dictionary alt_ts_dict2 owner to regress_alter_generic_user3;

alter TEXT SEARCH DICTIONARY alt_ts_dict2 set SCHEMA alt_nsp2;

set session authorization regress_alter_generic_user2;

create TEXT SEARCH DICTIONARY alt_ts_dict1 (template = simple);

create TEXT SEARCH DICTIONARY alt_ts_dict2 (template = simple);

alter text search dictionary alt_ts_dict3 rename to alt_ts_dict4;

alter text search dictionary alt_ts_dict1 rename to alt_ts_dict4;

alter text search dictionary alt_ts_dict3 owner to regress_alter_generic_user2;

alter text search dictionary alt_ts_dict2 owner to regress_alter_generic_user3;

alter TEXT SEARCH DICTIONARY alt_ts_dict3 set SCHEMA alt_nsp2;

alter TEXT SEARCH DICTIONARY alt_ts_dict2 set SCHEMA alt_nsp2;

reset session_authorization;

select
  nspname,
  dictname,
  rolname
from
  pg_ts_dict as t,
  pg_namespace as n,
  pg_authid as a
where
  t.dictnamespace = n.oid and
  t.dictowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  dictname;

set session authorization regress_alter_generic_user1;

create TEXT SEARCH CONFIGURATION alt_ts_conf1 (copy = english);

create TEXT SEARCH CONFIGURATION alt_ts_conf2 (copy = english);

alter text search configuration alt_ts_conf1 rename to alt_ts_conf2;

alter text search configuration alt_ts_conf1 rename to alt_ts_conf3;

alter text search configuration alt_ts_conf2
owner to regress_alter_generic_user2;

alter text search configuration alt_ts_conf2
owner to regress_alter_generic_user3;

alter TEXT SEARCH CONFIGURATION alt_ts_conf2 set SCHEMA alt_nsp2;

set session authorization regress_alter_generic_user2;

create TEXT SEARCH CONFIGURATION alt_ts_conf1 (copy = english);

create TEXT SEARCH CONFIGURATION alt_ts_conf2 (copy = english);

alter text search configuration alt_ts_conf3 rename to alt_ts_conf4;

alter text search configuration alt_ts_conf1 rename to alt_ts_conf4;

alter text search configuration alt_ts_conf3
owner to regress_alter_generic_user2;

alter text search configuration alt_ts_conf2
owner to regress_alter_generic_user3;

alter TEXT SEARCH CONFIGURATION alt_ts_conf3 set SCHEMA alt_nsp2;

alter TEXT SEARCH CONFIGURATION alt_ts_conf2 set SCHEMA alt_nsp2;

reset session_authorization;

select
  nspname,
  cfgname,
  rolname
from
  pg_ts_config as t,
  pg_namespace as n,
  pg_authid as a
where
  t.cfgnamespace = n.oid and
  t.cfgowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  cfgname;

create TEXT SEARCH TEMPLATE alt_ts_temp1 (lexize = dsimple_lexize);

create TEXT SEARCH TEMPLATE alt_ts_temp2 (lexize = dsimple_lexize);

alter text search template alt_ts_temp1 rename to alt_ts_temp2;

alter text search template alt_ts_temp1 rename to alt_ts_temp3;

alter TEXT SEARCH TEMPLATE alt_ts_temp2 set SCHEMA alt_nsp2;

create TEXT SEARCH TEMPLATE alt_ts_temp2 (lexize = dsimple_lexize);

alter TEXT SEARCH TEMPLATE alt_ts_temp2 set SCHEMA alt_nsp2;

create TEXT SEARCH TEMPLATE tstemp_case ("Init" = init_function);

select
  nspname,
  tmplname
from
  pg_ts_template as t,
  pg_namespace as n
where
  t.tmplnamespace = n.oid and
  nspname like 'alt_nsp%'
order by nspname,
  tmplname;

create TEXT SEARCH PARSER alt_ts_prs1 (
  start = prsd_start,
  gettoken = prsd_nexttoken,
  "end" = prsd_end,
  lextypes = prsd_lextype
);

create TEXT SEARCH PARSER alt_ts_prs2 (
  start = prsd_start,
  gettoken = prsd_nexttoken,
  "end" = prsd_end,
  lextypes = prsd_lextype
);

alter text search parser alt_ts_prs1 rename to alt_ts_prs2;

alter text search parser alt_ts_prs1 rename to alt_ts_prs3;

alter TEXT SEARCH PARSER alt_ts_prs2 set SCHEMA alt_nsp2;

create TEXT SEARCH PARSER alt_ts_prs2 (
  start = prsd_start,
  gettoken = prsd_nexttoken,
  "end" = prsd_end,
  lextypes = prsd_lextype
);

alter TEXT SEARCH PARSER alt_ts_prs2 set SCHEMA alt_nsp2;

create TEXT SEARCH PARSER tspars_case ("Start" = start_function);

select
  nspname,
  prsname
from
  pg_ts_parser as t,
  pg_namespace as n
where
  t.prsnamespace = n.oid and
  nspname like 'alt_nsp%'
order by nspname,
  prsname;

drop FOREIGN DATA WRAPPER alt_fdw2 cascade;

drop FOREIGN DATA WRAPPER alt_fdw3 cascade;

drop LANGUAGE alt_lang2 cascade;

drop LANGUAGE alt_lang3 cascade;

drop SCHEMA alt_nsp1 cascade;

drop SCHEMA alt_nsp2 cascade;

drop role regress_alter_generic_user1;

drop role regress_alter_generic_user2;

drop role regress_alter_generic_user3;
