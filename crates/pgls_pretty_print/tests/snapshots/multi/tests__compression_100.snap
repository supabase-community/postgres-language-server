---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/compression.sql
---
create schema "pglz";

set search_path to pglz, public;

set default_toast_compression = pglz;

create table cmdata (f1 text compression pglz);

create index "idx" on cmdata using btree (f1);

insert into cmdata values (repeat('1234567890', 1000));

select pg_column_compression(f1) from cmdata;

select substr(f1, 200, 5) from cmdata;

select * into cmmove1 from cmdata;

select pg_column_compression(f1) from cmmove1;

create table cmdata2 (f1 int compression pglz);

create or replace function large_val()
returns text
language sql
as $function$
select array_agg(fipshash(g::text))::text from generate_series(1, 256) g
$function$;

create table cmdata2 (f1 text compression pglz);

insert into cmdata2 select large_val() || repeat('a', 4000);

select pg_column_compression(f1) from cmdata2;

select substr(f1, 200, 5) from cmdata2;

drop table cmdata2;

create table cmdata2 (f1 int);

alter table cmdata2
  alter column f1 type varchar;

alter table cmdata2
  alter column f1 type int using cast(f1 as int);

alter table cmdata2
  alter column f1 type varchar;

alter table cmdata2
  alter column f1 set compression pglz;

alter table cmdata2
  alter column f1 set storage plain;

insert into cmdata2 values (repeat('123456789', 800));

select pg_column_compression(f1) from cmdata2;

create table cmdata3 (f1 text);

create table cminh ()
inherits (cmdata,
cmdata3);

set default_toast_compression = '';

set default_toast_compression = 'I do not exist compression';

set default_toast_compression = pglz;

alter table cmdata2
  alter column f1 set compression "default";

drop table cmdata2;

select pg_column_compression(f1) from cmdata;

vacuum (FULL) cmdata;

select pg_column_compression(f1) from cmdata;

select length(f1) from cmdata;

select length(f1) from cmmove1;

create table badcompresstbl (a text compression i_do_not_exist_compression);

create table badcompresstbl (a text);

alter table badcompresstbl
  alter column a set compression i_do_not_exist_compression;

drop table badcompresstbl;
