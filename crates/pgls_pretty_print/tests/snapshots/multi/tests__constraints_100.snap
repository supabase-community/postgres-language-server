---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/constraints.sql
snapshot_kind: text
---
create table default_tbl (
  i INT default 100,
  x TEXT default 'vadim',
  f DOUBLE PRECISION default 123.456
);

insert into default_tbl values (1, 'thomas', 57.0613);

insert into default_tbl values (1, 'bruce');

insert into default_tbl (i, f) values (2, 987.654);

insert into default_tbl (x) values ('marc');

insert into default_tbl values (3, null, 1.0);

select * from default_tbl;

create sequence default_seq;

create table defaultexpr_tbl (
  i1 INT default (100 + (200 - 199) * 2),
  i2 INT default nextval('default_seq')
);

insert into defaultexpr_tbl values (-1, -2);

insert into defaultexpr_tbl (i1) values (-3);

insert into defaultexpr_tbl (i2) values (-4);

insert into defaultexpr_tbl (i2) values (null);

select * from defaultexpr_tbl;

create table error_tbl (b1 BOOLEAN default (1 in (1, 2)));

drop TABLE error_tbl;

create table check_tbl (
  x INT,
  constraint "check_con" check (x > 3)
);

insert into check_tbl values (5);

insert into check_tbl values (4);

insert into check_tbl values (3);

insert into check_tbl values (2);

insert into check_tbl values (6);

insert into check_tbl values (1);

select * from check_tbl;

insert into ne_check_tbl values (5);

insert into ne_check_tbl values (4);

insert into ne_check_tbl values (3);

insert into ne_check_tbl values (2);

insert into ne_check_tbl values (6);

insert into ne_check_tbl values (1);

select * from ne_check_tbl;

create sequence check_seq;

create table check2_tbl (
  x INT,
  y TEXT,
  z INT,
  constraint "sequence_con" check (x > 3 and y <> 'check failed' and z < 8)
);

insert into check2_tbl values (4, 'check ok', -2);

insert into check2_tbl values (1, 'x check failed', -2);

insert into check2_tbl values (5, 'z check failed', 10);

insert into check2_tbl values (0, 'check failed', -2);

insert into check2_tbl values (6, 'check failed', 11);

insert into check2_tbl values (7, 'check ok', 7);

select * from check2_tbl;

create sequence insert_seq;

insert into insert_tbl (x, z) values (2, -2);

select * from insert_tbl;

select 'one' as one, nextval('insert_seq');

insert into insert_tbl (y) values ('Y');

insert into insert_tbl (y) values ('Y');

insert into insert_tbl (x, z) values (1, -2);

insert into insert_tbl (z, x) values (-7, 7);

insert into insert_tbl values (5, 'check failed', -5);

insert into insert_tbl values (7, '!check failed', -7);

insert into insert_tbl (y) values ('-!NULL-');

select * from insert_tbl;

insert into insert_tbl (y, z) values ('check failed', 4);

insert into insert_tbl (x, y) values (5, 'check failed');

insert into insert_tbl (x, y) values (5, '!check failed');

insert into insert_tbl (y) values ('-!NULL-');

select * from insert_tbl;

select 'seven' as one, nextval('insert_seq');

insert into insert_tbl (y) values ('Y');

select 'eight' as one, currval('insert_seq');

insert into insert_tbl values (null, null, null);

select * from insert_tbl;

create table sys_col_check_tbl (
  city TEXT,
  state TEXT,
  is_capital BOOLEAN,
  altitude INT,
  check (not (is_capital and
  cast(cast(tableoid as REGCLASS) as TEXT) =
  'sys_col_check_tbl'))
);

insert into sys_col_check_tbl values ('Seattle', 'Washington', false, 100);

insert into sys_col_check_tbl values ('Olympia', 'Washington', true, 100);

select *, cast(cast(tableoid as REGCLASS) as TEXT) from sys_col_check_tbl;

drop TABLE sys_col_check_tbl;

create table sys_col_check_tbl (
  city TEXT,
  state TEXT,
  is_capital BOOLEAN,
  altitude INT,
  check (not (is_capital and
  cast(ctid as TEXT) = 'sys_col_check_tbl'))
);

create table insert_child (
  cx INT default 42,
  cy INT check (cy > x)
)
inherits (insert_tbl);

insert into insert_child (x, z, cy) values (7, -7, 11);

insert into insert_child (x, z, cy) values (7, -7, 6);

insert into insert_child (x, z, cy) values (6, -7, 7);

insert into insert_child (x, y, z, cy) values (6, 'check failed', -6, 7);

select * from insert_child;

drop TABLE insert_child;

create table atacc1 (test INT check (test > 0) no inherit);

create table atacc2 (test2 INT)
inherits (atacc1);

insert into atacc2 (test) values (-3);

insert into atacc1 (test) values (-3);

drop TABLE atacc1 cascade;

create table atacc1 (
  test INT,
  test2 INT check (test > 0),
  check (test2 > 10) no inherit
);

create table atacc2 ()
inherits (atacc1);

insert into atacc2 (test) values (-3);

insert into atacc1 (test) values (-3);

insert into atacc2 (test2) values (3);

insert into atacc1 (test2) values (3);

drop TABLE atacc1 cascade;

delete from insert_tbl;

alter SEQUENCE insert_seq RESTART;
