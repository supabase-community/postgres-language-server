---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/expressions.sql
snapshot_kind: text
---
select cast(date(NOW()) as TEXT) = cast(current_date as TEXT);

select cast(cast(NOW() as time with time ZONE) as TEXT) = cast(current_time as TEXT);

select cast(cast(NOW() as time(4) with time ZONE) as TEXT) = cast(current_time(4) as TEXT);

select cast(cast(NOW() as TIME) as TEXT) = cast(localtime as TEXT);

select cast(cast(NOW() as TIME(3)) as TEXT) = cast(localtime(3) as TEXT);

select current_timestamp = NOW();

select length(cast(current_timestamp as TEXT)) >= length(cast(current_timestamp(0) as TEXT));

select cast(cast(NOW() as TIMESTAMP) as TEXT) = cast(localtimestamp as TEXT);

select current_time = current_time(7);

select current_timestamp = current_timestamp(7);

select localtime = localtime(7);

select localtimestamp = localtimestamp(7);

select current_catalog = current_database();

select current_schema;

set search_path to notme;

select current_schema;

set search_path to pg_catalog;

select current_schema;

reset search_path;

begin;

create table numeric_tbl (
  f1 NUMERIC(18, 3),
  f2 NUMERIC
);

create view numeric_view
as select
  f1,
  cast(f1 as NUMERIC(16, 4)) as f1164,
  cast(f1 as NUMERIC) as f1n,
  f2,
  cast(f2 as NUMERIC(16, 4)) as f2164,
  cast(f2 as NUMERIC) as f2n
from
  numeric_tbl;

select * from numeric_view;

create table bpchar_tbl (
  f1 CHAR(16) unique,
  f2 CHAR
);

create view bpchar_view
as select
  f1,
  cast(f1 as CHAR(14)) as f114,
  cast(f1 as CHAR) as f1n,
  f2,
  cast(f2 as CHAR(14)) as f214,
  cast(f2 as CHAR) as f2n
from
  bpchar_tbl;

select * from bpchar_view where cast(f1 as CHAR) = 'foo';

rollback;

select random() in (1, 4, 8.0);

select cast(random() as INT) in (1, 4, 8.0);

select cast('(0,0)' as point) in (cast('(0,0,0,0)' as box), point(0, 0));

begin;

create function return_int_input(INT)
returns INT
as '
begin
	return $1;
end;
'
language "plpgsql"
stable;

create function return_text_input(TEXT)
returns TEXT
as '
begin
	return $1;
end;
'
language "plpgsql"
stable;

select return_int_input(1) in (10, 9, 2, 8, 3, 7, 4, 6, 5, 1);

select return_int_input(1) in (10, 9, 2, 8, 3, 7, 4, 6, 5, null);

select return_int_input(1) in (null, null, null, null, null, null, null, null, null, null, null);

select return_int_input(1) in (10, 9, 2, 8, 3, 7, 4, 6, 5, 1, null);

select return_int_input(cast(null as INT)) in (10, 9, 2, 8, 3, 7, 4, 6, 5, 1);

select return_int_input(cast(null as INT)) in (10, 9, 2, 8, 3, 7, 4, 6, 5, null);

select return_text_input('a') in ('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j');

select return_int_input(1) not in (10, 9, 2, 8, 3, 7, 4, 6, 5, 1);

select return_int_input(1) not in (10, 9, 2, 8, 3, 7, 4, 6, 5, 0);

select return_int_input(1) not in (10, 9, 2, 8, 3, 7, 4, 6, 5, 2, null);

select return_int_input(1) not in (10, 9, 2, 8, 3, 7, 4, 6, 5, 1, null);

select
  return_int_input(1)
  not in (
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null
  );

select return_int_input(cast(null as INT)) not in (10, 9, 2, 8, 3, 7, 4, 6, 5, 1);

select return_int_input(cast(null as INT)) not in (10, 9, 2, 8, 3, 7, 4, 6, 5, null);

select return_text_input('a') not in ('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j');

rollback;

begin;

create type myint;

create function myintin(cstring)
returns myint
STRICT
immutable
language "internal"
as 'int4in';

create function myintout(myint)
returns cstring
STRICT
immutable
language "internal"
as 'int4out';

create function myinthash(myint)
returns INT
STRICT
immutable
language "internal"
as 'hashint4';

create type myint (input = myintin, output = myintout, like = INT);

create cast (INT as myint) without function;

create cast (myint as INT) without function;

create function myinteq(myint, myint)
returns BOOLEAN
as '
begin
  if $1 is null and $2 is null then
    return true;
  else
    return $1::int = $2::int;
  end if;
end;
'
language "plpgsql"
immutable;

create function myintne(myint, myint)
returns BOOLEAN
as '
begin
  return not myinteq($1, $2);
end;
'
language "plpgsql"
immutable;

create operator = (LEFTARG = myint,
RIGHTARG = myint,
COMMUTATOR = =,
NEGATOR = <>,
PROCEDURE = myinteq,
RESTRICT = eqsel,
JOIN = eqjoinsel,
MERGES);

create operator <> (LEFTARG = myint,
RIGHTARG = myint,
COMMUTATOR = <>,
NEGATOR = =,
PROCEDURE = myintne,
RESTRICT = eqsel,
JOIN = eqjoinsel,
MERGES);

create OPERATOR class myint_ops default
  for type myint
  using hash
  as OPERATOR 1 = (myint, myint),
  FUNCTION 1 myinthash(myint);

create table inttest (a myint);

insert into inttest values (cast(1 as myint)), (null);

select
  *
from
  inttest
where
  a
  in (
    cast(1 as myint),
    cast(2 as myint),
    cast(3 as myint),
    cast(4 as myint),
    cast(5 as myint),
    cast(6 as myint),
    cast(7 as myint),
    cast(8 as myint),
    cast(9 as myint),
    null
  );

select
  *
from
  inttest
where
  a
  not in (
    cast(1 as myint),
    cast(2 as myint),
    cast(3 as myint),
    cast(4 as myint),
    cast(5 as myint),
    cast(6 as myint),
    cast(7 as myint),
    cast(8 as myint),
    cast(9 as myint),
    null
  );

select
  *
from
  inttest
where
  a
  not in (
    cast(0 as myint),
    cast(2 as myint),
    cast(3 as myint),
    cast(4 as myint),
    cast(5 as myint),
    cast(6 as myint),
    cast(7 as myint),
    cast(8 as myint),
    cast(9 as myint),
    null
  );

select
  *
from
  inttest
where
  a
  in (
    cast(1 as myint),
    cast(2 as myint),
    cast(3 as myint),
    cast(4 as myint),
    cast(5 as myint),
    null
  );

select
  *
from
  inttest
where
  a
  not in (
    cast(1 as myint),
    cast(2 as myint),
    cast(3 as myint),
    cast(4 as myint),
    cast(5 as myint),
    null
  );

select
  *
from
  inttest
where
  a
  not in (
    cast(0 as myint),
    cast(2 as myint),
    cast(3 as myint),
    cast(4 as myint),
    cast(5 as myint),
    null
  );

rollback;
