---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/replica_identity.sql
snapshot_kind: text
---
create table test_replica_identity (
  id serial primary key,
  keya text not null,
  keyb text not null,
  nonkey text,
  constraint "test_replica_identity_unique_defer" unique (keya,
  keyb) deferrable,
  constraint "test_replica_identity_unique_nondefer" unique (keya,
  keyb)
);

create table test_replica_identity_othertable (id serial primary key);

create table test_replica_identity_t3 (
  id serial
  constraint "pk" primary key
  deferrable
);

create index "test_replica_identity_keyab"
on test_replica_identity
using btree
(
  keya,
  keyb
);

create unique
index "test_replica_identity_keyab_key"
on test_replica_identity
using btree
(
  keya,
  keyb
);

create unique
index "test_replica_identity_nonkey"
on test_replica_identity
using btree
(
  keya,
  nonkey
);

create index "test_replica_identity_hash"
on test_replica_identity
using hash
(
  nonkey
);

create unique
index "test_replica_identity_expr"
on test_replica_identity
using btree
(
  keya,
  keyb,
  (3)
);

create unique
index "test_replica_identity_partial"
on test_replica_identity
using btree
(
  keya,
  keyb
)
where
  keyb <> '3';

select
  relreplident
from
  pg_class
where
  oid =
  cast('test_replica_identity'
  as regclass);

select relreplident from pg_class where oid = cast('pg_class' as regclass);

select relreplident from pg_class where oid = cast('pg_constraint' as regclass);

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_keyab;

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_nonkey;

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_hash;

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_expr;

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_partial;

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_othertable_pkey;

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_unique_defer;

alter table test_replica_identity_t3
  replica identity using index pk;

select
  relreplident
from
  pg_class
where
  oid =
  cast('test_replica_identity'
  as regclass);

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_pkey;

select
  relreplident
from
  pg_class
where
  oid =
  cast('test_replica_identity'
  as regclass);

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_unique_nondefer;

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_keyab_key;

alter table test_replica_identity
  replica identity
  using index
  test_replica_identity_keyab_key;

select
  relreplident
from
  pg_class
where
  oid =
  cast('test_replica_identity'
  as regclass);

select
  COUNT(*)
from
  pg_index
where
  indrelid =
  cast('test_replica_identity'
  as regclass) and
  indisreplident;

alter table test_replica_identity
  replica identity default;

select
  relreplident
from
  pg_class
where
  oid =
  cast('test_replica_identity'
  as regclass);

select
  COUNT(*)
from
  pg_index
where
  indrelid =
  cast('test_replica_identity'
  as regclass) and
  indisreplident;

alter table test_replica_identity
  replica identity full;

select
  relreplident
from
  pg_class
where
  oid =
  cast('test_replica_identity'
  as regclass);

alter table test_replica_identity
  replica identity nothing;

select
  relreplident
from
  pg_class
where
  oid =
  cast('test_replica_identity'
  as regclass);

create table test_replica_identity2 (id int unique not null);

alter table test_replica_identity2
  replica identity
  using index
  test_replica_identity2_id_key;

alter table test_replica_identity2
  alter column id type bigint;

create table test_replica_identity3 (id int not null);

create unique
index "test_replica_identity3_id_key"
on test_replica_identity3
using btree
(
  id
);

alter table test_replica_identity3
  replica identity
  using index
  test_replica_identity3_id_key;

alter table test_replica_identity3
  alter column id type bigint;

alter table test_replica_identity3
  alter column id drop not null;

alter table test_replica_identity3
  replica identity full;

alter table test_replica_identity3
  alter column id drop not null;

create table test_replica_identity4 (id int not null)
partition by LIST(id);

create table test_replica_identity4_1 (id int not null);

alter table only test_replica_identity4
  attach partition
  test_replica_identity4_1
  for values in (1);

alter table only test_replica_identity4
  add constraint "test_replica_identity4_pkey" primary key (id);

alter table only test_replica_identity4
  replica identity
  using index
  test_replica_identity4_pkey;

alter table only test_replica_identity4_1
  add constraint "test_replica_identity4_1_pkey" primary key (id);

alter index test_replica_identity4_pkey
  attach partition
  test_replica_identity4_1_pkey;

create table test_replica_identity5 (
  a int not null,
  b int,
  c int,
  primary key (b, c)
);

create unique
index "test_replica_identity5_a_b_key"
on test_replica_identity5
using btree
(
  a,
  b
);

alter table test_replica_identity5
  replica identity
  using index
  test_replica_identity5_a_b_key;

alter table test_replica_identity5
  drop constraint test_replica_identity5_pkey;

alter table test_replica_identity5
  alter column b set not null;

alter table test_replica_identity5
  drop constraint test_replica_identity5_pkey;

alter table test_replica_identity5
  alter column b drop not null;

drop table test_replica_identity;

drop table test_replica_identity2;

drop table test_replica_identity3;

drop table test_replica_identity4;

drop table test_replica_identity5;

drop table test_replica_identity_othertable;

drop table test_replica_identity_t3;
