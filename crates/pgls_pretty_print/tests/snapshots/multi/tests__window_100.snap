---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/window.sql
---
create temporary table empsalary (
  depname varchar,
  empno bigint,
  salary int,
  enroll_date date
);

insert into empsalary
values
  ('develop', 10, 5200, '2007-08-01'),
  ('sales', 1, 5000, '2006-10-01'),
  ('personnel', 5, 3500, '2007-12-10'),
  ('sales', 4, 4800, '2007-08-08'),
  ('personnel', 2, 3900, '2006-12-23'),
  ('develop', 7, 4200, '2008-01-01'),
  ('develop', 9, 4500, '2008-01-01'),
  ('sales', 3, 4800, '2007-08-01'),
  ('develop', 8, 6000, '2006-10-01'),
  ('develop', 11, 5200, '2007-08-15');

select
  depname,
  empno,
  salary,
  SUM(salary) over (partition by depname)
from
  empsalary
order by depname,
  salary;

select depname, empno, salary, RANK() over (partition by depname order by salary) from empsalary;

select
  four,
  ten,
  SUM(SUM(four)) over (partition by four),
  AVG(ten)
from
  tenk1
group by four,
  ten
order by four,
  ten;

select depname, empno, salary, SUM(salary) over w from empsalary window w as (partition by depname);

select
  depname,
  empno,
  salary,
  RANK() over w
from
  empsalary
window
  w as (
    partition by depname
    order by salary
  )
order by RANK() over w;

select COUNT(*) over () from tenk1 where unique2 < 10;

select COUNT(*) over w from tenk1 where unique2 < 10 window w as ();

select four from tenk1 where false window w as (partition by ten);

select
  SUM(four) over (partition by ten order by unique2)
  as sum_1,
  ten,
  four
from
  tenk1
where
  unique2 < 10;

select ROW_NUMBER() over (order by unique2) from tenk1 where unique2 < 10;

select
  RANK() over (partition by four order by ten)
  as rank_1,
  ten,
  four
from
  tenk1
where
  unique2 < 10;

select DENSE_RANK() over (partition by four order by ten), ten, four from tenk1 where unique2 < 10;

select
  PERCENT_RANK()
  over (
    partition by four
    order by ten
  ),
  ten,
  four
from
  tenk1
where
  unique2 < 10;

select CUME_DIST() over (partition by four order by ten), ten, four from tenk1 where unique2 < 10;

select NTILE(3) over (order by ten, four), ten, four from tenk1 where unique2 < 10;

select NTILE(null) over (order by ten, four), ten, four from tenk1 limit 2;

select LAG(ten) over (partition by four order by ten), ten, four from tenk1 where unique2 < 10;

select
  LAG(
    ten,
    four
  )
  over (
    partition by four
    order by ten
  ),
  ten,
  four
from
  tenk1
where
  unique2 < 10;

select
  LAG(
    ten,
    four,
    0
  )
  over (
    partition by four
    order by ten
  ),
  ten,
  four
from
  tenk1
where
  unique2 < 10;

select
  LAG(
    ten,
    four,
    0.7
  )
  over (
    partition by four
    order by ten
  ),
  ten,
  four
from
  tenk1
where
  unique2 < 10
order by four,
  ten;

select LEAD(ten) over (partition by four order by ten), ten, four from tenk1 where unique2 < 10;

select
  LEAD(
    ten * 2,
    1
  )
  over (
    partition by four
    order by ten
  ),
  ten,
  four
from
  tenk1
where
  unique2 < 10;

select
  LEAD(
    ten * 2,
    1,
    -1
  )
  over (
    partition by four
    order by ten
  ),
  ten,
  four
from
  tenk1
where
  unique2 < 10;

select
  LEAD(
    ten * 2,
    1,
    -1.4
  )
  over (
    partition by four
    order by ten
  ),
  ten,
  four
from
  tenk1
where
  unique2 < 10
order by four,
  ten;

select
  FIRST_VALUE(
    ten
  )
  over (
    partition by four
    order by ten
  ),
  ten,
  four
from
  tenk1
where
  unique2 < 10;

select LAST_VALUE(four) over (order by ten), ten, four from tenk1 where unique2 < 10;

select
  LAST_VALUE(ten) over (partition by four),
  ten,
  four
from
  (
    select
      *
    from
      tenk1
    where
      unique2 < 10
    order by four,
      ten
  )
  as s
order by four,
  ten;

select
  NTH_VALUE(ten, four + 1) over (partition by four),
  ten,
  four
from
  (
    select
      *
    from
      tenk1
    where
      unique2 < 10
    order by four,
      ten
  )
  as s;

select
  ten,
  two,
  SUM(hundred) as gsum,
  SUM(
    SUM(hundred)
  )
  over (
    partition by two
    order by ten
  )
  as wsum
from
  tenk1
group by ten,
  two;

select
  COUNT(*) over (partition by four),
  four
from
  (select * from tenk1 where two = 1) as s
where
  unique2 < 10;

select
  cast(COUNT(*) over (partition by four order by ten) +
  SUM(hundred) over (partition by four order by ten)
  as varchar)
  as cntsum
from
  tenk1
where
  unique2 < 10;

select
  *
from
  (
    select
      COUNT(*) over (partition by four order by ten) +
      SUM(hundred) over (partition by two order by ten)
      as total,
      COUNT(*) over (partition by four order by ten)
      as fourcount,
      SUM(hundred) over (partition by two order by ten)
      as twosum
    from
      tenk1
  )
  as sub
where
  total <> fourcount + twosum;

select AVG(four) over (partition by four order by thousand / 100) from tenk1 where unique2 < 10;

select
  ten,
  two,
  SUM(hundred) as gsum,
  SUM(SUM(hundred)) over win as wsum
from
  tenk1
group by ten,
  two
window
  win as (
    partition by two
    order by ten
  );

select
  SUM(salary),
  ROW_NUMBER() over (order by depname),
  SUM(SUM(salary)) over (order by depname desc)
from
  empsalary
group by depname;

select
  SUM(salary) over w1,
  COUNT(*) over w2
from
  empsalary
window
  w1 as (
    order by salary
  ),
  w2 as (
    order by salary
  );

select
  LEAD(
    ten,
    (select two from tenk1 where s.unique2 = unique2)
  )
  over (
    partition by four
    order by ten
  )
from
  tenk1 as s
where
  unique2 < 10;

select COUNT(*) over (partition by four) from (select * from tenk1 where false) as s;

select
  SUM(salary) over w,
  RANK() over w
from
  empsalary
window
  w as (
    partition by depname
    order by salary desc
  );

select
  empno,
  depname,
  salary,
  bonus,
  depadj,
  MIN(bonus) over (order by empno),
  MAX(depadj) over ()
from
  (
    select
      *,
      case
        when enroll_date < '2008-01-01'
        then 2008 - EXTRACT('year' from enroll_date)
      end *
      500
      as bonus,
      case
        when AVG(salary) over (partition by depname) < salary
        then 200
      end
      as depadj
    from
      empsalary
  )
  as s;

select SUM(COUNT(f1)) over () from int4_tbl where f1 = 42;

select
  ten,
  SUM(unique1) + SUM(unique2) as res,
  RANK() over (order by SUM(unique1) + SUM(unique2))
  as rank
from
  tenk1
group by ten
order by ten;

select
  FIRST_VALUE(MAX(x)) over (),
  y
from
  (
    select unique1 as x, ten + four as y from tenk1
  )
  as ss
group by y;

select
  x,
  LAG(x, 1) over (order by x),
  LEAD(x, 3) over (order by x)
from
  (
    select
      cast(x as numeric) as x
    from
      generate_series(1, 10) as x
  );

select
  four,
  ten,
  SUM(ten) over (partition by four order by ten),
  LAST_VALUE(
    ten
  )
  over (
    partition by four
    order by ten
  )
from
  (select distinct ten, four from tenk1) as ss;

select
  four,
  ten,
  SUM(
    ten
  )
  over (
    partition by four
    order by ten
    range between
    unbounded preceding
    and
    current row
  ),
  LAST_VALUE(
    ten
  )
  over (
    partition by four
    order by ten
    range between
    unbounded preceding
    and
    current row
  )
from
  (select distinct ten, four from tenk1) as ss;

select
  four,
  ten,
  SUM(
    ten
  )
  over (
    partition by four
    order by ten
    range between
    unbounded preceding
    and
    unbounded following
  ),
  LAST_VALUE(
    ten
  )
  over (
    partition by four
    order by ten
    range between
    unbounded preceding
    and
    unbounded following
  )
from
  (select distinct ten, four from tenk1) as ss;

select
  four,
  ten / 4 as two,
  SUM(
    ten / 4
  )
  over (
    partition by four
    order by ten / 4
    range between
    unbounded preceding
    and
    current row
  ),
  LAST_VALUE(
    ten / 4
  )
  over (
    partition by four
    order by ten / 4
    range between
    unbounded preceding
    and
    current row
  )
from
  (select distinct ten, four from tenk1) as ss;

select
  four,
  ten / 4 as two,
  SUM(
    ten / 4
  )
  over (
    partition by four
    order by ten / 4
    rows between
    unbounded preceding
    and
    current row
  ),
  LAST_VALUE(
    ten / 4
  )
  over (
    partition by four
    order by ten / 4
    rows between
    unbounded preceding
    and
    current row
  )
from
  (select distinct ten, four from tenk1) as ss;

select
  SUM(
    unique1
  )
  over (
    order by four
    range between
    current row
    and
    unbounded following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    current row
    and
    unbounded following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    2 preceding
    and
    2 following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    2 preceding
    and
    2 following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    2 preceding
    and
    2 following
    exclude current row
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    2 preceding
    and
    2 following
    exclude group
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    2 preceding
    and
    2 following
    exclude ties
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  FIRST_VALUE(
    unique1
  )
  over (
    order by four
    rows between
    current row
    and
    2 following
    exclude current row
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  FIRST_VALUE(
    unique1
  )
  over (
    order by four
    rows between
    current row
    and
    2 following
    exclude group
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  FIRST_VALUE(
    unique1
  )
  over (
    order by four
    rows between
    current row
    and
    2 following
    exclude ties
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  LAST_VALUE(
    unique1
  )
  over (
    order by four
    rows between
    current row
    and
    2 following
    exclude current row
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  LAST_VALUE(
    unique1
  )
  over (
    order by four
    rows between
    current row
    and
    2 following
    exclude group
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  LAST_VALUE(
    unique1
  )
  over (
    order by four
    rows between
    current row
    and
    2 following
    exclude ties
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    2 preceding
    and
    1 preceding
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    1 following
    and
    3 following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    unbounded preceding
    and
    1 following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    w
    range between
    current row
    and
    unbounded following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10
window
  w as (
    order by four
  );

select
  SUM(
    unique1
  )
  over (
    w
    range between
    unbounded preceding
    and
    current row
    exclude current row
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10
window
  w as (
    order by four
  );

select
  SUM(
    unique1
  )
  over (
    w
    range between
    unbounded preceding
    and
    current row
    exclude group
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10
window
  w as (
    order by four
  );

select
  SUM(
    unique1
  )
  over (
    w
    range between
    unbounded preceding
    and
    current row
    exclude ties
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10
window
  w as (
    order by four
  );

select
  FIRST_VALUE(unique1) over w,
  NTH_VALUE(unique1, 2) over w as nth_2,
  LAST_VALUE(unique1) over w,
  unique1,
  four
from
  tenk1
where
  unique1 < 10
window
  w as (
    order by four
    range between
    current row
    and
    unbounded following
  );

select
  SUM(
    unique1
  )
  over (
    order by unique1
    rows 
    (
      select unique1 from tenk1 order by unique1 limit 1
    ) +
    1 preceding
  ),
  unique1
from
  tenk1
where
  unique1 < 10;

create temporary view v_window
as select
  i,
  SUM(
    i
  )
  over (
    order by i
    rows between
    1 preceding
    and
    1 following
  )
  as sum_rows
from
  generate_series(1, 10) as i;

select * from v_window;

select pg_get_viewdef('v_window');

create or replace temporary view v_window
as select
  i,
  SUM(
    i
  )
  over (
    order by i
    rows between
    1 preceding
    and
    1 following
    exclude current row
  )
  as sum_rows
from
  generate_series(1, 10) as i;

select * from v_window;

select pg_get_viewdef('v_window');

create or replace temporary view v_window
as select
  i,
  SUM(
    i
  )
  over (
    order by i
    rows between
    1 preceding
    and
    1 following
    exclude group
  )
  as sum_rows
from
  generate_series(1, 10) as i;

select * from v_window;

select pg_get_viewdef('v_window');

create or replace temporary view v_window
as select
  i,
  SUM(
    i
  )
  over (
    order by i
    rows between
    1 preceding
    and
    1 following
    exclude ties
  )
  as sum_rows
from
  generate_series(1, 10) as i;

select * from v_window;

select pg_get_viewdef('v_window');

create or replace temporary view v_window
as select
  i,
  SUM(
    i
  )
  over (
    order by i
    rows between
    1 preceding
    and
    1 following
  )
  as sum_rows
from
  generate_series(1, 10) as i;

select * from v_window;

select pg_get_viewdef('v_window');

create or replace temporary view v_window
as select
  i,
  SUM(
    i
  )
  over (
    order by i
    groups between
    1 preceding
    and
    1 following
  )
  as sum_rows
from
  generate_series(1, 10) as i;

select * from v_window;

select pg_get_viewdef('v_window');

drop view v_window;

create temporary view v_window
as select
  i,
  MIN(
    i
  )
  over (
    order by i
    range between
    '1 day' preceding
    and
    '10 days' following
  )
  as min_i
from
  generate_series(
    NOW(),
    NOW() + cast('100 days' as interval),
    '1 hour'
  )
  as i;

select pg_get_viewdef('v_window');

select
  SUM(
    unique1
  )
  over (
    order by four
    range between
    cast(2 as bigint) preceding
    and
    cast(1 as smallint) preceding
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four desc
    range between
    cast(2 as bigint) preceding
    and
    cast(1 as smallint) preceding
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    range between
    cast(2 as bigint) preceding
    and
    cast(1 as smallint) preceding
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    range between
    cast(2 as bigint) preceding
    and
    cast(1 as smallint) preceding
    exclude current row
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    range between
    cast(2 as bigint) preceding
    and
    cast(1 as smallint) preceding
    exclude group
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    range between
    cast(2 as bigint) preceding
    and
    cast(1 as smallint) preceding
    exclude ties
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    range between
    cast(2 as bigint) preceding
    and
    cast(6 as smallint) following
    exclude ties
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    range between
    cast(2 as bigint) preceding
    and
    cast(6 as smallint) following
    exclude group
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    partition by four
    order by unique1
    range between
    cast(5 as bigint) preceding
    and
    cast(6 as smallint) following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    partition by four
    order by unique1
    range between
    cast(5 as bigint) preceding
    and
    cast(6 as smallint) following
    exclude current row
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    salary
  )
  over (
    order by enroll_date
    range between
    cast('1 year' as interval) preceding
    and
    cast('1 year' as interval) following
  ),
  salary,
  enroll_date
from
  empsalary;

select
  SUM(
    salary
  )
  over (
    order by enroll_date desc
    range between
    cast('1 year' as interval) preceding
    and
    cast('1 year' as interval) following
  ),
  salary,
  enroll_date
from
  empsalary;

select
  SUM(
    salary
  )
  over (
    order by enroll_date desc
    range between
    cast('1 year' as interval) following
    and
    cast('1 year' as interval) following
  ),
  salary,
  enroll_date
from
  empsalary;

select
  SUM(
    salary
  )
  over (
    order by enroll_date
    range between
    cast('1 year' as interval) preceding
    and
    cast('1 year' as interval) following
    exclude current row
  ),
  salary,
  enroll_date
from
  empsalary;

select
  SUM(
    salary
  )
  over (
    order by enroll_date
    range between
    cast('1 year' as interval) preceding
    and
    cast('1 year' as interval) following
    exclude group
  ),
  salary,
  enroll_date
from
  empsalary;

select
  SUM(
    salary
  )
  over (
    order by enroll_date
    range between
    cast('1 year' as interval) preceding
    and
    cast('1 year' as interval) following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  FIRST_VALUE(
    salary
  )
  over (
    order by salary
    range between
    1000 preceding
    and
    1000 following
  ),
  LEAD(
    salary
  )
  over (
    order by salary
    range between
    1000 preceding
    and
    1000 following
  ),
  NTH_VALUE(
    salary,
    1
  )
  over (
    order by salary
    range between
    1000 preceding
    and
    1000 following
  ),
  salary
from
  empsalary;

select
  LAST_VALUE(
    salary
  )
  over (
    order by salary
    range between
    1000 preceding
    and
    1000 following
  ),
  LAG(
    salary
  )
  over (
    order by salary
    range between
    1000 preceding
    and
    1000 following
  ),
  salary
from
  empsalary;

select
  FIRST_VALUE(
    salary
  )
  over (
    order by salary
    range between
    1000 following
    and
    3000 following
    exclude current row
  ),
  LEAD(
    salary
  )
  over (
    order by salary
    range between
    1000 following
    and
    3000 following
    exclude ties
  ),
  NTH_VALUE(
    salary,
    1
  )
  over (
    order by salary
    range between
    1000 following
    and
    3000 following
    exclude ties
  ),
  salary
from
  empsalary;

select
  LAST_VALUE(
    salary
  )
  over (
    order by salary
    range between
    1000 following
    and
    3000 following
    exclude group
  ),
  LAG(
    salary
  )
  over (
    order by salary
    range between
    1000 following
    and
    3000 following
    exclude group
  ),
  salary
from
  empsalary;

select
  FIRST_VALUE(
    salary
  )
  over (
    order by enroll_date
    range between
    unbounded preceding
    and
    cast('1 year' as interval) following
    exclude ties
  ),
  LAST_VALUE(
    salary
  )
  over (
    order by enroll_date
    range between
    unbounded preceding
    and
    cast('1 year' as interval) following
  ),
  salary,
  enroll_date
from
  empsalary;

select
  FIRST_VALUE(
    salary
  )
  over (
    order by enroll_date
    range between
    unbounded preceding
    and
    cast('1 year' as interval) following
    exclude ties
  ),
  LAST_VALUE(
    salary
  )
  over (
    order by enroll_date
    range between
    unbounded preceding
    and
    cast('1 year' as interval) following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  FIRST_VALUE(
    salary
  )
  over (
    order by enroll_date
    range between
    unbounded preceding
    and
    cast('1 year' as interval) following
    exclude group
  ),
  LAST_VALUE(
    salary
  )
  over (
    order by enroll_date
    range between
    unbounded preceding
    and
    cast('1 year' as interval) following
    exclude group
  ),
  salary,
  enroll_date
from
  empsalary;

select
  FIRST_VALUE(
    salary
  )
  over (
    order by enroll_date
    range between
    unbounded preceding
    and
    cast('1 year' as interval) following
    exclude current row
  ),
  LAST_VALUE(
    salary
  )
  over (
    order by enroll_date
    range between
    unbounded preceding
    and
    cast('1 year' as interval) following
    exclude current row
  ),
  salary,
  enroll_date
from
  empsalary;

select
  x,
  y,
  FIRST_VALUE(y) over w,
  LAST_VALUE(y) over w
from
  (
    select x, x as y from generate_series(1, 5) as x
    union all
    select null, 42
    union all
    select null, 43
  )
  as ss
window
  w as (
    order by x asc nulls first
    range between
    2 preceding
    and
    2 following
  );

select
  x,
  y,
  FIRST_VALUE(y) over w,
  LAST_VALUE(y) over w
from
  (
    select x, x as y from generate_series(1, 5) as x
    union all
    select null, 42
    union all
    select null, 43
  )
  as ss
window
  w as (
    order by x asc nulls last
    range between
    2 preceding
    and
    2 following
  );

select
  x,
  y,
  FIRST_VALUE(y) over w,
  LAST_VALUE(y) over w
from
  (
    select x, x as y from generate_series(1, 5) as x
    union all
    select null, 42
    union all
    select null, 43
  )
  as ss
window
  w as (
    order by x desc nulls first
    range between
    2 preceding
    and
    2 following
  );

select
  x,
  y,
  FIRST_VALUE(y) over w,
  LAST_VALUE(y) over w
from
  (
    select x, x as y from generate_series(1, 5) as x
    union all
    select null, 42
    union all
    select null, 43
  )
  as ss
window
  w as (
    order by x desc nulls last
    range between
    2 preceding
    and
    2 following
  );

select
  SUM(
    unique1
  )
  over (

    rows between
    x preceding
    and
    x following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

commit;

create function unbounded_syntax_test1b(x int)
returns table (
  a int,
  b int,
  c int
)
language sql
as $function$
SELECT sum(unique1) over (rows between x preceding and x following),
         unique1, four
  FROM tenk1 WHERE unique1 < 10;
$function$;

select * from unbounded_syntax_test1a(2);

select * from unbounded_syntax_test1b(2);

select
  SUM(
    unique1
  )
  over (

    rows between
    unbounded preceding
    and
    unbounded following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

commit;

create function unbounded_syntax_test2b(unbounded int)
returns table (
  a int,
  b int,
  c int
)
language sql
as $function$
SELECT sum(unique1) over (rows between unbounded preceding and unbounded following),
         unique1, four
  FROM tenk1 WHERE unique1 < 10;
$function$;

select * from unbounded_syntax_test2a(2);

select * from unbounded_syntax_test2b(2);

drop function
  unbounded_syntax_test1a,
  unbounded_syntax_test1b,
  unbounded_syntax_test2a,
  unbounded_syntax_test2b;

create function unbounded(x int)
returns int
language sql
immutable return x;;

select
  SUM(
    unique1
  )
  over (

    rows between
    1 preceding
    and
    1 following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    unbounded(1) preceding
    and
    unbounded(1) following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (

    rows between
    unbounded.x preceding
    and
    unbounded.x following
  ),
  unique1,
  four
from
  tenk1,
  (values (1)) as unbounded (x)
where
  unique1 < 10;

drop function unbounded;

select
  x,
  LAST_VALUE(
    x
  )
  over (
    order by cast(x as smallint)
    range between
    current row
    and
    2147450884 following
  )
from
  generate_series(32764, 32766) as x;

select
  x,
  LAST_VALUE(
    x
  )
  over (
    order by cast(x as smallint) desc
    range between
    current row
    and
    2147450885 following
  )
from
  generate_series(-32766, -32764) as x;

select
  x,
  LAST_VALUE(
    x
  )
  over (
    order by x
    range between
    current row
    and
    4 following
  )
from
  generate_series(2147483644, 2147483646) as x;

select
  x,
  LAST_VALUE(
    x
  )
  over (
    order by x desc
    range between
    current row
    and
    5 following
  )
from
  generate_series(-2147483646, -2147483644) as x;

select
  x,
  LAST_VALUE(
    x
  )
  over (
    order by x
    range between
    current row
    and
    4 following
  )
from
  generate_series(
    9223372036854775804,
    9223372036854775806
  )
  as x;

select
  x,
  LAST_VALUE(
    x
  )
  over (
    order by x desc
    range between
    current row
    and
    5 following
  )
from
  generate_series(
    -9223372036854775806,
    -9223372036854775804
  )
  as x;

create temporary table numerics (
  id int,
  f_float4 real,
  f_float8 double precision,
  f_numeric numeric
);

insert into numerics
values
  (0, '-infinity', '-infinity', '-infinity'),
  (1, -3, -3, -3),
  (2, -1, -1, -1),
  (3, 0, 0, 0),
  (4, 1.1, 1.1, 1.1),
  (5, 1.12, 1.12, 1.12),
  (6, 2, 2, 2),
  (7, 100, 100, 100),
  (8, 'infinity', 'infinity', 'infinity'),
  (9, 'NaN', 'NaN', 'NaN');

select
  id,
  f_float4,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float4
    range between
    1 preceding
    and
    1 following
  );

select
  id,
  f_float4,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float4
    range between
    1 preceding
    and
    cast(1.1 as real) following
  );

select
  id,
  f_float4,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float4
    range between
    'inf' preceding
    and
    'inf' following
  );

select
  id,
  f_float4,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float4
    range between
    'inf' preceding
    and
    'inf' preceding
  );

select
  id,
  f_float4,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float4
    range between
    'inf' following
    and
    'inf' following
  );

select
  id,
  f_float4,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float4
    range between
    1.1 preceding
    and
    'NaN' following
  );

select
  id,
  f_float8,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float8
    range between
    1 preceding
    and
    1 following
  );

select
  id,
  f_float8,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float8
    range between
    1 preceding
    and
    cast(1.1 as double precision) following
  );

select
  id,
  f_float8,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float8
    range between
    'inf' preceding
    and
    'inf' following
  );

select
  id,
  f_float8,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float8
    range between
    'inf' preceding
    and
    'inf' preceding
  );

select
  id,
  f_float8,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float8
    range between
    'inf' following
    and
    'inf' following
  );

select
  id,
  f_float8,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_float8
    range between
    1.1 preceding
    and
    'NaN' following
  );

select
  id,
  f_numeric,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_numeric
    range between
    1 preceding
    and
    1 following
  );

select
  id,
  f_numeric,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_numeric
    range between
    1 preceding
    and
    cast(1.1 as numeric) following
  );

select
  id,
  f_numeric,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_numeric
    range between
    1 preceding
    and
    cast(1.1 as double precision) following
  );

select
  id,
  f_numeric,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_numeric
    range between
    'inf' preceding
    and
    'inf' following
  );

select
  id,
  f_numeric,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_numeric
    range between
    'inf' preceding
    and
    'inf' preceding
  );

select
  id,
  f_numeric,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_numeric
    range between
    'inf' following
    and
    'inf' following
  );

select
  id,
  f_numeric,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  numerics
window
  w as (
    order by f_numeric
    range between
    1.1 preceding
    and
    'NaN' following
  );

create temporary table datetimes (
  id int,
  f_time time,
  f_timetz time with time zone,
  f_interval interval,
  f_timestamptz timestamp with time zone,
  f_timestamp timestamp
);

insert into datetimes
values
  (
    0,
    '10:00',
    '10:00 BST',
    '-infinity',
    '-infinity',
    '-infinity'
  ),
  (
    1,
    '11:00',
    '11:00 BST',
    '1 year',
    '2000-10-19 10:23:54+01',
    '2000-10-19 10:23:54'
  ),
  (
    2,
    '12:00',
    '12:00 BST',
    '2 years',
    '2001-10-19 10:23:54+01',
    '2001-10-19 10:23:54'
  ),
  (
    3,
    '13:00',
    '13:00 BST',
    '3 years',
    '2001-10-19 10:23:54+01',
    '2001-10-19 10:23:54'
  ),
  (
    4,
    '14:00',
    '14:00 BST',
    '4 years',
    '2002-10-19 10:23:54+01',
    '2002-10-19 10:23:54'
  ),
  (
    5,
    '15:00',
    '15:00 BST',
    '5 years',
    '2003-10-19 10:23:54+01',
    '2003-10-19 10:23:54'
  ),
  (
    6,
    '15:00',
    '15:00 BST',
    '5 years',
    '2004-10-19 10:23:54+01',
    '2004-10-19 10:23:54'
  ),
  (
    7,
    '17:00',
    '17:00 BST',
    '7 years',
    '2005-10-19 10:23:54+01',
    '2005-10-19 10:23:54'
  ),
  (
    8,
    '18:00',
    '18:00 BST',
    '8 years',
    '2006-10-19 10:23:54+01',
    '2006-10-19 10:23:54'
  ),
  (
    9,
    '19:00',
    '19:00 BST',
    '9 years',
    '2007-10-19 10:23:54+01',
    '2007-10-19 10:23:54'
  ),
  (
    10,
    '20:00',
    '20:00 BST',
    '10 years',
    '2008-10-19 10:23:54+01',
    '2008-10-19 10:23:54'
  ),
  (
    11,
    '21:00',
    '21:00 BST',
    'infinity',
    'infinity',
    'infinity'
  );

select
  id,
  f_time,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_time
    range between
    cast('70 min' as interval) preceding
    and
    cast('2 hours' as interval) following
  );

select
  id,
  f_time,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_time desc
    range between
    '70 min' preceding
    and
    '2 hours' following
  );

select
  id,
  f_time,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_time desc
    range between
    '-70 min' preceding
    and
    '2 hours' following
  );

select
  id,
  f_time,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_time
    range between
    cast('infinity' as interval) preceding
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_time,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_time
    range between
    cast('infinity' as interval) preceding
    and
    cast('infinity' as interval) preceding
  );

select
  id,
  f_time,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_time
    range between
    cast('infinity' as interval) following
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_time,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_time
    range between
    cast('-infinity' as interval) following
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_timetz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timetz
    range between
    cast('70 min' as interval) preceding
    and
    cast('2 hours' as interval) following
  );

select
  id,
  f_timetz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timetz desc
    range between
    '70 min' preceding
    and
    '2 hours' following
  );

select
  id,
  f_timetz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timetz desc
    range between
    '70 min' preceding
    and
    '-2 hours' following
  );

select
  id,
  f_timetz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timetz
    range between
    cast('infinity' as interval) preceding
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_timetz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timetz
    range between
    cast('infinity' as interval) preceding
    and
    cast('infinity' as interval) preceding
  );

select
  id,
  f_timetz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timetz
    range between
    cast('infinity' as interval) following
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_timetz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timetz
    range between
    cast('infinity' as interval) following
    and
    cast('-infinity' as interval) following
  );

select
  id,
  f_interval,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_interval
    range between
    cast('1 year' as interval) preceding
    and
    cast('1 year' as interval) following
  );

select
  id,
  f_interval,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_interval desc
    range between
    '1 year' preceding
    and
    '1 year' following
  );

select
  id,
  f_interval,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_interval desc
    range between
    '-1 year' preceding
    and
    '1 year' following
  );

select
  id,
  f_interval,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_interval
    range between
    cast('infinity' as interval) preceding
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_interval,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_interval
    range between
    cast('infinity' as interval) preceding
    and
    cast('infinity' as interval) preceding
  );

select
  id,
  f_interval,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_interval
    range between
    cast('infinity' as interval) following
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_interval,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_interval
    range between
    cast('-infinity' as interval) following
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_timestamptz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamptz
    range between
    cast('1 year' as interval) preceding
    and
    cast('1 year' as interval) following
  );

select
  id,
  f_timestamptz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamptz desc
    range between
    '1 year' preceding
    and
    '1 year' following
  );

select
  id,
  f_timestamptz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamptz desc
    range between
    '1 year' preceding
    and
    '-1 year' following
  );

select
  id,
  f_timestamptz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamptz
    range between
    cast('infinity' as interval) preceding
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_timestamptz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamptz
    range between
    cast('infinity' as interval) preceding
    and
    cast('infinity' as interval) preceding
  );

select
  id,
  f_timestamptz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamptz
    range between
    cast('infinity' as interval) following
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_timestamptz,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamptz
    range between
    cast('-infinity' as interval) following
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_timestamp,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamp
    range between
    cast('1 year' as interval) preceding
    and
    cast('1 year' as interval) following
  );

select
  id,
  f_timestamp,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamp desc
    range between
    '1 year' preceding
    and
    '1 year' following
  );

select
  id,
  f_timestamp,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamp desc
    range between
    '-1 year' preceding
    and
    '1 year' following
  );

select
  id,
  f_timestamp,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamp
    range between
    cast('infinity' as interval) preceding
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_timestamp,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamp
    range between
    cast('infinity' as interval) preceding
    and
    cast('infinity' as interval) preceding
  );

select
  id,
  f_timestamp,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamp
    range between
    cast('infinity' as interval) following
    and
    cast('infinity' as interval) following
  );

select
  id,
  f_timestamp,
  FIRST_VALUE(id) over w,
  LAST_VALUE(id) over w
from
  datetimes
window
  w as (
    order by f_timestamp
    range between
    cast('-infinity' as interval) following
    and
    cast('infinity' as interval) following
  );

select
  SUM(
    salary
  )
  over (
    order by enroll_date,
    salary
    range between
    cast('1 year' as interval) preceding
    and
    cast('2 years' as interval) following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  SUM(
    salary
  )
  over (

    range between
    cast('1 year' as interval) preceding
    and
    cast('2 years' as interval) following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  SUM(
    salary
  )
  over (
    order by depname
    range between
    cast('1 year' as interval) preceding
    and
    cast('2 years' as interval) following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  MAX(
    enroll_date
  )
  over (
    order by enroll_date
    range between
    1 preceding
    and
    2 following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  MAX(
    enroll_date
  )
  over (
    order by salary
    range between
    -1 preceding
    and
    2 following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  MAX(
    enroll_date
  )
  over (
    order by salary
    range between
    1 preceding
    and
    -2 following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  MAX(
    enroll_date
  )
  over (
    order by salary
    range between
    cast('1 year' as interval) preceding
    and
    cast('2 years' as interval) following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  MAX(
    enroll_date
  )
  over (
    order by enroll_date
    range between
    cast('1 year' as interval) preceding
    and
    cast('-2 years' as interval) following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    unbounded preceding
    and
    current row
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    unbounded preceding
    and
    unbounded following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    current row
    and
    unbounded following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    1 preceding
    and
    unbounded following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    1 following
    and
    unbounded following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    unbounded preceding
    and
    2 following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    2 preceding
    and
    1 preceding
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    2 preceding
    and
    1 following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    0 preceding
    and
    0 following
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    2 preceding
    and
    1 following
    exclude current row
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    2 preceding
    and
    1 following
    exclude group
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    order by four
    groups between
    2 preceding
    and
    1 following
    exclude ties
  ),
  unique1,
  four
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    partition by ten
    order by four
    groups between
    0 preceding
    and
    0 following
  ),
  unique1,
  four,
  ten
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    partition by ten
    order by four
    groups between
    0 preceding
    and
    0 following
    exclude current row
  ),
  unique1,
  four,
  ten
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    partition by ten
    order by four
    groups between
    0 preceding
    and
    0 following
    exclude group
  ),
  unique1,
  four,
  ten
from
  tenk1
where
  unique1 < 10;

select
  SUM(
    unique1
  )
  over (
    partition by ten
    order by four
    groups between
    0 preceding
    and
    0 following
    exclude ties
  ),
  unique1,
  four,
  ten
from
  tenk1
where
  unique1 < 10;

select
  FIRST_VALUE(
    salary
  )
  over (
    order by enroll_date
    groups between
    1 preceding
    and
    1 following
  ),
  LEAD(
    salary
  )
  over (
    order by enroll_date
    groups between
    1 preceding
    and
    1 following
  ),
  NTH_VALUE(
    salary,
    1
  )
  over (
    order by enroll_date
    groups between
    1 preceding
    and
    1 following
  ),
  salary,
  enroll_date
from
  empsalary;

select
  LAST_VALUE(
    salary
  )
  over (
    order by enroll_date
    groups between
    1 preceding
    and
    1 following
  ),
  LAG(
    salary
  )
  over (
    order by enroll_date
    groups between
    1 preceding
    and
    1 following
  ),
  salary,
  enroll_date
from
  empsalary;

select
  FIRST_VALUE(
    salary
  )
  over (
    order by enroll_date
    groups between
    1 following
    and
    3 following
    exclude current row
  ),
  LEAD(
    salary
  )
  over (
    order by enroll_date
    groups between
    1 following
    and
    3 following
    exclude ties
  ),
  NTH_VALUE(
    salary,
    1
  )
  over (
    order by enroll_date
    groups between
    1 following
    and
    3 following
    exclude ties
  ),
  salary,
  enroll_date
from
  empsalary;

select
  LAST_VALUE(
    salary
  )
  over (
    order by enroll_date
    groups between
    1 following
    and
    3 following
    exclude group
  ),
  LAG(
    salary
  )
  over (
    order by enroll_date
    groups between
    1 following
    and
    3 following
    exclude group
  ),
  salary,
  enroll_date
from
  empsalary;

with
cte (x)
as (
  select * from generate_series(1, 35, 2)
)
select
  x,
  SUM(x) over w
from
  cte
window
  w as (
    order by x
    rows between
    1 preceding
    and
    1 following
  );

with
cte (x)
as (
  select * from generate_series(1, 35, 2)
)
select
  x,
  SUM(x) over w
from
  cte
window
  w as (
    order by x
    range between
    1 preceding
    and
    1 following
  );

with
cte (x)
as (
  select * from generate_series(1, 35, 2)
)
select
  x,
  SUM(x) over w
from
  cte
window
  w as (
    order by x
    groups between
    1 preceding
    and
    1 following
  );

with
cte (x)
as (
  select 1 union all select 1 union all select 1
  union all
  select * from generate_series(5, 49, 2)
)
select
  x,
  SUM(x) over w
from
  cte
window
  w as (
    order by x
    rows between
    1 preceding
    and
    1 following
  );

with
cte (x)
as (
  select 1 union all select 1 union all select 1
  union all
  select * from generate_series(5, 49, 2)
)
select
  x,
  SUM(x) over w
from
  cte
window
  w as (
    order by x
    range between
    1 preceding
    and
    1 following
  );

with
cte (x)
as (
  select 1 union all select 1 union all select 1
  union all
  select * from generate_series(5, 49, 2)
)
select
  x,
  SUM(x) over w
from
  cte
window
  w as (
    order by x
    groups between
    1 preceding
    and
    1 following
  );

select
  COUNT(*) over (partition by four)
from
  (
    select * from tenk1 union all select * from tenk2
  )
  as s
limit 0;

create temporary table t1 (
  f1 int,
  f2 bigint
);

insert into t1 values (1, 1), (1, 2), (2, 2);

select
  f1,
  SUM(
    f1
  )
  over (
    partition by f1
    range between
    1 preceding
    and
    1 following
  )
from
  t1
where
  f1 = f2;

select
  f1,
  SUM(
    f1
  )
  over (
    partition by f1
    order by f2
    range between
    1 preceding
    and
    1 following
  )
from
  t1
where
  f1 = f2;

select
  f1,
  SUM(
    f1
  )
  over (
    partition by f1
    order by f2
    range between
    1 preceding
    and
    1 following
  )
from
  t1
where
  f1 = f2;

select
  f1,
  SUM(
    f1
  )
  over (
    partition by f1,
    f1
    order by f2
    range between
    2 preceding
    and
    1 preceding
  )
from
  t1
where
  f1 = f2;

select
  f1,
  SUM(
    f1
  )
  over (
    partition by f1,
    f2
    order by f2
    range between
    1 following
    and
    2 following
  )
from
  t1
where
  f1 = f2;

select
  f1,
  SUM(
    f1
  )
  over (
    partition by f1
    groups between
    1 preceding
    and
    1 following
  )
from
  t1
where
  f1 = f2;

select
  f1,
  SUM(
    f1
  )
  over (
    partition by f1
    order by f2
    groups between
    1 preceding
    and
    1 following
  )
from
  t1
where
  f1 = f2;

select
  f1,
  SUM(
    f1
  )
  over (
    partition by f1
    order by f2
    groups between
    1 preceding
    and
    1 following
  )
from
  t1
where
  f1 = f2;

select
  f1,
  SUM(
    f1
  )
  over (
    partition by f1,
    f1
    order by f2
    groups between
    2 preceding
    and
    1 preceding
  )
from
  t1
where
  f1 = f2;

select
  f1,
  SUM(
    f1
  )
  over (
    partition by f1,
    f2
    order by f2
    groups between
    1 following
    and
    2 following
  )
from
  t1
where
  f1 = f2;

select RANK() over (order by length('abc'));

select RANK() over (order by RANK() over (order by random()));

select * from empsalary where ROW_NUMBER() over (order by salary) < 10;

select * from empsalary inner join tenk1 on ROW_NUMBER() over (order by salary) < 10;

select RANK() over (order by 1), COUNT(*) from empsalary group by 1;

delete from empsalary where RANK() over (order by random()) > 10;

delete from empsalary returning RANK() over (order by random());

select COUNT(*) over w from tenk1 window w as (order by unique1), w as (order by unique1);

select COUNT() over () from tenk1;

select generate_series(1, 100) over () from empsalary;

select NTILE(0) over (order by ten), ten, four from tenk1;

select NTH_VALUE(four, 0) over (order by ten), ten, four from tenk1;

select
  SUM(salary),
  ROW_NUMBER() over (order by depname),
  SUM(
    SUM(
      salary
    )
    filter (where
      enroll_date > '2007-01-01')
  )
  filter (where
    depname <> 'sales')
  over (
    order by depname desc
  )
  as filtered_sum,
  depname
from
  empsalary
group by depname;

select
  empno,
  depname,
  ROW_NUMBER()
  over (
    partition by depname
    order by enroll_date
  )
  as rn,
  RANK()
  over (
    partition by depname
    order by enroll_date
    rows between
    unbounded preceding
    and
    unbounded following
  )
  as rnk,
  DENSE_RANK()
  over (
    partition by depname
    order by enroll_date
    range between
    current row
    and
    current row
  )
  as drnk,
  NTILE(
    10
  )
  over (
    partition by depname
    order by enroll_date
    range between
    current row
    and
    unbounded following
  )
  as nt,
  PERCENT_RANK()
  over (
    partition by depname
    order by enroll_date
    rows between
    current row
    and
    unbounded following
  )
  as pr,
  CUME_DIST()
  over (
    partition by depname
    order by enroll_date
    range between
    current row
    and
    unbounded following
  )
  as cd
from
  empsalary;

select
  empno,
  depname,
  ROW_NUMBER()
  over (
    partition by depname
    order by enroll_date
  )
  as rn,
  RANK()
  over (
    partition by depname
    order by enroll_date
    rows between
    unbounded preceding
    and
    unbounded following
  )
  as rnk,
  COUNT(
    *
  )
  over (
    partition by depname
    order by enroll_date
    range between
    current row
    and
    current row
  )
  as cnt
from
  empsalary;

select
  empno,
  depname,
  ROW_NUMBER()
  over (
    partition by depname
    order by enroll_date
  )
  as rn,
  RANK()
  over (
    partition by depname
    order by enroll_date
    rows between
    unbounded preceding
    and
    unbounded following
  )
  as rnk,
  COUNT(
    *
  )
  over (
    partition by depname
    order by enroll_date
    range between
    current row
    and
    current row
  )
  as cnt
from
  empsalary;

select
  *
from
  (
    select
      depname,
      SUM(salary) over (partition by depname)
      as depsalary,
      MIN(
        salary
      )
      over (
        partition by depname || 'A',
        depname
      )
      as depminsalary
    from
      empsalary
  )
  as emp
where
  depname = 'sales';

select
  *
from
  (
    select
      depname,
      SUM(salary) over (partition by enroll_date)
      as enroll_salary,
      MIN(salary) over (partition by depname)
      as depminsalary
    from
      empsalary
  )
  as emp
where
  depname = 'sales';

select
  *
from
  (
    select
      empno,
      ROW_NUMBER() over (order by empno) as rn
    from
      empsalary
  )
  as emp
where
  rn < 3;

select
  *
from
  (
    select
      empno,
      ROW_NUMBER() over (order by empno) as rn
    from
      empsalary
  )
  as emp
where
  rn < 3;

select
  *
from
  (
    select
      empno,
      ROW_NUMBER() over (order by empno) as rn
    from
      empsalary
  )
  as emp
where
  3 > rn;

select
  *
from
  (
    select
      empno,
      ROW_NUMBER() over (order by empno) as rn
    from
      empsalary
  )
  as emp
where
  2 >= rn;

select
  *
from
  (
    select
      empno,
      salary,
      RANK() over (order by salary desc) as r
    from
      empsalary
  )
  as emp
where
  r <= 3;

select
  *
from
  (
    select
      empno,
      salary,
      RANK() over (order by salary desc) as r
    from
      empsalary
  )
  as emp
where
  r <= 3;

select
  *
from
  (
    select
      empno,
      salary,
      DENSE_RANK() over (order by salary desc) as dr
    from
      empsalary
  )
  as emp
where
  dr = 1;

select
  *
from
  (
    select
      empno,
      salary,
      DENSE_RANK() over (order by salary desc) as dr
    from
      empsalary
  )
  as emp
where
  dr = 1;

select
  *
from
  (
    select
      empno,
      salary,
      COUNT(*) over (order by salary desc) as c
    from
      empsalary
  )
  as emp
where
  c <= 3;

select
  *
from
  (
    select
      empno,
      salary,
      COUNT(*) over (order by salary desc) as c
    from
      empsalary
  )
  as emp
where
  c <= 3;

select
  *
from
  (
    select
      empno,
      salary,
      COUNT(empno) over (order by salary desc) as c
    from
      empsalary
  )
  as emp
where
  c <= 3;

select
  *
from
  (
    select
      empno,
      salary,
      COUNT(empno) over (order by salary desc) as c
    from
      empsalary
  )
  as emp
where
  c <= 3;

select
  *
from
  (
    select
      empno,
      salary,
      COUNT(
        *
      )
      over (
        order by salary desc
        rows between
        current row
        and
        unbounded following
      )
      as c
    from
      empsalary
  )
  as emp
where
  c >= 3;

select * from (select empno, salary, COUNT(*) over () as c from empsalary) as emp where 11 <= c;

select
  *
from
  (
    select
      empno,
      salary,
      COUNT(*) over (order by salary desc) as c,
      DENSE_RANK() over (order by salary desc) as dr
    from
      empsalary
  )
  as emp
where
  dr = 1;

select
  *
from
  (
    select
      empno,
      depname,
      ROW_NUMBER()
      over (
        partition by depname
        order by empno
      )
      as rn
    from
      empsalary
  )
  as emp
where
  rn < 3;

select
  *
from
  (
    select
      empno,
      depname,
      ROW_NUMBER()
      over (
        partition by depname
        order by empno
      )
      as rn
    from
      empsalary
  )
  as emp
where
  rn < 3;

select
  empno,
  depname
from
  (
    select
      empno,
      depname,
      ROW_NUMBER()
      over (
        partition by depname
        order by empno
      )
      as rn
    from
      empsalary
  )
  as emp
where
  rn < 3;

select
  *
from
  (
    select
      empno,
      depname,
      salary,
      COUNT(
        empno
      )
      over (
        partition by depname
        order by salary desc
      )
      as c
    from
      empsalary
  )
  as emp
where
  c <= 3;

select
  *
from
  (
    select
      empno,
      depname,
      salary,
      COUNT(
        empno
      )
      over (
        partition by depname
        order by salary desc
      )
      as c
    from
      empsalary
  )
  as emp
where
  c <= 3;

select
  *
from
  (
    select
      empno,
      depname,
      salary,
      COUNT(empno) over () as c
    from
      empsalary
  )
  as emp
where
  c = 1;

select
  *
from
  (
    select
      ROW_NUMBER() over (partition by salary) as rn,
      LEAD(depname) over (partition by salary) ||
      ' Department'
      as n_dep
    from
      empsalary
  )
  as emp
where
  rn < 1;

select
  *
from
  (
    select
      *,
      COUNT(salary) over (partition by depname || '')
      as c1,
      ROW_NUMBER() over (partition by depname) as rn,
      COUNT(*) over (partition by depname) as c2,
      COUNT(*) over (partition by '' || depname) as c3,
      NTILE(2) over (partition by depname) as nt
    from
      empsalary
  )
  as e
where
  rn <= 1 and c1 <= 3 and nt < 2;

select
  *
from
  (
    select
      *,
      COUNT(salary) over (partition by depname || '')
      as c1,
      ROW_NUMBER() over (partition by depname) as rn,
      COUNT(*) over (partition by depname) as c2,
      COUNT(*) over (partition by '' || depname) as c3,
      NTILE(2) over (partition by depname) as nt
    from
      empsalary
  )
  as e
where
  rn <= 1 and c1 <= 3 and nt < 2;

select
  1
from
  (
    select
      NTILE(e2.salary) over (partition by e1.depname)
      as c
    from
      empsalary as e1
      left outer join
        empsalary as e2
      on true
    where
      e1.empno = e2.empno
  )
  as s
where
  s.c = 1;

select
  1
from
  (
    select
      NTILE(s1.x) over () as c
    from
      (select (select 1) as x) as s1
  )
  as s
where
  s.c = 1;

select
  *
from
  (
    select
      empno,
      salary,
      COUNT(
        *
      )
      over (
        order by salary desc
        rows between
        current row
        and
        unbounded following
      )
      as c
    from
      empsalary
  )
  as emp
where
  c <= 3;

select
  *
from
  (
    select
      empno,
      salary,
      COUNT(*) over (order by salary) as c
    from
      empsalary
  )
  as emp
where
  3 <= c;

select
  *
from
  (
    select
      empno,
      salary,
      COUNT(random()) over (order by empno desc) as c
    from
      empsalary
  )
  as emp
where
  c = 1;

select
  *
from
  (
    select
      empno,
      salary,
      COUNT((select 1)) over (order by empno desc) as c
    from
      empsalary
  )
  as emp
where
  c = 1;

select
  *
from
  (
    select
      depname,
      SUM(
        salary
      )
      over (
        partition by depname
        order by empno
      )
      as depsalary,
      MIN(
        salary
      )
      over (
        partition by depname,
        empno
        order by enroll_date
      )
      as depminsalary
    from
      empsalary
  )
  as emp
where
  depname = 'sales';

select
  empno,
  enroll_date,
  depname,
  SUM(
    salary
  )
  over (
    partition by depname
    order by empno
  )
  as depsalary,
  MIN(
    salary
  )
  over (
    partition by depname
    order by enroll_date
  )
  as depminsalary
from
  empsalary
order by depname,
  empno;

select
  empno,
  enroll_date,
  depname,
  SUM(
    salary
  )
  over (
    partition by depname
    order by empno
  )
  as depsalary,
  MIN(
    salary
  )
  over (
    partition by depname
    order by enroll_date
  )
  as depminsalary
from
  empsalary
order by depname,
  enroll_date;

set enable_hashagg = off;

select distinct
  empno,
  enroll_date,
  depname,
  SUM(
    salary
  )
  over (
    partition by depname
    order by empno
  )
  as depsalary,
  MIN(
    salary
  )
  over (
    partition by depname
    order by enroll_date
  )
  as depminsalary
from
  empsalary
order by depname,
  enroll_date;

select distinct
  empno,
  enroll_date,
  depname,
  SUM(
    salary
  )
  over (
    partition by depname
    order by empno
  )
  as depsalary,
  MIN(
    salary
  )
  over (
    partition by depname
    order by enroll_date
  )
  as depminsalary
from
  empsalary
order by depname,
  empno;

reset enable_hashagg;

select
  LEAD(
    1
  )
  over (
    partition by depname
    order by salary,
    enroll_date
  ),
  LAG(
    1
  )
  over (
    partition by depname
    order by salary,
    enroll_date,
    empno
  )
from
  empsalary;

select
  *
from
  (
    select
      depname,
      empno,
      salary,
      enroll_date,
      ROW_NUMBER()
      over (
        partition by depname
        order by enroll_date
      )
      as first_emp,
      ROW_NUMBER()
      over (
        partition by depname
        order by enroll_date desc
      )
      as last_emp
    from
      empsalary
  )
  as emp
where
  first_emp = 1 or last_emp = 1;

select
  *
from
  (
    select
      depname,
      empno,
      salary,
      enroll_date,
      ROW_NUMBER()
      over (
        partition by depname
        order by enroll_date
      )
      as first_emp,
      ROW_NUMBER()
      over (
        partition by depname
        order by enroll_date desc
      )
      as last_emp
    from
      empsalary
  )
  as emp
where
  first_emp = 1 or last_emp = 1;

drop table empsalary;

create function nth_value_def(val anyelement, n int default 1)
returns anyelement
language internal
window
immutable
strict
as $function$
window_nth_value
$function$;

select
  nth_value_def(
    "n" := 2,
    "val" := ten
  )
  over (
    partition by four
  ),
  ten,
  four
from
  (
    select
      *
    from
      tenk1
    where
      unique2 < 10
    order by four,
      ten
  )
  as s;

select
  nth_value_def(ten) over (partition by four),
  ten,
  four
from
  (
    select
      *
    from
      tenk1
    where
      unique2 < 10
    order by four,
      ten
  )
  as s;

create function logging_sfunc_nonstrict(text, anyelement)
returns text
language sql
immutable
as $function$
SELECT COALESCE($1, '') || '*' || quote_nullable($2)
$function$;

create function logging_msfunc_nonstrict(text, anyelement)
returns text
language sql
immutable
as $function$
SELECT COALESCE($1, '') || '+' || quote_nullable($2)
$function$;

create function logging_minvfunc_nonstrict(text, anyelement)
returns text
language sql
immutable
as $function$
SELECT $1 || '-' || quote_nullable($2)
$function$;

create aggregate logging_agg_nonstrict (
  anyelement
) (
  stype = text,
  sfunc = logging_sfunc_nonstrict,
  mstype = text,
  msfunc = logging_msfunc_nonstrict,
  minvfunc = logging_minvfunc_nonstrict
);

create aggregate logging_agg_nonstrict_initcond (
  anyelement
) (
  stype = text,
  sfunc = logging_sfunc_nonstrict,
  mstype = text,
  msfunc = logging_msfunc_nonstrict,
  minvfunc = logging_minvfunc_nonstrict,
  initcond = 'I',
  minitcond = 'MI'
);

create function logging_sfunc_strict(text, anyelement)
returns text
language sql
immutable
strict
as $function$
SELECT $1 || '*' || quote_nullable($2)
$function$;

create function logging_msfunc_strict(text, anyelement)
returns text
language sql
immutable
strict
as $function$
SELECT $1 || '+' || quote_nullable($2)
$function$;

create function logging_minvfunc_strict(text, anyelement)
returns text
language sql
immutable
strict
as $function$
SELECT $1 || '-' || quote_nullable($2)
$function$;

create aggregate logging_agg_strict (
  text
) (
  stype = text,
  sfunc = logging_sfunc_strict,
  mstype = text,
  msfunc = logging_msfunc_strict,
  minvfunc = logging_minvfunc_strict
);

create aggregate logging_agg_strict_initcond (
  anyelement
) (
  stype = text,
  sfunc = logging_sfunc_strict,
  mstype = text,
  msfunc = logging_msfunc_strict,
  minvfunc = logging_minvfunc_strict,
  initcond = 'I',
  minitcond = 'MI'
);

select
  cast(p as text) || ',' || cast(i as text) || ':' ||
  coalesce(cast(v as text), 'NULL')
  as row,
  logging_agg_nonstrict(v) over wnd as nstrict,
  logging_agg_nonstrict_initcond(v) over wnd
  as nstrict_init,
  logging_agg_strict(cast(v as text)) over wnd
  as strict,
  logging_agg_strict_initcond(v) over wnd
  as strict_init
from
  (
    values
      (1, 1, null),
      (1, 2, 'a'),
      (1, 3, 'b'),
      (1, 4, null),
      (1, 5, null),
      (1, 6, 'c'),
      (2, 1, null),
      (2, 2, 'x'),
      (3, 1, 'z')
  )
  as t (p, i, v)
window
  wnd as (
    partition by p
    order by i
    rows between
    1 preceding
    and
    current row
  )
order by p,
  i;

select
  cast(p as text) || ',' || cast(i as text) || ':' ||
  case
    when f then coalesce(cast(v as text), 'NULL')
    else '-'
  end
  as row,
  logging_agg_nonstrict(v) filter (where f) over wnd
  as nstrict_filt,
  logging_agg_nonstrict_initcond(
    v
  )
  filter (where
    f)
  over wnd
  as nstrict_init_filt,
  logging_agg_strict(
    cast(v as text)
  )
  filter (where
    f)
  over wnd
  as strict_filt,
  logging_agg_strict_initcond(
    v
  )
  filter (where
    f)
  over wnd
  as strict_init_filt
from
  (
    values
      (1, 1, true, null),
      (1, 2, false, 'a'),
      (1, 3, true, 'b'),
      (1, 4, false, null),
      (1, 5, false, null),
      (1, 6, false, 'c'),
      (2, 1, false, null),
      (2, 2, true, 'x'),
      (3, 1, true, 'z')
  )
  as t (p, i, f, v)
window
  wnd as (
    partition by p
    order by i
    rows between
    1 preceding
    and
    current row
  )
order by p,
  i;

select
  cast(i as text) || ':' ||
  coalesce(cast(v as text), 'NULL')
  as row,
  logging_agg_strict(cast(v as text)) over wnd
  as inverse,
  logging_agg_strict(
    cast(v as text) ||
    case when random() < 0 then '?' else '' end
  )
  over wnd
  as noinverse
from
  (values (1, 'a'), (2, 'b'), (3, 'c')) as t (i, v)
window
  wnd as (
    order by i
    rows between
    1 preceding
    and
    current row
  )
order by i;

select
  cast(i as text) || ':' ||
  coalesce(cast(v as text), 'NULL')
  as row,
  logging_agg_strict(
    cast(v as text)
  )
  filter (where
    true)
  over wnd
  as inverse,
  logging_agg_strict(
    cast(v as text)
  )
  filter (where
    random() >= 0)
  over wnd
  as noinverse
from
  (values (1, 'a'), (2, 'b'), (3, 'c')) as t (i, v)
window
  wnd as (
    order by i
    rows between
    1 preceding
    and
    current row
  )
order by i;

select
  logging_agg_strict(cast(v as text)) over wnd
from
  (values (1, 'a'), (2, 'b'), (3, 'c')) as t (i, v)
window
  wnd as (
    order by i
    rows between
    current row
    and
    current row
  )
order by i;

create function sum_int_randrestart_minvfunc(int, int)
returns int
language sql
strict
as $function$
SELECT CASE WHEN random() < 0.2 THEN NULL ELSE $1 - $2 END
$function$;

create aggregate sum_int_randomrestart (
  int
) (
  stype = int,
  sfunc = int4pl,
  mstype = int,
  msfunc = int4pl,
  minvfunc = sum_int_randrestart_minvfunc
);

with
vs
as (
  select
    i,
    cast(random() * 100 as int) as v
  from
    generate_series(1, 100) as i
),
sum_following
as (
  select
    i,
    SUM(
      v
    )
    over (
      order by i desc
      rows between
      unbounded preceding
      and
      current row
    )
    as s
  from
    vs
)
select distinct
  sum_following.s =
  sum_int_randomrestart(v) over fwd
  as eq1,
  -sum_following.s =
  sum_int_randomrestart(-v) over fwd
  as eq2,
  100 * 3 + (vs.i - 1) * 3 =
  length(
    logging_agg_nonstrict(cast('' as text)) over fwd
  )
  as eq3
from
  vs
  inner join
    sum_following
  on sum_following.i = vs.i
window
  fwd as (
    order by vs.i
    rows between
    current row
    and
    unbounded following
  );

select
  i,
  AVG(
    cast(v as bigint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values (1, 1), (2, 2), (3, null), (4, null)
  )
  as t (i, v);

select
  i,
  AVG(
    cast(v as int)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values (1, 1), (2, 2), (3, null), (4, null)
  )
  as t (i, v);

select
  i,
  AVG(
    cast(v as smallint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values (1, 1), (2, 2), (3, null), (4, null)
  )
  as t (i, v);

select
  i,
  AVG(
    cast(v as numeric)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values (1, 1.5), (2, 2.5), (3, null), (4, null)
  )
  as t (i, v);

select
  i,
  AVG(
    cast(v as interval)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, '1 sec'),
      (2, '2 sec'),
      (3, null),
      (4, null)
  )
  as t (i, v);

select
  x,
  AVG(
    x
  )
  over (

    rows between
    current row
    and
    1 following
  )
  as curr_next_avg,
  AVG(
    x
  )
  over (

    rows between
    1 preceding
    and
    current row
  )
  as prev_curr_avg,
  SUM(
    x
  )
  over (

    rows between
    current row
    and
    1 following
  )
  as curr_next_sum,
  SUM(
    x
  )
  over (

    rows between
    1 preceding
    and
    current row
  )
  as prev_curr_sum
from
  (
    values
      (cast(null as interval)),
      (cast('infinity' as interval)),
      (
        '-2147483648 days -2147483648 months -9223372036854775807 usecs'
      ),
      (cast('-infinity' as interval)),
      (
        '2147483647 days 2147483647 months 9223372036854775806 usecs'
      ),
      (cast('infinity' as interval)),
      (cast('6 days' as interval)),
      (cast('7 days' as interval)),
      (cast(null as interval)),
      (cast('-infinity' as interval))
  )
  as v (x);

select
  x,
  AVG(
    x
  )
  over (

    rows between
    current row
    and
    2 following
  )
from
  (
    values
      (cast(null as interval)),
      (cast('3 days' as interval)),
      (
        cast('infinity' as timestamp with time zone) -
        NOW()
      ),
      (cast('6 days' as interval)),
      (cast('-infinity' as interval))
  )
  as v (x);

select
  x,
  SUM(
    x
  )
  over (

    rows between
    current row
    and
    2 following
  )
from
  (
    values
      (cast(null as interval)),
      (cast('3 days' as interval)),
      (
        cast('infinity' as timestamp with time zone) -
        NOW()
      ),
      (cast('6 days' as interval)),
      (cast('-infinity' as interval))
  )
  as v (x);

select
  i,
  SUM(
    cast(v as smallint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values (1, 1), (2, 2), (3, null), (4, null)
  )
  as t (i, v);

select
  i,
  SUM(
    cast(v as int)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values (1, 1), (2, 2), (3, null), (4, null)
  )
  as t (i, v);

select
  i,
  SUM(
    cast(v as bigint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values (1, 1), (2, 2), (3, null), (4, null)
  )
  as t (i, v);

select
  i,
  SUM(
    cast(v as money)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, '1.10'),
      (2, '2.20'),
      (3, null),
      (4, null)
  )
  as t (i, v);

select
  i,
  SUM(
    cast(v as interval)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, '1 sec'),
      (2, '2 sec'),
      (3, null),
      (4, null)
  )
  as t (i, v);

select
  i,
  SUM(
    cast(v as numeric)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values (1, 1.1), (2, 2.2), (3, null), (4, null)
  )
  as t (i, v);

select
  SUM(
    cast(n as numeric)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (values (1, 1.01), (2, 2), (3, 3)) as v (i, n);

select
  i,
  COUNT(
    v
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values (1, 1), (2, 2), (3, null), (4, null)
  )
  as t (i, v);

select
  i,
  COUNT(
    *
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values (1, 1), (2, 2), (3, null), (4, null)
  )
  as t (i, v);

select
  var_pop(
    cast(n as bigint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  var_pop(
    cast(n as int)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  var_pop(
    cast(n as smallint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  var_pop(
    cast(n as numeric)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  var_samp(
    cast(n as bigint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  var_samp(
    cast(n as int)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  var_samp(
    cast(n as smallint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  var_samp(
    cast(n as numeric)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  variance(
    cast(n as bigint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  variance(
    cast(n as int)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  variance(
    cast(n as smallint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  variance(
    cast(n as numeric)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  stddev_pop(
    cast(n as bigint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, null),
      (2, 600),
      (3, 470),
      (4, 170),
      (5, 430),
      (6, 300)
  )
  as r (i, n);

select
  stddev_pop(
    cast(n as int)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, null),
      (2, 600),
      (3, 470),
      (4, 170),
      (5, 430),
      (6, 300)
  )
  as r (i, n);

select
  stddev_pop(
    cast(n as smallint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, null),
      (2, 600),
      (3, 470),
      (4, 170),
      (5, 430),
      (6, 300)
  )
  as r (i, n);

select
  stddev_pop(
    cast(n as numeric)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, null),
      (2, 600),
      (3, 470),
      (4, 170),
      (5, 430),
      (6, 300)
  )
  as r (i, n);

select
  stddev_samp(
    cast(n as bigint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, null),
      (2, 600),
      (3, 470),
      (4, 170),
      (5, 430),
      (6, 300)
  )
  as r (i, n);

select
  stddev_samp(
    cast(n as int)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, null),
      (2, 600),
      (3, 470),
      (4, 170),
      (5, 430),
      (6, 300)
  )
  as r (i, n);

select
  stddev_samp(
    cast(n as smallint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, null),
      (2, 600),
      (3, 470),
      (4, 170),
      (5, 430),
      (6, 300)
  )
  as r (i, n);

select
  stddev_samp(
    cast(n as numeric)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (1, null),
      (2, 600),
      (3, 470),
      (4, 170),
      (5, 430),
      (6, 300)
  )
  as r (i, n);

select
  stddev(
    cast(n as bigint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (0, null),
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  stddev(
    cast(n as int)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (0, null),
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  stddev(
    cast(n as smallint)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (0, null),
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  stddev(
    cast(n as numeric)
  )
  over (
    order by i
    rows between
    current row
    and
    unbounded following
  )
from
  (
    values
      (0, null),
      (1, 600),
      (2, 470),
      (3, 170),
      (4, 430),
      (5, 300)
  )
  as r (i, n);

select
  i,
  SUM(
    cast(v as int)
  )
  over (
    order by i
    rows between
    current row
    and
    current row
  )
from
  (
    values (1, 1), (2, 2), (3, null), (4, null)
  )
  as t (i, v);

select
  i,
  SUM(
    cast(v as int)
  )
  over (
    order by i
    rows between
    current row
    and
    1 following
  )
from
  (
    values (1, 1), (2, 2), (3, null), (4, null)
  )
  as t (i, v);

select
  i,
  SUM(
    cast(v as int)
  )
  over (
    order by i
    rows between
    1 preceding
    and
    1 following
  )
from
  (
    values (1, 1), (2, 2), (3, 3), (4, 4)
  )
  as t (i, v);

select
  a,
  b,
  SUM(
    b
  )
  over (
    order by a
    rows between
    1 preceding
    and
    current row
  )
from
  (
    values
      (1, cast(1 as numeric)),
      (2, 2),
      (3, 'NaN'),
      (4, 3),
      (5, 4)
  )
  as t (a, b);

select
  to_char(
    SUM(
      cast(n as double precision)
    )
    over (
      order by i
      rows between
      current row
      and
      1 following
    ),
    '999999999999999999999D9'
  )
from
  (values (1, 1e20), (2, 1)) as n (i, n);

select
  i,
  b,
  bool_and(b) over w,
  bool_or(b) over w
from
  (
    values
      (1, true),
      (2, true),
      (3, false),
      (4, false),
      (5, true)
  )
  as v (i, b)
window
  w as (
    order by i
    rows between
    current row
    and
    1 following
  );

select
  COUNT(*) over (order by t1.unique1)
from
  tenk1 as t1
  inner join
    tenk1 as t2
  on t1.unique1 = t2.tenthous
limit 1;

select
  COUNT(*) over ()
from
  tenk1 as t1
  inner join
    tenk1 as t2
  on t1.unique1 = t2.tenthous
where
  t2.two = 1
limit 1;

select
  COUNT(
    *
  )
  over (
    order by t1.unique1
    rows between
    unbounded preceding
    and
    unbounded following
  )
from
  tenk1 as t1
  inner join
    tenk1 as t2
  on t1.unique1 = t2.tenthous
limit 1;

select
  COUNT(
    *
  )
  over (
    order by t1.unique1
    rows between
    unbounded preceding
    and
    10000 following
  )
from
  tenk1 as t1
  inner join
    tenk1 as t2
  on t1.unique1 = t2.tenthous
limit 1;

select
  array_agg(i) over w
from
  generate_series(1, 5) as i
window
  w as (
    order by i
    rows between
    cast('foo' < 'foobar' as int) preceding
    and
    current row
  );

create function pg_temp.f(group_size bigint)
returns setof int[]
language sql
stable
as $function$
SELECT array_agg(s) OVER w
      FROM generate_series(1,5) s
    WINDOW w AS (ORDER BY s ROWS BETWEEN CURRENT ROW AND GROUP_SIZE FOLLOWING)
$function$;

select * from pg_temp.f(2);

select * from pg_temp.f(2);
