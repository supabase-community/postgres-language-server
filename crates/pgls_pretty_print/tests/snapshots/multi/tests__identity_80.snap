---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/identity.sql
snapshot_kind: text
---
select
  attrelid,
  attname,
  attidentity
from
  pg_attribute
where
  attidentity not in ('', 'a', 'd');

create table itest1 (
  a int generated by default as identity,
  b text
);

create table itest2 (
  a bigint generated always as identity,
  b text
);

create table itest3 (
  a smallint
  generated by default
  as identity
  (start with 7
  increment by 5),
  b text
);

alter table itest3
  alter column a
  add generated always as identity;

select
  table_name,
  column_name,
  column_default,
  is_nullable,
  is_identity,
  identity_generation,
  identity_start,
  identity_increment,
  identity_maximum,
  identity_minimum,
  identity_cycle
from
  information_schema.columns
where
  table_name like 'itest_'
order by 1,
  2;

select
  sequence_name
from
  information_schema.sequences
where
  sequence_name like 'itest%';

select pg_get_serial_sequence('itest1', 'a');

create table itest4 (
  a int,
  b text
);

alter table itest4
  alter column a
  add generated always as identity;

alter table itest4
  alter column a set not null;

alter table itest4
  alter column c
  add generated always as identity;

alter table itest4
  alter column a
  add generated always as identity;

alter table itest4
  alter column a drop not null;

alter table itest4
  alter column a
  add generated always as identity;

alter table itest4
  alter column b
  add generated always as identity;

alter table itest4
  alter column b set default '';

create table itest_err_1 (a text generated by default as identity);

create table itest_err_2 (
  a int
  generated always as identity
  generated by default as identity
);

create table itest_err_3 (a int default 5 generated by default as identity);

create table itest_err_4 (a serial generated by default as identity);

insert into itest1 default values;

insert into itest1 default values;

insert into itest2 default values;

insert into itest2 default values;

insert into itest3 default values;

insert into itest3 default values;

insert into itest4 default values;

insert into itest4 default values;

select * from itest1;

select * from itest2;

select * from itest3;

select * from itest4;

create table itest5 (
  a int generated always as identity,
  b text
);

insert into itest5 values (1, 'a');

insert into itest5 values (default, 'a');

insert into itest5 values (2, 'b'), (3, 'c');

insert into itest5 values (default, 'b'), (3, 'c');

insert into itest5 values (2, 'b'), (default, 'c');

insert into itest5 values (default, 'b'), (default, 'c');

insert into itest5 overriding system value values (-1, 'aa');

insert into itest5 overriding system value values (-2, 'bb'), (-3, 'cc');

insert into itest5 overriding system value values (default, 'dd'), (-4, 'ee');

insert into itest5 overriding system value values (-5, 'ff'), (default, 'gg');

insert into itest5
overriding system value
values (default, 'hh'), (default, 'ii');

insert into itest5 overriding user value values (-1, 'aaa');

insert into itest5 overriding user value values (-2, 'bbb'), (-3, 'ccc');

insert into itest5 overriding user value values (default, 'ddd'), (-4, 'eee');

insert into itest5 overriding user value values (-5, 'fff'), (default, 'ggg');

insert into itest5
overriding user value
values
  (default, 'hhh'),
  (default, 'iii');

select * from itest5;

drop table itest5;

insert into itest3 values (default, 'a');

insert into itest3 values (default, 'b'), (default, 'c');

select * from itest3;

insert into itest1 values (10, 'xyz');

insert into itest1 overriding system value values (20, 'xyz');

insert into itest1 overriding user value values (30, 'xyz');

select * from itest1;

insert into itest2 values (10, 'xyz');

insert into itest2 overriding system value values (20, 'xyz');

insert into itest2 overriding user value values (30, 'xyz');

select * from itest2;

update itest1 set a = 101 where a = 1;

update itest1 set a = default where a = 2;

select * from itest1;

update itest2 set a = 101 where a = 1;

update itest2 set a = default where a = 2;

select * from itest2;

create table itest9 (
  a int generated always as identity,
  b text,
  c bigint
);

select * from itest9 order by c;

alter table itest4
  alter column a drop identity;

alter table itest4
  alter column a drop identity;

alter table itest4
  alter column a drop identity if exists;

insert into itest4 default values;

alter table itest4
  alter column a drop not null;

insert into itest4 default values;

select * from itest4;

select sequence_name from itest4_a_seq;

create table itest10 (
  a int generated by default as identity,
  b text
);

create table itest11 (
  a int generated always as identity,
  b text
);

create view itestv10
as select * from itest10;

create view itestv11
as select * from itest11;

insert into itestv10 default values;

insert into itestv10 default values;

insert into itestv11 default values;

insert into itestv11 default values;

select * from itestv10;

select * from itestv11;

insert into itestv10 values (10, 'xyz');

insert into itestv10 overriding user value values (11, 'xyz');

select * from itestv10;

insert into itestv11 values (10, 'xyz');

insert into itestv11 overriding system value values (11, 'xyz');

select * from itestv11;

drop view itestv10, itestv11;

create table itest13 (a int);

alter table itest13
  add column b int generated by default as identity;

insert into itest13 values (1), (2), (3);

alter table itest13
  add column c int generated by default as identity;

select * from itest13;

alter table itest1
  alter column a set default 1;

create table itest5 (
  a serial,
  b text
);

alter table itest5
  alter column a
  add generated always as identity;

alter table itest3
  alter column a type int;

select
  cast(seqtypid as regtype)
from
  pg_sequence
where
  seqrelid =
  cast('itest3_a_seq' as regclass);

alter table itest3
  alter column a type text;

create unlogged table itest17 (
  a int not null,
  b text
);

alter table itest17
  alter column a
  add generated always as identity;

alter table itest17
  add column c int generated always as identity;

create table itest18 (
  a int not null,
  b text
);

alter table itest18
  set unlogged,
  alter column a
  add generated always as identity;

alter table itest18
  set logged;

alter table itest18
  set unlogged;

alter table itest3
  add column c int generated by default as identity,
  alter column c set generated always;

create table itest6 (
  a int generated always as identity,
  b text
);

insert into itest6 default values;
