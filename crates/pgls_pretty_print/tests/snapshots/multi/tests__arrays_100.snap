---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/arrays.sql
snapshot_kind: text
---
create table arrtest (
  a SMALLINT[],
  b INT[][][],
  c NAME[],
  d TEXT[][],
  e DOUBLE PRECISION[],
  f CHAR(5)[],
  g VARCHAR(5)[]
);

create table array_op_test (
  seqno INT,
  i INT[],
  t TEXT[]
);

copy array_op_test from 'filename';

analyze array_op_test;

insert into arrtest (a[1:5], b[1:1][1:2][1:2], c, d, f, g)
values
  (
    '{1,2,3,4,5}',
    '{{{0,0},{1,2}}}',
    '{}',
    '{}',
    '{}',
    '{}'
  );

update arrtest set e[0] = '1.1';

update arrtest set e[1] = '2.2';

insert into arrtest (f) values ('{"too long"}');

insert into arrtest (a, b[1:2][1:2], c, d, e, f, g)
values
  (
    '{11,12,23}',
    '{{3,4},{4,5}}',
    '{"foobar"}',
    '{{"elt1", "elt2"}}',
    '{"3.4", "6.7"}',
    '{"abc","abcde"}',
    '{"abc","abcde"}'
  );

insert into arrtest (a, b[1:2], c, d[1:2]) values ('{}', '{3,4}', '{foo,bar}', '{bar,foo}');

insert into arrtest (b[2]) values (NOW());

insert into arrtest (b[1:2]) values (NOW());

select * from arrtest;

select arrtest.a[1], arrtest.b[1][1][1], arrtest.c[1], arrtest.d[1][1], arrtest.e[0] from arrtest;

select a[1], b[1][1][1], c[1], d[1][1], e[0] from arrtest;

select a[1:3], b[1:1][1:2][1:2], c[1:2], d[1:1][1:2] from arrtest;

select array_ndims(a) as a, array_ndims(b) as b, array_ndims(c) as c from arrtest;

select array_dims(a) as a, array_dims(b) as b, array_dims(c) as c from arrtest;

select * from arrtest where a[1] < 5 and c = cast('{"foobar"}' as _name);

update arrtest set a[1:2] = '{16,25}' where not a = cast('{}' as _int2);

update arrtest
set b[1:1][1:1][1:2] = '{113, 117}',
b[1:1][1:2][2:2] = '{142, 147}'
where
  array_dims(b) = '[1:1][1:2][1:2]';

update arrtest set c[2:2] = '{"new_word"}' where array_dims(c) is not null;

select a, b, c from arrtest;

select a[1:3], b[1:1][1:2][1:2], c[1:2], d[1:1][2:2] from arrtest;

select b[1:1][2][2], d[1:1][2] from arrtest;

insert into arrtest (a) values ('{1,null,3}');

select a from arrtest;

update arrtest set a[4] = null where a[2] is null;

select a from arrtest where a[2] is null;

delete from arrtest where a[2] is null and b is null;

select a, b, c from arrtest;

select pg_input_is_valid('{1,2,3}', 'integer[]');

select pg_input_is_valid('{1,2', 'integer[]');

select pg_input_is_valid('{1,zed}', 'integer[]');

select * from pg_input_error_info('{1,zed}', 'integer[]');

select cast('{{1,2,3},{4,5,6},{7,8,9}}' as INT[]);

select (cast('{{1,2,3},{4,5,6},{7,8,9}}' as INT[]))[1:2][2];

select cast('[0:2][0:2]={{1,2,3},{4,5,6},{7,8,9}}' as INT[]);

select (cast('[0:2][0:2]={{1,2,3},{4,5,6},{7,8,9}}' as INT[]))[1:2][2];

select (cast('{}' as INT[]))[1][2][3][4][5][6][7];

select (cast('{{{1},{2},{3}},{{4},{5},{6}}}' as INT[]))[1][null][1];

select (cast('{{{1},{2},{3}},{{4},{5},{6}}}' as INT[]))[1][null:1][1];

select (cast('{{{1},{2},{3}},{{4},{5},{6}}}' as INT[]))[1][1:null][1];

update arrtest set c[null] = '{"can''t assign"}' where array_dims(c) is not null;

update arrtest set c[null:1] = '{"can''t assign"}' where array_dims(c) is not null;

update arrtest set c[1:null] = '{"can''t assign"}' where array_dims(c) is not null;

select (NOW())[1];

create temporary table arrtest_s (
  a SMALLINT[],
  b SMALLINT[][]
);

insert into arrtest_s values ('{1,2,3,4,5}', '{{1,2,3}, {4,5,6}, {7,8,9}}');

insert into arrtest_s values ('[0:4]={1,2,3,4,5}', '[0:2][0:2]={{1,2,3}, {4,5,6}, {7,8,9}}');

select * from arrtest_s;

select a[:3], b[:2][:2] from arrtest_s;

select a[2:], b[2:][2:] from arrtest_s;

select a[:], b[:] from arrtest_s;

update arrtest_s
set a[:3] = '{11, 12, 13}',
b[:2][:2] = '{{11,12}, {14,15}}'
where
  array_lower(a, 1) = 1;

select * from arrtest_s;

update arrtest_s set a[3:] = '{23, 24, 25}', b[2:][2:] = '{{25,26}, {28,29}}';

select * from arrtest_s;

update arrtest_s set a[:] = '{11, 12, 13, 14, 15}';

select * from arrtest_s;

update arrtest_s set a[:] = '{23, 24, 25}';

insert into arrtest_s values (null, null);

update arrtest_s set a[:] = '{11, 12, 13, 14, 15}';

create temporary table point_tbl as select * from public.point_tbl;

insert into point_tbl (f1) values (null);

select f1[0:1] from point_tbl;

select f1[0:] from point_tbl;

select f1[:1] from point_tbl;

select f1[:] from point_tbl;

update point_tbl set f1[0] = 10 where f1 is null returning *;

insert into point_tbl (f1[0]) values (0) returning *;

update point_tbl
set f1[0] = null
where
  cast(f1 as TEXT) =
  cast(cast('(10,10)' as point) as TEXT)
returning *;

update point_tbl
set f1[0] = -10,
f1[1] = -10
where
  cast(f1 as TEXT) =
  cast(cast('(10,10)' as point) as TEXT)
returning *;

update point_tbl
set f1[3] = 10
where
  cast(f1 as TEXT) =
  cast(cast('(-10,-10)' as point) as TEXT)
returning *;

create temporary table arrtest1 (
  i INT[],
  t TEXT[]
);

insert into arrtest1 values (array[1, 2, null, 4], array['one', 'two', null, 'four']);

select * from arrtest1;

update arrtest1 set i[2] = 22, t[2] = 'twenty-two';

select * from arrtest1;

update arrtest1 set i[5] = 5, t[5] = 'five';

select * from arrtest1;

update arrtest1 set i[8] = 8, t[8] = 'eight';

select * from arrtest1;

update arrtest1 set i[0] = 0, t[0] = 'zero';

select * from arrtest1;

update arrtest1 set i[-3] = -3, t[-3] = 'minus-three';

select * from arrtest1;

update arrtest1 set i[0:2] = array[10, 11, 12], t[0:2] = array['ten', 'eleven', 'twelve'];

select * from arrtest1;

update arrtest1 set i[8:10] = array[18, null, 20], t[8:10] = array['p18', null, 'p20'];

select * from arrtest1;

update arrtest1 set i[11:12] = array[null, 22], t[11:12] = array[null, 'p22'];

select * from arrtest1;

update arrtest1 set i[15:16] = array[null, 26], t[15:16] = array[null, 'p26'];

select * from arrtest1;

update arrtest1 set i[-5:-3] = array[-15, -14, -13], t[-5:-3] = array['m15', 'm14', 'm13'];

select * from arrtest1;

update arrtest1 set i[-7:-6] = array[-17, null], t[-7:-6] = array['m17', null];

select * from arrtest1;

update arrtest1 set i[-12:-10] = array[-22, null, -20], t[-12:-10] = array['m22', null, 'm20'];

select * from arrtest1;

delete from arrtest1;

insert into arrtest1 values (array[1, 2, null, 4], array['one', 'two', null, 'four']);

select * from arrtest1;

update arrtest1
set i[0:5] = array[0, 1, 2, null, 4, 5],
t[0:5] = array['z', 'p1', 'p2', null, 'p4', 'p5'];

select * from arrtest1;

create temporary table arrtest2 (
  i INT[4],
  f DOUBLE PRECISION[],
  n NUMERIC[],
  t TEXT[],
  d TIMESTAMP[]
);

insert into arrtest2
values
  (
    array[array[array[113, 142], array[1, 147]]],
    cast(array[1.1, 1.2, 1.3] as DOUBLE PRECISION[]),
    array[1.1, 1.2, 1.3],
    array[array[array['aaa', 'aab'],
    array['aba', 'abb'],
    array['aca', 'acb']],
    array[array['baa', 'bab'],
    array['bba', 'bbb'],
    array['bca', 'bcb']]],
    cast(array['19620326', '19931223', '19970117']
    as TIMESTAMP[])
  );

create temporary table arrtest_f (
  f0 INT,
  f1 TEXT,
  f2 DOUBLE PRECISION
);

insert into arrtest_f values (1, 'cat1', 1.21);

insert into arrtest_f values (2, 'cat1', 1.24);

insert into arrtest_f values (3, 'cat1', 1.18);

insert into arrtest_f values (4, 'cat1', 1.26);

insert into arrtest_f values (5, 'cat1', 1.15);

insert into arrtest_f values (6, 'cat2', 1.15);

insert into arrtest_f values (7, 'cat2', 1.26);

insert into arrtest_f values (8, 'cat2', 1.32);

insert into arrtest_f values (9, 'cat2', 1.30);

create temporary table arrtest_i (
  f0 INT,
  f1 TEXT,
  f2 INT
);

insert into arrtest_i values (1, 'cat1', 21);

insert into arrtest_i values (2, 'cat1', 24);

insert into arrtest_i values (3, 'cat1', 18);

insert into arrtest_i values (4, 'cat1', 26);

insert into arrtest_i values (5, 'cat1', 15);

insert into arrtest_i values (6, 'cat2', 15);

insert into arrtest_i values (7, 'cat2', 26);

insert into arrtest_i values (8, 'cat2', 32);

insert into arrtest_i values (9, 'cat2', 30);

select
  t.f[1][3][1] as "131",
  t.f[2][2][1] as "221"
from
  (
    select
      array[array[array[111, 112],
      array[121, 122],
      array[131, 132]],
      array[array[211, 212],
      array[221, 122],
      array[231, 232]]]
      as f
  )
  as t;

select array[array[array[array[array[array['hello'], array['world']]]]]];

select array[array['hello'], array['world']];

select array(select f2 from arrtest_f order by f2) as "ARRAY";

select cast('{1,null,3}' as INT[]);

select array[1, null, 3];

select array_append(array[42], 6) as "{42,6}";

select array_prepend(6, array[42]) as "{6,42}";

select array_cat(array[1, 2], array[3, 4]) as "{1,2,3,4}";

select array_cat(array[1, 2], array[array[3, 4], array[5, 6]]) as "{{1,2},{3,4},{5,6}}";

select array_cat(array[array[3, 4], array[5, 6]], array[1, 2]) as "{{3,4},{5,6},{1,2}}";

select array_position(array[1, 2, 3, 4, 5], 4);

select array_position(array[5, 3, 4, 2, 1], 4);

select array_position(array[array[1, 2], array[3, 4]], 3);

select array_position(array['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'], 'mon');

select array_position(array['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'], 'sat');

select array_position(array['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'], null);

select array_position(array['sun', 'mon', 'tue', 'wed', 'thu', null, 'fri', 'sat'], null);

select array_position(array['sun', 'mon', 'tue', 'wed', 'thu', null, 'fri', 'sat'], 'sat');

select array_positions(null, 10);

select array_positions(null, cast(null as INT));

select array_positions(array[1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6], 4);

select array_positions(array[array[1, 2], array[3, 4]], 4);

select array_positions(array[1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6], null);

select array_positions(array[1, 2, 3, null, 5, 6, 1, 2, 3, null, 5, 6], null);

select
  array_length(
    array_positions(
      array(
        select
          cast('AAAAAAAAAAAAAAAAAAAAAAAAA' as TEXT) ||
          i % 10
        from
          generate_series(1, 100) as g (i)
      ),
      'AAAAAAAAAAAAAAAAAAAAAAAAA5'
    ),
    1
  );

do
$do$
DECLARE
  o int;
  a int[] := ARRAY[1,2,3,2,3,1,2];
BEGIN
  o := array_position(a, 2);
  WHILE o IS NOT NULL
  LOOP
    RAISE NOTICE '%', o;
    o := array_position(a, 2, o + 1);
  END LOOP;
END
$do$
language plpgsql;

select array_position(cast('[2:4]={1,2,3}' as INT[]), 1);

select array_positions(cast('[2:4]={1,2,3}' as INT[]), 1);

select
  array_position(ids, (1, 1)),
  array_positions(ids, (1, 1))
from
  (
    values (array[(0, 0), (1, 1)]), (array[(1, 1)])
  )
  as f (ids);

select a from arrtest where b = array[array[array[113, 142], array[1, 147]]];

select not array[1.1, 1.2, 1.3] = array[1.1, 1.2, 1.3] as "FALSE";

select array[1, 2] || 3 as "{1,2,3}";

select 0 || array[1, 2] as "{0,1,2}";

select array[1, 2] || array[3, 4] as "{1,2,3,4}";

select array[array[array['hello', 'world']]] || array[array[array['happy', 'birthday']]] as "ARRAY";

select array[array[1, 2], array[3, 4]] || array[5, 6] as "{{1,2},{3,4},{5,6}}";

select array[0, 0] || array[1, 1] || array[2, 2] as "{0,0,1,1,2,2}";

select 0 || array[1, 2] || 3 as "{0,1,2,3}";

select array[1.1] || array[2, 3, 4];

select array_agg(x) || array_agg(x) from (values (row(1, 2)), (row(3, 4))) as v (x);

select row(1, 2) || array_agg(x) from (values (row(3, 4)), (row(5, 6))) as v (x);

select * from array_op_test where i @> '{32}' order by seqno;

select * from array_op_test where i && '{32}' order by seqno;

select * from array_op_test where i @> '{17}' order by seqno;

select * from array_op_test where i && '{17}' order by seqno;

select * from array_op_test where i @> '{32,17}' order by seqno;

select * from array_op_test where i && '{32,17}' order by seqno;

select * from array_op_test where i <@ '{38,34,32,89}' order by seqno;

select * from array_op_test where i = '{}' order by seqno;

select * from array_op_test where i @> '{}' order by seqno;

select * from array_op_test where i && '{}' order by seqno;

select * from array_op_test where i <@ '{}' order by seqno;

select * from array_op_test where i = '{NULL}' order by seqno;

select * from array_op_test where i @> '{NULL}' order by seqno;

select * from array_op_test where i && '{NULL}' order by seqno;

select * from array_op_test where i <@ '{NULL}' order by seqno;

select * from array_op_test where t @> '{AAAAAAAA72908}' order by seqno;

select * from array_op_test where t && '{AAAAAAAA72908}' order by seqno;

select * from array_op_test where t @> '{AAAAAAAAAA646}' order by seqno;

select * from array_op_test where t && '{AAAAAAAAAA646}' order by seqno;

select * from array_op_test where t @> '{AAAAAAAA72908,AAAAAAAAAA646}' order by seqno;

select * from array_op_test where t && '{AAAAAAAA72908,AAAAAAAAAA646}' order by seqno;

select
  *
from
  array_op_test
where
  t <@
  '{AAAAAAAA72908,AAAAAAAAAAAAAAAAAAA17075,AA88409,AAAAAAAAAAAAAAAAAA36842,AAAAAAA48038,AAAAAAAAAAAAAA10611}'
order by seqno;

select * from array_op_test where t = '{}' order by seqno;

select * from array_op_test where t @> '{}' order by seqno;

select * from array_op_test where t && '{}' order by seqno;

select * from array_op_test where t <@ '{}' order by seqno;

select cast(cast(cast(array[1, 2, 3] as TEXT[]) as INT[]) as DOUBLE PRECISION[]) as "{1,2,3}";

select
  pg_typeof(
    cast(cast(cast(array[1, 2, 3] as TEXT[]) as INT[])
    as DOUBLE PRECISION[])
  )
  as "double precision[]";

select
  cast(cast(array[array['a', 'bc'], array['def', 'hijk']]
  as TEXT[])
  as VARCHAR[])
  as "{{a,bc},{def,hijk}}";

select
  pg_typeof(
    cast(cast(array[array['a', 'bc'], array['def', 'hijk']]
    as TEXT[])
    as VARCHAR[])
  )
  as "character varying[]";

select
  cast(array[array[array[array[array[array['a', 'bb', 'ccc']]]]]]
  as TEXT[])
  as "{{{{{{a,bb,ccc}}}}}}";

select cast(cast(null as TEXT[]) as INT[]) as "NULL";

select 33 = any ('{1,2,3}');

select 33 = any ('{1,2,33}');

select 33 = all ('{1,2,33}');

select 33 >= all ('{1,2,33}');

select cast(null as INT) >= all ('{1,2,33}');

select cast(null as INT) >= all ('{}');

select cast(null as INT) >= any ('{}');

select 33.4 = any (array[1, 2, 3]);

select 33.4 > all (array[1, 2, 3]);

select 33 * any ('{1,2,3}');

select 33 * any (44);

select 33 = any (cast(null as INT[]));

select cast(null as INT) = any ('{1,2,3}');

select 33 = any ('{1,null,3}');

select 33 = any ('{1,null,33}');

select 33 = all (cast(null as INT[]));

select cast(null as INT) = all ('{1,2,3}');

select 33 = all ('{1,null,3}');

select 33 = all ('{33,null,33}');

select -1 <> all (array(select nullif(g.i, 900) from generate_series(1, 1000) as g (i)));

create temporary table arr_tbl (f1 INT[] unique);

insert into arr_tbl values ('{1,2,3}');

insert into arr_tbl values ('{1,2}');

insert into arr_tbl values ('{1,2,3}');

insert into arr_tbl values ('{2,3,4}');

insert into arr_tbl values ('{1,5,3}');

insert into arr_tbl values ('{1,2,10}');

set enable_seqscan = off;

set enable_bitmapscan = off;

select * from arr_tbl where f1 > '{1,2,3}' and f1 <= '{1,5,3}';

select * from arr_tbl where f1 >= '{1,2,3}' and f1 < '{1,5,3}';

create temporary table arr_pk_tbl (
  pk INT primary key,
  f1 INT[]
);

insert into arr_pk_tbl values (1, '{1,2,3}');

insert into arr_pk_tbl
values (1, '{3,4,5}')
on conflict
(pk)
do
update
set f1[1] = excluded.f1[1],
f1[3] = excluded.f1[3]
returning pk,
f1;

insert into arr_pk_tbl (pk, f1[1:2])
values (1, '{6,7,8}')
on conflict
(pk)
do
update
set f1[1] = excluded.f1[1],
f1[2] = excluded.f1[2],
f1[3] = excluded.f1[3]
returning pk,
f1;

reset enable_seqscan;

reset enable_bitmapscan;

insert into arr_pk_tbl values (10, '[-2147483648:-2147483647]={1,2}');

update arr_pk_tbl set f1[2147483647] = 42 where pk = 10;

update arr_pk_tbl set f1[2147483646:2147483647] = array[4, 2] where pk = 10;

insert into arr_pk_tbl (pk, f1[0:2147483647]) values (2, '{}');

insert into arr_pk_tbl (pk, f1[-2147483648:2147483647]) values (2, '{}');

do
$do$ declare a int[];
begin
  a := '[-2147483648:-2147483647]={1,2}'::int[];
  a[2147483647] := 42;
end $do$;

select 'foo' ~~ any (array['%a', '%o']);

select 'foo' ~~ any (array['%a', '%b']);

select 'foo' ~~ all (array['f%', '%o']);

select 'foo' ~~ all (array['f%', '%b']);

select 'foo' !~~ any (array['%a', '%b']);

select 'foo' !~~ all (array['%a', '%o']);

select 'foo' ~~* any (array['%A', '%O']);

select 'foo' ~~* all (array['F%', '%O']);

select cast('{{1,{2}},{2,3}}' as TEXT[]);

select cast('{{1,2},\{2,3}}' as TEXT[]);

select cast('{"a"b}' as TEXT[]);

select cast('{a"b"}' as TEXT[]);

select cast('{"a""b"}' as TEXT[]);

select cast('{{"1 2" x},{3}}' as TEXT[]);

select cast('{{"1 2"} x,{3}}' as TEXT[]);

select cast('{}}' as TEXT[]);

select cast('{ }}' as TEXT[]);

select cast('}{' as TEXT[]);

select cast('{foo{}}' as TEXT[]);

select cast('{"foo"{}}' as TEXT[]);

select cast('{foo,,bar}' as TEXT[]);

select cast('{{1},{{2}}}' as TEXT[]);

select cast('{{{1}},{2}}' as TEXT[]);

select cast('{{},{{}}}' as TEXT[]);

select cast('{{{}},{}}' as TEXT[]);

select cast('{{1},{}}' as TEXT[]);

select cast('{{},{1}}' as TEXT[]);

select cast('[1:0]={}' as INT[]);

select cast('[2147483646:2147483647]={1,2}' as INT[]);

select cast('[1:-1]={}' as INT[]);

select cast('[2]={1}' as INT[]);

select cast('[1:]={1}' as INT[]);

select cast('[:1]={1}' as INT[]);

select array[];

select cast('{{1,},{1},}' as TEXT[]);

select cast('{{1,},{1}}' as TEXT[]);

select cast('{{1,}}' as TEXT[]);

select cast('{1,}' as TEXT[]);

select cast('[21474836488:21474836489]={1,2}' as INT[]);

select cast('[-2147483649:-2147483648]={1,2}' as INT[]);

select cast('{}' as TEXT[]);

select cast('{{},{}}' as TEXT[]);

select cast('{{{1,2,3,4},{2,3,4,5}},{{3,4,5,6},{4,5,6,7}}}' as TEXT[]);

select cast('{null,n\ull,"null"}' as TEXT[]);

select cast('{ ab\c , "ab\"c" }' as TEXT[]);

select cast('{0 second  ,0 second}' as INTERVAL[]);

select cast('{ { "," } , { 3 } }' as TEXT[]);

select cast('  {   {  "  0 second  "   ,  0 second  }   }' as TEXT[]);

select
  cast('{
           0 second,
           @ 1 hour @ 42 minutes @ 20 seconds
         }'
  as INTERVAL[]);

select cast(array[] as TEXT[]);

select cast('[2]={1,7}' as INT[]);

select cast('[0:1]={1.1,2.2}' as DOUBLE PRECISION[]);

select cast('[2147483646:2147483646]={1}' as INT[]);

select cast('[-2147483648:-2147483647]={1,2}' as INT[]);

create temporary table arraggtest (
  f1 INT[],
  f2 TEXT[][],
  f3 DOUBLE PRECISION[]
);

insert into arraggtest (f1, f2, f3) values ('{1,2,3,4}', '{{grey,red},{blue,blue}}', '{1.6, 0.0}');

insert into arraggtest (f1, f2, f3) values ('{1,2,3}', '{{grey,red},{grey,blue}}', '{1.6}');

select MAX(f1), MIN(f1), MAX(f2), MIN(f2), MAX(f3), MIN(f3) from arraggtest;

insert into arraggtest (f1, f2, f3)
values
  (
    '{3,3,2,4,5,6}',
    '{{white,yellow},{pink,orange}}',
    '{2.1,3.3,1.8,1.7,1.6}'
  );

select MAX(f1), MIN(f1), MAX(f2), MIN(f2), MAX(f3), MIN(f3) from arraggtest;

insert into arraggtest (f1, f2, f3)
values
  (
    '{2}',
    '{{black,red},{green,orange}}',
    '{1.6,2.2,2.6,0.4}'
  );

select MAX(f1), MIN(f1), MAX(f2), MIN(f2), MAX(f3), MIN(f3) from arraggtest;

insert into arraggtest (f1, f2, f3)
values
  (
    '{4,2,6,7,8,1}',
    '{{red},{black},{purple},{blue},{blue}}',
    null
  );

select MAX(f1), MIN(f1), MAX(f2), MIN(f2), MAX(f3), MIN(f3) from arraggtest;

insert into arraggtest (f1, f2, f3)
values
  (
    '{}',
    '{{pink,white,blue,red,grey,orange}}',
    '{2.1,1.87,1.4,2.2}'
  );

select MAX(f1), MIN(f1), MAX(f2), MIN(f2), MAX(f3), MIN(f3) from arraggtest;

create type comptype as (f1 INT, f2 TEXT);

create table comptable (
  c1 comptype,
  c2 comptype[]
);

insert into comptable
values
  (
    row(1, 'foo'),
    array[cast(row(2, 'bar') as comptype),
    cast(row(3, 'baz') as comptype)]
  );

create type _comptype as enum ('fooey');

select * from comptable;

select c2[2].f2 from comptable;

drop TYPE _comptype;

drop TABLE comptable;

drop TYPE comptype;

create or replace function unnest1(ANYARRAY)
returns setof ANYELEMENT
as $function$
select $1[s] from generate_subscripts($1,1) g(s);
$function$
language sql
immutable;

create or replace function unnest2(ANYARRAY)
returns setof ANYELEMENT
as $function$
select $1[s1][s2] from generate_subscripts($1,1) g1(s1),
                   generate_subscripts($1,2) g2(s2);
$function$
language sql
immutable;

select * from unnest1(array[1, 2, 3]);

select * from unnest2(array[array[1, 2, 3], array[4, 5, 6]]);

drop FUNCTION unnest1(ANYARRAY);

drop FUNCTION unnest2(ANYARRAY);

select array_fill(cast(null as INT), array[3, 3], array[2, 2]);

select array_fill(cast(null as INT), array[3, 3]);

select array_fill(cast(null as TEXT), array[3, 3], array[2, 2]);

select array_fill(cast(null as TEXT), array[3, 3]);

select array_fill(7, array[3, 3], array[2, 2]);

select array_fill(7, array[3, 3]);

select array_fill(cast('juhu' as TEXT), array[3, 3], array[2, 2]);

select array_fill(cast('juhu' as TEXT), array[3, 3]);

select a, a = '{}' as is_eq, array_dims(a) from (select array_fill(42, array[0]) as a) as ss;

select a, a = '{}' as is_eq, array_dims(a) from (select array_fill(42, '{}') as a) as ss;

select a, a = '{}' as is_eq, array_dims(a) from (select array_fill(42, '{}', '{}') as a) as ss;

select array_fill(1, null, array[2, 2]);

select array_fill(1, array[2, 2], null);

select array_fill(1, array[2, 2], '{}');

select array_fill(1, array[3, 3], array[1, 1, 1]);

select array_fill(1, array[1, 2, null]);

select array_fill(1, array[array[1, 2], array[3, 4]]);

select string_to_array('1|2|3', '|');

select string_to_array('1|2|3|', '|');

select string_to_array('1||2|3||', '||');

select string_to_array('1|2|3', '');

select string_to_array('', '|');

select string_to_array('1|2|3', null);

select string_to_array(null, '|') is null;

select string_to_array('abc', '');

select string_to_array('abc', '', 'abc');

select string_to_array('abc', ',');

select string_to_array('abc', ',', 'abc');

select string_to_array('1,2,3,4,,6', ',');

select string_to_array('1,2,3,4,,6', ',', '');

select string_to_array('1,2,3,4,*,6', ',', '*');

select v, v is null as "is null" from string_to_table('1|2|3', '|') as g (v);

select v, v is null as "is null" from string_to_table('1|2|3|', '|') as g (v);

select v, v is null as "is null" from string_to_table('1||2|3||', '||') as g (v);

select v, v is null as "is null" from string_to_table('1|2|3', '') as g (v);

select v, v is null as "is null" from string_to_table('', '|') as g (v);

select v, v is null as "is null" from string_to_table('1|2|3', null) as g (v);

select v, v is null as "is null" from string_to_table(null, '|') as g (v);

select v, v is null as "is null" from string_to_table('abc', '') as g (v);

select v, v is null as "is null" from string_to_table('abc', '', 'abc') as g (v);

select v, v is null as "is null" from string_to_table('abc', ',') as g (v);

select v, v is null as "is null" from string_to_table('abc', ',', 'abc') as g (v);

select v, v is null as "is null" from string_to_table('1,2,3,4,,6', ',') as g (v);

select v, v is null as "is null" from string_to_table('1,2,3,4,,6', ',', '') as g (v);

select v, v is null as "is null" from string_to_table('1,2,3,4,*,6', ',', '*') as g (v);

select array_to_string(cast(null as INT[]), ',') is null;

select array_to_string(cast('{}' as INT[]), ',');

select array_to_string(array[1, 2, 3, 4, null, 6], ',');

select array_to_string(array[1, 2, 3, 4, null, 6], ',', '*');

select array_to_string(array[1, 2, 3, 4, null, 6], null);

select array_to_string(array[1, 2, 3, 4, null, 6], ',', null);

select array_to_string(string_to_array('1|2|3', '|'), '|');

select array_length(array[1, 2, 3], 1);

select array_length(array[array[1, 2, 3], array[4, 5, 6]], 0);

select array_length(array[array[1, 2, 3], array[4, 5, 6]], 1);

select array_length(array[array[1, 2, 3], array[4, 5, 6]], 2);

select array_length(array[array[1, 2, 3], array[4, 5, 6]], 3);

select cardinality(cast(null as INT[]));

select cardinality(cast('{}' as INT[]));

select cardinality(array[1, 2, 3]);

select cardinality(cast('[2:4]={5,6,7}' as INT[]));

select cardinality(cast('{{1,2}}' as INT[]));

select cardinality(cast('{{1,2},{3,4},{5,6}}' as INT[]));

select cardinality(cast('{{{1,9},{5,6}},{{2,3},{3,4}}}' as INT[]));

select
  array_agg(unique1)
from
  (
    select
      unique1
    from
      tenk1
    where
      unique1 < 15
    order by unique1
  )
  as ss;

select array_agg(ten) from (select ten from tenk1 where unique1 < 15 order by unique1) as ss;

select
  array_agg(nullif(ten, 4))
from
  (
    select
      ten
    from
      tenk1
    where
      unique1 < 15
    order by unique1
  )
  as ss;

select array_agg(unique1) from tenk1 where unique1 < -15;

select array_agg(ar) from (values (cast('{1,2}' as INT[])), (cast('{3,4}' as INT[]))) as v (ar);

select
  array_agg(distinct ar order by ar desc)
from
  (
    select
      array[i / 2]
    from
      generate_series(1, 10) as a (i)
  )
  as b (ar);

select
  array_agg(ar)
from
  (
    select
      array_agg(array[i, i + 1, i - 1])
    from
      generate_series(1, 2) as a (i)
  )
  as b (ar);

select array_agg(array[i + 1.2, i + 1.3, i + 1.4]) from generate_series(1, 3) as g (i);

select array_agg(array['Hello', cast(i as TEXT)]) from generate_series(9, 11) as g (i);

select array_agg(array[i, nullif(i, 3), i + 1]) from generate_series(1, 4) as g (i);

select array_agg(cast('{}' as INT[])) from generate_series(1, 2);

select array_agg(cast(null as INT[])) from generate_series(1, 2);

select array_agg(ar) from (values (cast('{1,2}' as INT[])), (cast('{3}' as INT[]))) as v (ar);

select unnest(array[1, 2, 3]);

select * from unnest(array[1, 2, 3]);

select unnest(cast(array[1, 2, 3, 4.5] as DOUBLE PRECISION[]));

select unnest(cast(array[1, 2, 3, 4.5] as NUMERIC[]));

select unnest(array[1, 2, 3, null, 4, null, null, 5, 6]);

select unnest(cast(array[1, 2, 3, null, 4, null, null, 5, 6] as TEXT[]));

select abs(unnest(array[1, 2, null, -3]));

select array_remove(array[1, 2, 2, 3], 2);

select array_remove(array[1, 2, 2, 3], 5);

select array_remove(array[1, null, null, 3], null);

select array_remove(array['A', 'CC', 'D', 'C', 'RR'], 'RR');

select array_remove(array[1.0, 2.1, 3.3], 1);

select array_remove('{{1,2,2},{1,4,3}}', 2);

select array_remove(array['X', 'X', 'X'], 'X') = '{}';

select array_replace(array[1, 2, 5, 4], 5, 3);

select array_replace(array[1, 2, 5, 4], 5, null);

select array_replace(array[1, 2, null, 4, null], null, 5);

select array_replace(array['A', 'B', 'DD', 'B'], 'B', 'CC');

select array_replace(array[1, null, 3], null, null);

select array_replace(array['AB', null, 'CDE'], null, '12');

select array(select array[i, i / 2] from generate_series(1, 5) as i);

select array(select array['Hello', cast(i as TEXT)] from generate_series(9, 11) as i);

select pg_typeof(array(select cast('11 22 33' as int2vector) from generate_series(1, 5)));

select array(select cast('11 22 33' as int2vector) from generate_series(1, 5));

select unnest(array(select cast('11 22 33' as int2vector) from generate_series(1, 5)));

select pg_typeof(array(select cast('11 22 33' as oidvector) from generate_series(1, 5)));

select array(select cast('11 22 33' as oidvector) from generate_series(1, 5));

select unnest(array(select cast('11 22 33' as oidvector) from generate_series(1, 5)));

select pg_typeof(array[cast('11 22 33' as int2vector)]);

select array[cast('11 22 33' as int2vector)];

select pg_typeof(unnest(array[cast('11 22 33' as int2vector)]));

select unnest(array[cast('11 22 33' as int2vector)]);

select pg_typeof(unnest(cast('11 22 33' as int2vector)));

select unnest(cast('11 22 33' as int2vector));

select pg_typeof(array[cast('11 22 33' as oidvector)]);

select array[cast('11 22 33' as oidvector)];

select pg_typeof(unnest(array[cast('11 22 33' as oidvector)]));

select unnest(array[cast('11 22 33' as oidvector)]);

select pg_typeof(unnest(cast('11 22 33' as oidvector)));

select unnest(cast('11 22 33' as oidvector));

create temporary table t1 (f1 int8_tbl[]);

insert into t1 (f1[5]."q1") values (42);

select * from t1;

update t1 set f1[5]."q2" = 43;

select * from t1;

create temporary table src (f1 TEXT);

insert into src select string_agg(cast(random() as TEXT), '') from generate_series(1, 10000);

create type textandtext as (c1 TEXT, c2 TEXT);

create temporary table dest (f1 textandtext[]);

insert into dest select array[cast(row(f1, f1) as textandtext)] from src;

select length(fipshash(f1[1].c2)) from dest;

delete from src;

select length(fipshash(f1[1].c2)) from dest;

truncate src;

drop TABLE src;

select length(fipshash(f1[1].c2)) from dest;

drop TABLE dest;

drop TYPE textandtext;

select
  op,
  width_bucket(
    cast(op as NUMERIC),
    cast(array[1, 3, 5, 10.0] as NUMERIC[])
  )
  as wb_n1,
  width_bucket(
    cast(op as NUMERIC),
    cast(array[0, 5.5, 9.99] as NUMERIC[])
  )
  as wb_n2,
  width_bucket(
    cast(op as NUMERIC),
    cast(array[-6, -5, 2.0] as NUMERIC[])
  )
  as wb_n3,
  width_bucket(
    cast(op as DOUBLE PRECISION),
    cast(array[1, 3, 5, 10.0] as DOUBLE PRECISION[])
  )
  as wb_f1,
  width_bucket(
    cast(op as DOUBLE PRECISION),
    cast(array[0, 5.5, 9.99] as DOUBLE PRECISION[])
  )
  as wb_f2,
  width_bucket(
    cast(op as DOUBLE PRECISION),
    cast(array[-6, -5, 2.0] as DOUBLE PRECISION[])
  )
  as wb_f3
from
  (
    values
      (-5.2),
      (-0.0000000001),
      (0.000000000001),
      (1),
      (1.99999999999999),
      (2),
      (2.00000000000001),
      (3),
      (4),
      (4.5),
      (5),
      (5.5),
      (6),
      (7),
      (8),
      (9),
      (9.99999999999999),
      (10),
      (10.0000000000001)
  )
  as v (op);

select
  op,
  width_bucket(
    op,
    cast(array[1, 3, 9, 'NaN', 'NaN']
    as DOUBLE PRECISION[])
  )
  as wb
from
  (
    values
      (-cast(5.2 as DOUBLE PRECISION)),
      (cast(4 as DOUBLE PRECISION)),
      (cast(77 as DOUBLE PRECISION)),
      (cast('NaN' as DOUBLE PRECISION))
  )
  as v (op);

select op, width_bucket(op, array[1, 3, 5, 10]) as wb_1 from generate_series(0, 11) as op;

select
  width_bucket(
    NOW(),
    cast(array['yesterday', 'today', 'tomorrow']
    as timestamp with time ZONE[])
  );

select width_bucket(5, array[3]);

select width_bucket(5, '{}');

select width_bucket(cast('5' as TEXT), cast(array[3, 4] as INT[]));

select width_bucket(5, array[3, 4, null]);

select width_bucket(5, array[array[1, 2], array[3, 4]]);

select
  arr,
  trim_array(arr, 2)
from
  (
    values
      (cast('{1,2,3,4,5,6}' as BIGINT[])),
      ('{1,2}'),
      ('[10:16]={1,2,3,4,5,6,7}'),
      ('[-15:-10]={1,2,3,4,5,6}'),
      ('{{1,10},{2,20},{3,30},{4,40}}')
  )
  as v (arr);

select trim_array(array[1, 2, 3], -1);

select trim_array(array[1, 2, 3], 10);

select trim_array(cast(array[] as INT[]), 1);

select array_shuffle(cast('{1,2,3,4,5,6}' as INT[])) <@ '{1,2,3,4,5,6}';

select array_shuffle(cast('{1,2,3,4,5,6}' as INT[])) @> '{1,2,3,4,5,6}';

select array_dims(array_shuffle(cast('[-1:2][2:3]={{1,2},{3,NULL},{5,6},{7,8}}' as INT[])));

select
  array_dims(
    array_shuffle(
      cast('{{{1,2},{3,NULL}},{{5,6},{7,8}},{{9,10},{11,12}}}'
      as INT[])
    )
  );

select array_sample(cast('{1,2,3,4,5,6}' as INT[]), 3) <@ '{1,2,3,4,5,6}';

select array_length(array_sample(cast('{1,2,3,4,5,6}' as INT[]), 3), 1);

select array_dims(array_sample(cast('[-1:2][2:3]={{1,2},{3,NULL},{5,6},{7,8}}' as INT[]), 3));

select
  array_dims(
    array_sample(
      cast('{{{1,2},{3,NULL}},{{5,6},{7,8}},{{9,10},{11,12}}}'
      as INT[]),
      2
    )
  );

select array_sample(cast('{1,2,3,4,5,6}' as INT[]), -1);

select array_sample(cast('{1,2,3,4,5,6}' as INT[]), 7);

select array_reverse(cast('{}' as INT[]));

select array_reverse(cast('{1}' as INT[]));

select array_reverse(cast('{1,2}' as INT[]));

select array_reverse(cast('{1,2,3,NULL,4,5,6}' as INT[]));

select array_reverse(cast('{{1,2},{3,4},{5,6},{7,8}}' as INT[]));

select array_sort(cast('{}' as INT[]));

select array_sort(cast('{1}' as INT[]));

select array_sort(cast('{1,3,5,2,4,6}' as INT[]));

select array_sort(cast('{1.1,3.3,5.5,2.2,4.4,6.6}' as NUMERIC[]));

select array_sort(cast('{foo,bar,CCC,Abc,bbc}' as TEXT[]) collate "C");

select array_sort(cast('{foo,bar,null,CCC,Abc,bbc}' as TEXT[]) collate "C");

select
  array_sort(
    array(
      select cast('1 4' as int2vector)
      union all
      select cast('1 2' as int2vector)
    )
  );

select array_sort(cast('{1.1,3.3,5.5,2.2,null,4.4,6.6}' as DOUBLE PRECISION[]), true);

select array_sort(cast('{1.1,3.3,5.5,2.2,null,4.4,6.6}' as DOUBLE PRECISION[]), false);

select array_sort(cast('{1.1,3.3,5.5,2.2,null,4.4,6.6}' as DOUBLE PRECISION[]), true, true);

select array_sort(cast('{1.1,3.3,5.5,2.2,null,4.4,6.6}' as DOUBLE PRECISION[]), true, false);

select array_sort(cast('{1.1,3.3,5.5,2.2,null,4.4,6.6}' as DOUBLE PRECISION[]), false, true);

select array_sort(cast('{1.1,3.3,5.5,2.2,null,4.4,6.6}' as DOUBLE PRECISION[]), false, false);

select array_sort(cast('{{1}}' as INT[]));

select array_sort(array[array[2, 4], array[2, 1], array[6, 5]]);

select array_sort(cast('{{"1 2","3 4"}, {"1 -2","-1 4"}}' as int2vector[]));

select array_sort(cast('{1}' as XID[]));

select array_sort(cast('{1,2,3}' as XID[]));

select array_sort(cast('{{1,2,3},{2,3,4}}' as XID[]));

select array_sort(a) from (values (cast('[10:12][20:21]={{1,2},{10,20},{3,4}}' as INT[]))) as v (a);

select array_sort(a) from (values (cast('[-1:0]={7,1}' as INT[]))) as v (a);

select array_sort(a) from (values (cast('[-2:0][20:21]={{1,2},{10,20},{1,-4}}' as INT[]))) as v (a);

select
  array_sort(a[-1:0])
from
  (
    values
      (
        cast('[-2:0][20:21]={{1,2},{10,20},{1,-4}}'
        as INT[])
      )
  )
  as v (a);

select
  array_sort(a[-1:0][20:20])
from
  (
    values
      (
        cast('[-2:0][20:21]={{1,2},{10,20},{1,-4}}'
        as INT[])
      )
  )
  as v (a);
