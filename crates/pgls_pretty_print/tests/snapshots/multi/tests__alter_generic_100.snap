---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/alter_generic.sql
snapshot_kind: text
---
create function test_opclass_options_func(internal)
returns void
as 'regresslib', 'test_opclass_options_func'
language c;

set client_min_messages = warning;

drop role if exists regress_alter_generic_user1;

drop role if exists regress_alter_generic_user2;

drop role if exists regress_alter_generic_user3;

reset client_min_messages;

create user regress_alter_generic_user3;

create user regress_alter_generic_user2;

create user regress_alter_generic_user1 in role regress_alter_generic_user3;

create schema "alt_nsp1";

create schema "alt_nsp2";

grant all on schema alt_nsp1, alt_nsp2 to public;

set search_path to alt_nsp1, public;

set session authorization regress_alter_generic_user1;

create function alt_func1(int)
returns int
language sql
as $function$SELECT $1 + 1$function$;

create function alt_func2(int)
returns int
language sql
as $function$SELECT $1 - 1$function$;

create aggregate alt_agg1 (sfunc1 = int4pl, basetype = int, stype1 = int, initcond = 0);

create aggregate alt_agg2 (sfunc1 = int4mi, basetype = int, stype1 = int, initcond = 0);

alter aggregate alt_func1(int) rename to alt_func3;

alter aggregate alt_func1(int) owner to regress_alter_generic_user3;

alter aggregate alt_func1(int) set schema alt_nsp2;

alter function alt_func1(int) rename to alt_func2;

alter function alt_func1(int) rename to alt_func3;

alter function alt_func2(int) owner to regress_alter_generic_user2;

alter function alt_func2(int) owner to regress_alter_generic_user3;

alter function alt_func2(int) set schema alt_nsp1;

alter function alt_func2(int) set schema alt_nsp2;

alter aggregate alt_agg1(int) rename to alt_agg2;

alter aggregate alt_agg1(int) rename to alt_agg3;

alter aggregate alt_agg2(int) owner to regress_alter_generic_user2;

alter aggregate alt_agg2(int) owner to regress_alter_generic_user3;

alter aggregate alt_agg2(int) set schema alt_nsp2;

set session authorization regress_alter_generic_user2;

create function alt_func1(int)
returns int
language sql
as $function$SELECT $1 + 2$function$;

create function alt_func2(int)
returns int
language sql
as $function$SELECT $1 - 2$function$;

create aggregate alt_agg1 (sfunc1 = int4pl, basetype = int, stype1 = int, initcond = 100);

create aggregate alt_agg2 (sfunc1 = int4mi, basetype = int, stype1 = int, initcond = -100);

alter function alt_func3(int) rename to alt_func4;

alter function alt_func1(int) rename to alt_func4;

alter function alt_func3(int) owner to regress_alter_generic_user2;

alter function alt_func2(int) owner to regress_alter_generic_user3;

alter function alt_func3(int) set schema alt_nsp2;

alter function alt_func2(int) set schema alt_nsp2;

alter aggregate alt_agg3(int) rename to alt_agg4;

alter aggregate alt_agg1(int) rename to alt_agg4;

alter aggregate alt_agg3(int) owner to regress_alter_generic_user2;

alter aggregate alt_agg2(int) owner to regress_alter_generic_user3;

alter aggregate alt_agg3(int) set schema alt_nsp2;

alter aggregate alt_agg2(int) set schema alt_nsp2;

reset session_authorization;

select
  n.nspname,
  proname,
  cast(prorettype as regtype),
  prokind,
  a.rolname
from
  pg_proc as p,
  pg_namespace as n,
  pg_authid as a
where
  p.pronamespace = n.oid and
  p.proowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  proname;

set session authorization regress_alter_generic_user1;

create conversion alt_conv1 for 'LATIN1' to 'UTF8' from iso8859_1_to_utf8;

create conversion alt_conv2 for 'LATIN1' to 'UTF8' from iso8859_1_to_utf8;

alter conversion alt_conv1 rename to alt_conv2;

alter conversion alt_conv1 rename to alt_conv3;

alter conversion alt_conv2 owner to regress_alter_generic_user2;

alter conversion alt_conv2 owner to regress_alter_generic_user3;

alter conversion alt_conv2 set schema alt_nsp2;

set session authorization regress_alter_generic_user2;

create conversion alt_conv1 for 'LATIN1' to 'UTF8' from iso8859_1_to_utf8;

create conversion alt_conv2 for 'LATIN1' to 'UTF8' from iso8859_1_to_utf8;

alter conversion alt_conv3 rename to alt_conv4;

alter conversion alt_conv1 rename to alt_conv4;

alter conversion alt_conv3 owner to regress_alter_generic_user2;

alter conversion alt_conv2 owner to regress_alter_generic_user3;

alter conversion alt_conv3 set schema alt_nsp2;

alter conversion alt_conv2 set schema alt_nsp2;

reset session_authorization;

select
  n.nspname,
  c.conname,
  a.rolname
from
  pg_conversion as c,
  pg_namespace as n,
  pg_authid as a
where
  c.connamespace = n.oid and
  c.conowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  conname;

create foreign data wrapper alt_fdw1;

create foreign data wrapper alt_fdw2;

create server alt_fserv1 foreign data wrapper alt_fdw1;

create server alt_fserv2 foreign data wrapper alt_fdw2;

alter foreign data wrapper alt_fdw1 rename to alt_fdw2;

alter foreign data wrapper alt_fdw1 rename to alt_fdw3;

alter server alt_fserv1 rename to alt_fserv2;

alter server alt_fserv1 rename to alt_fserv3;

select fdwname from pg_foreign_data_wrapper where fdwname like 'alt_fdw%';

select srvname from pg_foreign_server where srvname like 'alt_fserv%';

create language alt_lang1 handler plpgsql_call_handler;

create language alt_lang2 handler plpgsql_call_handler;

alter language alt_lang1 owner to regress_alter_generic_user1;

alter language alt_lang2 owner to regress_alter_generic_user2;

set session authorization regress_alter_generic_user1;

alter language alt_lang1 rename to alt_lang2;

alter language alt_lang2 rename to alt_lang3;

alter language alt_lang1 rename to alt_lang3;

alter language alt_lang2 owner to regress_alter_generic_user3;

alter language alt_lang3 owner to regress_alter_generic_user2;

alter language alt_lang3 owner to regress_alter_generic_user3;

reset session_authorization;

select
  lanname,
  a.rolname
from
  pg_language as l,
  pg_authid as a
where
  l.lanowner = a.oid and l.lanname like 'alt_lang%'
order by lanname;

set session authorization regress_alter_generic_user1;

create operator @-@ (LEFTARG = int, RIGHTARG = int, PROCEDURE = int4mi);

create operator @+@ (LEFTARG = int, RIGHTARG = int, PROCEDURE = int4pl);

alter operator @+@ (int, int) owner to regress_alter_generic_user2;

alter operator @+@ (int, int) owner to regress_alter_generic_user3;

alter operator @-@ (int, int) set schema alt_nsp2;

set session authorization regress_alter_generic_user2;

create operator @-@ (LEFTARG = int, RIGHTARG = int, PROCEDURE = int4mi);

alter operator @+@ (int, int) owner to regress_alter_generic_user2;

alter operator @-@ (int, int) owner to regress_alter_generic_user3;

alter operator @+@ (int, int) set schema alt_nsp2;

reset session_authorization;

select
  n.nspname,
  oprname,
  a.rolname,
  cast(oprleft as regtype),
  cast(oprright as regtype),
  cast(oprcode as regproc)
from
  pg_operator as o,
  pg_namespace as n,
  pg_authid as a
where
  o.oprnamespace = n.oid and
  o.oprowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  oprname;

create operator family alt_opf1 using hash;

create operator family alt_opf2 using hash;

alter operator family alt_opf1 using hash owner to regress_alter_generic_user1;

alter operator family alt_opf2 using hash owner to regress_alter_generic_user1;

create operator class alt_opc1 for type uuid using hash as storage uuid;

create operator class alt_opc2 for type uuid using hash as storage uuid;

alter operator class alt_opc1 using hash owner to regress_alter_generic_user1;

alter operator class alt_opc2 using hash owner to regress_alter_generic_user1;

set session authorization regress_alter_generic_user1;

alter operator family alt_opf1 using hash rename to alt_opf2;

alter operator family alt_opf1 using hash rename to alt_opf3;

alter operator family alt_opf2 using hash owner to regress_alter_generic_user2;

alter operator family alt_opf2 using hash owner to regress_alter_generic_user3;

alter operator family alt_opf2 using hash set schema alt_nsp2;

alter operator class alt_opc1 using hash rename to alt_opc2;

alter operator class alt_opc1 using hash rename to alt_opc3;

alter operator class alt_opc2 using hash owner to regress_alter_generic_user2;

alter operator class alt_opc2 using hash owner to regress_alter_generic_user3;

alter operator class alt_opc2 using hash set schema alt_nsp2;

reset session_authorization;

create operator family alt_opf1 using hash;

create operator family alt_opf2 using hash;

alter operator family alt_opf1 using hash owner to regress_alter_generic_user2;

alter operator family alt_opf2 using hash owner to regress_alter_generic_user2;

create operator class alt_opc1 for type macaddr using hash as storage macaddr;

create operator class alt_opc2 for type macaddr using hash as storage macaddr;

alter operator class alt_opc1 using hash owner to regress_alter_generic_user2;

alter operator class alt_opc2 using hash owner to regress_alter_generic_user2;

set session authorization regress_alter_generic_user2;

alter operator family alt_opf3 using hash rename to alt_opf4;

alter operator family alt_opf1 using hash rename to alt_opf4;

alter operator family alt_opf3 using hash owner to regress_alter_generic_user2;

alter operator family alt_opf2 using hash owner to regress_alter_generic_user3;

alter operator family alt_opf3 using hash set schema alt_nsp2;

alter operator family alt_opf2 using hash set schema alt_nsp2;

alter operator class alt_opc3 using hash rename to alt_opc4;

alter operator class alt_opc1 using hash rename to alt_opc4;

alter operator class alt_opc3 using hash owner to regress_alter_generic_user2;

alter operator class alt_opc2 using hash owner to regress_alter_generic_user3;

alter operator class alt_opc3 using hash set schema alt_nsp2;

alter operator class alt_opc2 using hash set schema alt_nsp2;

reset session_authorization;

select
  nspname,
  opfname,
  amname,
  rolname
from
  pg_opfamily as o,
  pg_am as m,
  pg_namespace as n,
  pg_authid as a
where
  o.opfmethod = m.oid and
  o.opfnamespace = n.oid and
  o.opfowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2') and
  not opfname like 'alt_opc%'
order by nspname,
  opfname;

select
  nspname,
  opcname,
  amname,
  rolname
from
  pg_opclass as o,
  pg_am as m,
  pg_namespace as n,
  pg_authid as a
where
  o.opcmethod = m.oid and
  o.opcnamespace = n.oid and
  o.opcowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  opcname;

begin;

create operator family alt_opf4 using btree;

alter operator family alt_opf4 using btree
  add operator 1 < (int, smallint),
  operator 2 <= (int, smallint),
  operator 3 = (int, smallint),
  operator 4 >= (int, smallint),
  operator 5 > (int, smallint),
  function 1 btint42cmp(int, smallint);

alter operator family alt_opf4 using btree
  drop operator 1 (int, smallint),
  operator 2 (int, smallint),
  operator 3 (int, smallint),
  operator 4 (int, smallint),
  operator 5 (int, smallint),
  function 1 (int, smallint);

drop operator family alt_opf4 using btree;

rollback;

create operator family alt_opf4 using btree;

alter operator family alt_opf4 using invalid_index_method add operator 1 < (int, smallint);

alter operator family alt_opf4 using btree add operator 6 < (int, smallint);

alter operator family alt_opf4 using btree add operator 0 < (int, smallint);

alter operator family alt_opf4 using btree add operator 1 <;

alter operator family alt_opf4 using btree add function 0 btint42cmp(int, smallint);

alter operator family alt_opf4 using btree add function 7 btint42cmp(int, smallint);

alter operator family alt_opf4 using btree add storage invalid_storage;

drop operator family alt_opf4 using btree;

begin;

create role regress_alter_generic_user5 nosuperuser;

create operator family alt_opf5 using btree;

set role to regress_alter_generic_user5;

alter operator family alt_opf5 using btree
  add operator 1 < (int, smallint),
  function 1 btint42cmp(int, smallint);

reset role;

drop operator family alt_opf5 using btree;

rollback;

begin;

create role regress_alter_generic_user6;

create schema "alt_nsp6";

revoke all on schema alt_nsp6 from regress_alter_generic_user6;

create operator family alt_nsp6.alt_opf6 using btree;

set role to regress_alter_generic_user6;

alter operator family alt_nsp6.alt_opf6 using btree add operator 1 < (int, smallint);

rollback;

create operator family alt_opf7 using btree;

alter operator family alt_opf7 using btree add operator 1 < (int, smallint);

alter operator family alt_opf7 using btree drop operator 1 (int, smallint, bigint);

drop operator family alt_opf7 using btree;

create operator family alt_opf8 using btree;

alter operator family alt_opf8 using btree add operator 1 < (int, int);

drop operator family alt_opf8 using btree;

create operator family alt_opf9 using gist;

alter operator family alt_opf9 using gist add operator 1 < (int, int) for order by float_ops;

drop operator family alt_opf9 using gist;

create operator family alt_opf10 using btree;

alter operator family alt_opf10 using btree add operator 1 < (int, int) for order by float_ops;

drop operator family alt_opf10 using btree;

create operator family alt_opf11 using gist;

alter operator family alt_opf11 using gist add operator 1 < (int, int) for order by float_ops;

alter operator family alt_opf11 using gist drop operator 1 (int, int);

drop operator family alt_opf11 using gist;

begin;

create operator family alt_opf12 using btree;

create function fn_opf12(int, smallint)
returns bigint
as $function$SELECT NULL::BIGINT;$function$
language sql;

alter operator family alt_opf12 using btree add function 1 fn_opf12(int, smallint);

drop operator family alt_opf12 using btree;

rollback;

begin;

create operator family alt_opf13 using hash;

create function fn_opf13(int)
returns bigint
as $function$SELECT NULL::BIGINT;$function$
language sql;

alter operator family alt_opf13 using hash add function 1 fn_opf13(int);

drop operator family alt_opf13 using hash;

rollback;

begin;

create operator family alt_opf14 using btree;

create function fn_opf14(int)
returns bigint
as $function$SELECT NULL::BIGINT;$function$
language sql;

alter operator family alt_opf14 using btree add function 1 fn_opf14(int);

drop operator family alt_opf14 using btree;

rollback;

begin;

create operator family alt_opf15 using hash;

create function fn_opf15(int, smallint)
returns bigint
as $function$SELECT NULL::BIGINT;$function$
language sql;

alter operator family alt_opf15 using hash add function 1 fn_opf15(int, smallint);

drop operator family alt_opf15 using hash;

rollback;

create operator family alt_opf16 using gist;

alter operator family alt_opf16 using gist add function 1 btint42cmp(int, smallint);

drop operator family alt_opf16 using gist;

create operator family alt_opf17 using btree;

alter operator family alt_opf17 using btree add operator 1 < (int, int), operator 1 < (int, int);

alter operator family alt_opf17 using btree add operator 1 < (int, int);

alter operator family alt_opf17 using btree add operator 1 < (int, int);

alter operator family alt_opf17 using btree
  add operator 1 < (int, smallint),
  operator 2 <= (int, smallint),
  operator 3 = (int, smallint),
  operator 4 >= (int, smallint),
  operator 5 > (int, smallint),
  function 1 btint42cmp(int, smallint),
  function 1 btint42cmp(int, smallint);

alter operator family alt_opf17 using btree
  add operator 1 < (int, smallint),
  operator 2 <= (int, smallint),
  operator 3 = (int, smallint),
  operator 4 >= (int, smallint),
  operator 5 > (int, smallint),
  function 1 btint42cmp(int, smallint);

alter operator family alt_opf17 using btree
  add operator 1 < (int, smallint),
  operator 2 <= (int, smallint),
  operator 3 = (int, smallint),
  operator 4 >= (int, smallint),
  operator 5 > (int, smallint),
  function 1 btint42cmp(int, smallint);

drop operator family alt_opf17 using btree;

create operator family alt_opf18 using btree;

alter operator family alt_opf18 using btree drop operator 1 (int, int);

alter operator family alt_opf18 using btree
  add operator 1 < (int, smallint),
  operator 2 <= (int, smallint),
  operator 3 = (int, smallint),
  operator 4 >= (int, smallint),
  operator 5 > (int, smallint),
  function 1 btint42cmp(int, smallint);

alter operator family alt_opf18 using btree add function 4 (int, smallint) btequalimage(oid);

alter operator family alt_opf18 using btree
  add function 6 (int,
  smallint) btint4skipsupport(internal);

alter operator family alt_opf18 using btree drop function 2 (int, int);

drop operator family alt_opf18 using btree;

create operator family alt_opf19 using btree;

alter operator family alt_opf19 using btree
  add function 5 test_opclass_options_func(
    internal,
    text[],
    boolean);

alter operator family alt_opf19 using btree add function 5 (int) btint42cmp(int, smallint);

alter operator family alt_opf19 using btree
  add function 5 (int,
  smallint) btint42cmp(int, smallint);

alter operator family alt_opf19 using btree
  add function 5 (int) test_opclass_options_func(internal);

alter operator family alt_opf19 using btree drop function 5 (int, int);

drop operator family alt_opf19 using btree;

set session authorization regress_alter_generic_user1;

create table alt_regress_1 (
  a int,
  b int
);

create statistics alt_stat1 on "a", "b" from alt_regress_1;

create statistics alt_stat2 on "a", "b" from alt_regress_1;

alter statistics alt_stat1 rename to alt_stat2;

alter statistics alt_stat1 rename to alt_stat3;

alter statistics alt_stat2 owner to regress_alter_generic_user2;

alter statistics alt_stat2 owner to regress_alter_generic_user3;

alter statistics alt_stat2 set schema alt_nsp2;

set session authorization regress_alter_generic_user2;

create table alt_regress_2 (
  a int,
  b int
);

create statistics alt_stat1 on "a", "b" from alt_regress_2;

create statistics alt_stat2 on "a", "b" from alt_regress_2;

alter statistics alt_stat3 rename to alt_stat4;

alter statistics alt_stat1 rename to alt_stat4;

alter statistics alt_stat3 owner to regress_alter_generic_user2;

alter statistics alt_stat2 owner to regress_alter_generic_user3;

alter statistics alt_stat3 set schema alt_nsp2;

alter statistics alt_stat2 set schema alt_nsp2;

reset session_authorization;

select
  nspname,
  stxname,
  rolname
from
  pg_statistic_ext as s,
  pg_namespace as n,
  pg_authid as a
where
  s.stxnamespace = n.oid and
  s.stxowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  stxname;

set session authorization regress_alter_generic_user1;

create text search dictionary alt_ts_dict1 (template = simple);

create text search dictionary alt_ts_dict2 (template = simple);

alter text search dictionary alt_ts_dict1 rename to alt_ts_dict2;

alter text search dictionary alt_ts_dict1 rename to alt_ts_dict3;

alter text search dictionary alt_ts_dict2 owner to regress_alter_generic_user2;

alter text search dictionary alt_ts_dict2 owner to regress_alter_generic_user3;

alter text search dictionary alt_ts_dict2 set schema alt_nsp2;

set session authorization regress_alter_generic_user2;

create text search dictionary alt_ts_dict1 (template = simple);

create text search dictionary alt_ts_dict2 (template = simple);

alter text search dictionary alt_ts_dict3 rename to alt_ts_dict4;

alter text search dictionary alt_ts_dict1 rename to alt_ts_dict4;

alter text search dictionary alt_ts_dict3 owner to regress_alter_generic_user2;

alter text search dictionary alt_ts_dict2 owner to regress_alter_generic_user3;

alter text search dictionary alt_ts_dict3 set schema alt_nsp2;

alter text search dictionary alt_ts_dict2 set schema alt_nsp2;

reset session_authorization;

select
  nspname,
  dictname,
  rolname
from
  pg_ts_dict as t,
  pg_namespace as n,
  pg_authid as a
where
  t.dictnamespace = n.oid and
  t.dictowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  dictname;

set session authorization regress_alter_generic_user1;

create text search configuration alt_ts_conf1 (copy = english);

create text search configuration alt_ts_conf2 (copy = english);

alter text search configuration alt_ts_conf1 rename to alt_ts_conf2;

alter text search configuration alt_ts_conf1 rename to alt_ts_conf3;

alter text search configuration alt_ts_conf2 owner to regress_alter_generic_user2;

alter text search configuration alt_ts_conf2 owner to regress_alter_generic_user3;

alter text search configuration alt_ts_conf2 set schema alt_nsp2;

set session authorization regress_alter_generic_user2;

create text search configuration alt_ts_conf1 (copy = english);

create text search configuration alt_ts_conf2 (copy = english);

alter text search configuration alt_ts_conf3 rename to alt_ts_conf4;

alter text search configuration alt_ts_conf1 rename to alt_ts_conf4;

alter text search configuration alt_ts_conf3 owner to regress_alter_generic_user2;

alter text search configuration alt_ts_conf2 owner to regress_alter_generic_user3;

alter text search configuration alt_ts_conf3 set schema alt_nsp2;

alter text search configuration alt_ts_conf2 set schema alt_nsp2;

reset session_authorization;

select
  nspname,
  cfgname,
  rolname
from
  pg_ts_config as t,
  pg_namespace as n,
  pg_authid as a
where
  t.cfgnamespace = n.oid and
  t.cfgowner = a.oid and
  n.nspname in ('alt_nsp1', 'alt_nsp2')
order by nspname,
  cfgname;

create text search template alt_ts_temp1 (lexize = dsimple_lexize);

create text search template alt_ts_temp2 (lexize = dsimple_lexize);

alter text search template alt_ts_temp1 rename to alt_ts_temp2;

alter text search template alt_ts_temp1 rename to alt_ts_temp3;

alter text search template alt_ts_temp2 set schema alt_nsp2;

create text search template alt_ts_temp2 (lexize = dsimple_lexize);

alter text search template alt_ts_temp2 set schema alt_nsp2;

create text search template tstemp_case ("Init" = init_function);

select
  nspname,
  tmplname
from
  pg_ts_template as t,
  pg_namespace as n
where
  t.tmplnamespace = n.oid and
  nspname like 'alt_nsp%'
order by nspname,
  tmplname;

create text search parser alt_ts_prs1 (
  start = prsd_start,
  gettoken = prsd_nexttoken,
  "end" = prsd_end,
  lextypes = prsd_lextype
);

create text search parser alt_ts_prs2 (
  start = prsd_start,
  gettoken = prsd_nexttoken,
  "end" = prsd_end,
  lextypes = prsd_lextype
);

alter text search parser alt_ts_prs1 rename to alt_ts_prs2;

alter text search parser alt_ts_prs1 rename to alt_ts_prs3;

alter text search parser alt_ts_prs2 set schema alt_nsp2;

create text search parser alt_ts_prs2 (
  start = prsd_start,
  gettoken = prsd_nexttoken,
  "end" = prsd_end,
  lextypes = prsd_lextype
);

alter text search parser alt_ts_prs2 set schema alt_nsp2;

create text search parser tspars_case ("Start" = start_function);

select
  nspname,
  prsname
from
  pg_ts_parser as t,
  pg_namespace as n
where
  t.prsnamespace = n.oid and nspname like 'alt_nsp%'
order by nspname,
  prsname;

drop foreign data wrapper alt_fdw2 cascade;

drop foreign data wrapper alt_fdw3 cascade;

drop language alt_lang2 cascade;

drop language alt_lang3 cascade;

drop schema alt_nsp1 cascade;

drop schema alt_nsp2 cascade;

drop role regress_alter_generic_user1;

drop role regress_alter_generic_user2;

drop role regress_alter_generic_user3;
