---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/amutils.sql
snapshot_kind: text
---
select
  prop,
  pg_indexam_has_property(a.oid, prop)
  as "AM",
  pg_index_has_property(
    cast('onek_hundred' as regclass),
    prop
  )
  as "Index",
  pg_index_column_has_property(
    cast('onek_hundred' as regclass),
    1,
    prop
  )
  as "Column"
from
  pg_am as a,
  unnest(
    cast(array['asc',
    'desc',
    'nulls_first',
    'nulls_last',
    'orderable',
    'distance_orderable',
    'returnable',
    'search_array',
    'search_nulls',
    'clusterable',
    'index_scan',
    'bitmap_scan',
    'backward_scan',
    'can_order',
    'can_unique',
    'can_multi_col',
    'can_exclude',
    'can_include',
    'bogus']
    as text[])
  )
  with ordinality
  as u (prop, ord)
where
  a.amname = 'btree'
order by ord;

select
  prop,
  pg_indexam_has_property(a.oid, prop)
  as "AM",
  pg_index_has_property(
    cast('gcircleind' as regclass),
    prop
  )
  as "Index",
  pg_index_column_has_property(
    cast('gcircleind' as regclass),
    1,
    prop
  )
  as "Column"
from
  pg_am as a,
  unnest(
    cast(array['asc',
    'desc',
    'nulls_first',
    'nulls_last',
    'orderable',
    'distance_orderable',
    'returnable',
    'search_array',
    'search_nulls',
    'clusterable',
    'index_scan',
    'bitmap_scan',
    'backward_scan',
    'can_order',
    'can_unique',
    'can_multi_col',
    'can_exclude',
    'can_include',
    'bogus']
    as text[])
  )
  with ordinality
  as u (prop, ord)
where
  a.amname = 'gist'
order by ord;

select
  prop,
  pg_index_column_has_property(
    cast('onek_hundred' as regclass),
    1,
    prop
  )
  as btree,
  pg_index_column_has_property(
    cast('hash_i4_index' as regclass),
    1,
    prop
  )
  as hash,
  pg_index_column_has_property(
    cast('gcircleind' as regclass),
    1,
    prop
  )
  as gist,
  pg_index_column_has_property(
    cast('sp_radix_ind' as regclass),
    1,
    prop
  )
  as spgist_radix,
  pg_index_column_has_property(
    cast('sp_quad_ind' as regclass),
    1,
    prop
  )
  as spgist_quad,
  pg_index_column_has_property(
    cast('botharrayidx' as regclass),
    1,
    prop
  )
  as gin,
  pg_index_column_has_property(
    cast('brinidx' as regclass),
    1,
    prop
  )
  as brin
from
  unnest(
    cast(array['asc',
    'desc',
    'nulls_first',
    'nulls_last',
    'orderable',
    'distance_orderable',
    'returnable',
    'search_array',
    'search_nulls',
    'bogus']
    as text[])
  )
  with ordinality
  as u (prop, ord)
order by ord;

select
  prop,
  pg_index_has_property(
    cast('onek_hundred' as regclass),
    prop
  )
  as btree,
  pg_index_has_property(
    cast('hash_i4_index' as regclass),
    prop
  )
  as hash,
  pg_index_has_property(
    cast('gcircleind' as regclass),
    prop
  )
  as gist,
  pg_index_has_property(
    cast('sp_radix_ind' as regclass),
    prop
  )
  as spgist,
  pg_index_has_property(
    cast('botharrayidx' as regclass),
    prop
  )
  as gin,
  pg_index_has_property(
    cast('brinidx' as regclass),
    prop
  )
  as brin
from
  unnest(
    cast(array['clusterable',
    'index_scan',
    'bitmap_scan',
    'backward_scan',
    'bogus']
    as text[])
  )
  with ordinality
  as u (prop, ord)
order by ord;

select
  amname,
  prop,
  pg_indexam_has_property(a.oid, prop)
  as p
from
  pg_am as a,
  unnest(
    cast(array['can_order',
    'can_unique',
    'can_multi_col',
    'can_exclude',
    'can_include',
    'bogus']
    as text[])
  )
  with ordinality
  as u (prop, ord)
where
  amtype = 'i'
order by amname,
  ord;

create temporary table foo (
  f1 int,
  f2 int,
  f3 int,
  f4 int
);

create index "fooindex"
on foo
using btree
(
  f1 desc,
  f2 asc,
  f3 nulls first,
  f4 nulls last
);

select
  col,
  prop,
  pg_index_column_has_property(
    o,
    col,
    prop
  )
from
  (
    values (cast('fooindex' as regclass))
  )
  as v1 (o),
  (
    values
      (1, 'orderable'),
      (2, 'asc'),
      (3, 'desc'),
      (4, 'nulls_first'),
      (5, 'nulls_last'),
      (6, 'bogus')
  )
  as v2 (idx, prop),
  generate_series(1, 4) as col
order by col,
  idx;

create index "foocover" on foo using btree (f1) include (f2, f3);

select
  col,
  prop,
  pg_index_column_has_property(
    o,
    col,
    prop
  )
from
  (
    values (cast('foocover' as regclass))
  )
  as v1 (o),
  (
    values
      (1, 'orderable'),
      (2, 'asc'),
      (3, 'desc'),
      (4, 'nulls_first'),
      (5, 'nulls_last'),
      (6, 'distance_orderable'),
      (7, 'returnable'),
      (8, 'bogus')
  )
  as v2 (idx, prop),
  generate_series(1, 3) as col
order by col,
  idx;
