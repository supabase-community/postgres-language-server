---
source: crates/pgls_pretty_print/tests/tests.rs
input_file: crates/pgls_pretty_print/tests/data/multi/tablesample.sql
snapshot_kind: text
---
create table test_tablesample (
  id INT,
  name TEXT
)
with (fillfactor = 10);

insert into test_tablesample
select
  i,
  repeat(cast(i as TEXT), 200)
from
  generate_series(0, 9) as s (i);

select t.id from test_tablesample as t TABLESAMPLE system (50) REPEATABLE (0);

select id from test_tablesample TABLESAMPLE system (100.0 / 11) REPEATABLE (0);

select id from test_tablesample TABLESAMPLE system (50) REPEATABLE (0);

select id from test_tablesample TABLESAMPLE bernoulli (50) REPEATABLE (0);

select id from test_tablesample TABLESAMPLE bernoulli (5.5) REPEATABLE (0);

select COUNT(*) from test_tablesample TABLESAMPLE system (100);

select COUNT(*) from test_tablesample TABLESAMPLE system (100) REPEATABLE (1 + 2);

select COUNT(*) from test_tablesample TABLESAMPLE system (100) REPEATABLE (0.4);

create view test_tablesample_v1
as select
  id
from
  test_tablesample
  TABLESAMPLE system (10 * 2)
  REPEATABLE (2);

create view test_tablesample_v2
as select
  id
from
  test_tablesample TABLESAMPLE system (99);

begin;

declare "tablesample_cur" SCROLL
cursor
for select
  id
from
  test_tablesample
  TABLESAMPLE system (50)
  REPEATABLE (0);;

fetch ABSOLUTE 1 from tablesample_cur;

fetch next from tablesample_cur;

fetch next from tablesample_cur;

select id from test_tablesample TABLESAMPLE system (50) REPEATABLE (0);

fetch next from tablesample_cur;

fetch next from tablesample_cur;

fetch next from tablesample_cur;

fetch ABSOLUTE 1 from tablesample_cur;

fetch next from tablesample_cur;

fetch next from tablesample_cur;

fetch next from tablesample_cur;

fetch next from tablesample_cur;

fetch next from tablesample_cur;

close tablesample_cur;

commit;

select id from test_tablesample TABLESAMPLE system (50) REPEATABLE (2);

select * from test_tablesample_v1;

select COUNT(*) from person TABLESAMPLE bernoulli (100);

select COUNT(*) from person TABLESAMPLE bernoulli (100);

select COUNT(*) from person;

select
  COUNT(*)
from
  test_tablesample
  TABLESAMPLE bernoulli (cast(cast('1' as TEXT) < cast('0' as TEXT) as INT));

select
  *
from
  (values (0), (100)) as v (pct),
  lateral (
    select
      COUNT(*)
    from
      tenk1 TABLESAMPLE bernoulli (pct)
  )
  as ss;

select
  *
from
  (values (0), (100)) as v (pct),
  lateral (
    select
      COUNT(*)
    from
      tenk1 TABLESAMPLE system (pct)
  )
  as ss;

select
  pct,
  COUNT(unique1)
from
  (values (0), (100)) as v (pct),
  lateral (
    select * from tenk1 TABLESAMPLE bernoulli (pct)
  )
  as ss
group by pct;

select
  pct,
  COUNT(unique1)
from
  (values (0), (100)) as v (pct),
  lateral (
    select * from tenk1 TABLESAMPLE bernoulli (pct)
  )
  as ss
group by pct;

select
  pct,
  COUNT(unique1)
from
  (values (0), (100)) as v (pct),
  lateral (
    select * from tenk1 TABLESAMPLE system (pct)
  )
  as ss
group by pct;

select id from test_tablesample TABLESAMPLE foobar (1);

select id from test_tablesample TABLESAMPLE system (null);

select id from test_tablesample TABLESAMPLE system (50) REPEATABLE (null);

select id from test_tablesample TABLESAMPLE bernoulli (-1);

select id from test_tablesample TABLESAMPLE bernoulli (200);

select id from test_tablesample TABLESAMPLE system (-1);

select id from test_tablesample TABLESAMPLE system (200);

select id from test_tablesample_v1 TABLESAMPLE bernoulli (1);

insert into test_tablesample_v1 values (1);

with
query_select as (select * from test_tablesample)
select
  *
from
  query_select
  TABLESAMPLE bernoulli (5.5)
  REPEATABLE (1);

create table parted_sample (a INT)
partition by LIST(a);

create table parted_sample_1 partition of parted_sample for values in (1);

create table parted_sample_2 partition of parted_sample for values in (2);

select * from parted_sample TABLESAMPLE bernoulli (100);

drop TABLE "parted_sample", "parted_sample_1", "parted_sample_2";
