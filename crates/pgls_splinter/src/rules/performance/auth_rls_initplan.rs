//! Generated file, do not edit by hand, see `xtask/codegen`

#![doc = r" Generated file, do not edit by hand, see `xtask/codegen`"]
use crate::rule::SplinterRule;
::pgls_analyse::declare_rule! { # [doc = "/// # Auth RLS Initialization Plan\n///\n/// Detects if calls to \\`current_setting()\\` and \\`auth.<function>()\\` in RLS policies are being unnecessarily re-evaluated for each row\n/// \n/// **Note:** This rule requires Supabase roles (`anon`, `authenticated`, `service_role`). \n/// It will be automatically skipped if these roles don't exist in your database.\n///\n/// ## SQL Query\n///\n/// ```sql\n/// (\n/// with policies as (\n///     select\n///         nsp.nspname as schema_name,\n///         pb.tablename as table_name,\n///         pc.relrowsecurity as is_rls_active,\n///         polname as policy_name,\n///         polpermissive as is_permissive, -- if not, then restrictive\n///         (select array_agg(r::regrole) from unnest(polroles) as x(r)) as roles,\n///         case polcmd\n///             when 'r' then 'SELECT'\n///             when 'a' then 'INSERT'\n///             when 'w' then 'UPDATE'\n///             when 'd' then 'DELETE'\n///             when '*' then 'ALL'\n///         end as command,\n///         qual,\n///         with_check\n///     from\n///         pg_catalog.pg_policy pa\n///         join pg_catalog.pg_class pc\n///             on pa.polrelid = pc.oid\n///         join pg_catalog.pg_namespace nsp\n///             on pc.relnamespace = nsp.oid\n///         join pg_catalog.pg_policies pb\n///             on pc.relname = pb.tablename\n///             and nsp.nspname = pb.schemaname\n///             and pa.polname = pb.policyname\n/// )\n/// select\n///     'auth_rls_initplan' as \"name!\",\n///     'Auth RLS Initialization Plan' as \"title!\",\n///     'WARN' as \"level!\",\n///     'EXTERNAL' as \"facing!\",\n///     array['PERFORMANCE'] as \"categories!\",\n///     'Detects if calls to \\`current_setting()\\` and \\`auth.<function>()\\` in RLS policies are being unnecessarily re-evaluated for each row' as \"description!\",\n///     format(\n///         'Table \\`%s.%s\\` has a row level security policy \\`%s\\` that re-evaluates current_setting() or auth.<function>() for each row. This produces suboptimal query performance at scale. Resolve the issue by replacing \\`auth.<function>()\\` with \\`(select auth.<function>())\\`. See [docs](https://supabase.com/docs/guides/database/postgres/row-level-security#call-functions-with-select) for more info.',\n///         schema_name,\n///         table_name,\n///         policy_name\n///     ) as \"detail!\",\n///     'https://supabase.com/docs/guides/database/database-linter?lint=0003_auth_rls_initplan' as \"remediation!\",\n///     jsonb_build_object(\n///         'schema', schema_name,\n///         'name', table_name,\n///         'type', 'table'\n///     ) as \"metadata!\",\n///     format('auth_rls_init_plan_%s_%s_%s', schema_name, table_name, policy_name) as \"cache_key!\"\n/// from\n///     policies\n/// where\n///     is_rls_active\n///     -- NOTE: does not include realtime in support of monitoring policies on realtime.messages\n///     and schema_name not in (\n///         '_timescaledb_cache', '_timescaledb_catalog', '_timescaledb_config', '_timescaledb_internal', 'auth', 'cron', 'extensions', 'graphql', 'graphql_public', 'information_schema', 'net', 'pgmq', 'pgroonga', 'pgsodium', 'pgsodium_masks', 'pgtle', 'pgbouncer', 'pg_catalog', 'pgtle', 'repack', 'storage', 'supabase_functions', 'supabase_migrations', 'tiger', 'topology', 'vault'\n///     )\n///     and (\n///         -- Example: auth.uid()\n///         (\n///             qual like '%auth.uid()%'\n///             and lower(qual) not like '%select auth.uid()%'\n///         )\n///         or (\n///             qual like '%auth.jwt()%'\n///             and lower(qual) not like '%select auth.jwt()%'\n///         )\n///         or (\n///             qual like '%auth.role()%'\n///             and lower(qual) not like '%select auth.role()%'\n///         )\n///         or (\n///             qual like '%auth.email()%'\n///             and lower(qual) not like '%select auth.email()%'\n///         )\n///         or (\n///             qual like '%current\\_setting(%)%'\n///             and lower(qual) not like '%select current\\_setting(%)%'\n///         )\n///         or (\n///             with_check like '%auth.uid()%'\n///             and lower(with_check) not like '%select auth.uid()%'\n///         )\n///         or (\n///             with_check like '%auth.jwt()%'\n///             and lower(with_check) not like '%select auth.jwt()%'\n///         )\n///         or (\n///             with_check like '%auth.role()%'\n///             and lower(with_check) not like '%select auth.role()%'\n///         )\n///         or (\n///             with_check like '%auth.email()%'\n///             and lower(with_check) not like '%select auth.email()%'\n///         )\n///         or (\n///             with_check like '%current\\_setting(%)%'\n///             and lower(with_check) not like '%select current\\_setting(%)%'\n///         )\n///     ))\n/// ```\n///\n/// ## Configuration\n///\n/// Enable or disable this rule in your configuration:\n///\n/// ```json\n/// {\n///   \"splinter\": {\n///     \"rules\": {\n///       \"performance\": {\n///         \"authRlsInitplan\": \"warn\"\n///       }\n///     }\n///   }\n/// }\n/// ```\n///\n/// ## Remediation\n///\n/// See: <https://supabase.com/docs/guides/database/database-linter?lint=0003_auth_rls_initplan>"] pub AuthRlsInitplan { version : "1.0.0" , name : "authRlsInitplan" , severity : pgls_diagnostics :: Severity :: Warning , } }
impl SplinterRule for AuthRlsInitplan {
    const SQL_FILE_PATH: &'static str = "performance/auth_rls_initplan.sql";
    const DESCRIPTION: &'static str = "Detects if calls to \\`current_setting()\\` and \\`auth.<function>()\\` in RLS policies are being unnecessarily re-evaluated for each row";
    const REMEDIATION: &'static str =
        "https://supabase.com/docs/guides/database/database-linter?lint=0003_auth_rls_initplan";
    const REQUIRES_SUPABASE: bool = true;
}
