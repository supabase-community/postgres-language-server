//! Generated file, do not edit by hand, see `xtask/codegen`

#![doc = r" Generated file, do not edit by hand, see `xtask/codegen`"]
use crate::rule::SplinterRule;
::pgls_analyse::declare_rule! { # [doc = "# Sensitive Columns Exposed\n\nDetects tables exposed via API that contain columns with potentially sensitive data (PII, credentials, financial info) without RLS protection.\n\n**Note:** This rule requires Supabase roles (`anon`, `authenticated`, `service_role`). It will be automatically skipped if these roles don't exist in your database.\n\n## SQL Query\n\n```sql\n(\nwith sensitive_patterns as (\n    select unnest(array[\n        -- Authentication & Credentials\n        'password', 'passwd', 'pwd', 'passphrase',\n        'secret', 'secret_key', 'private_key', 'api_key', 'apikey',\n        'auth_key', 'token', 'jwt', 'access_token', 'refresh_token',\n        'oauth_token', 'session_token', 'bearer_token', 'auth_code',\n        'session_id', 'session_key', 'session_secret',\n        'recovery_code', 'backup_code', 'verification_code',\n        'otp', 'two_factor', '2fa_secret', '2fa_code',\n        -- Personal Identifiers\n        'ssn', 'social_security', 'social_security_number',\n        'driver_license', 'drivers_license', 'license_number',\n        'passport_number', 'passport_id', 'national_id', 'tax_id',\n        -- Financial Information\n        'credit_card', 'card_number', 'cvv', 'cvc', 'cvn',\n        'bank_account', 'account_number', 'routing_number',\n        'iban', 'swift_code', 'bic',\n        -- Health & Medical\n        'health_record', 'medical_record', 'patient_id',\n        'insurance_number', 'health_insurance', 'medical_insurance',\n        'treatment',\n        -- Device Identifiers\n        'mac_address', 'macaddr', 'imei', 'device_uuid',\n        -- Digital Keys & Certificates\n        'pgp_key', 'gpg_key', 'ssh_key', 'certificate',\n        'license_key', 'activation_key',\n        -- Biometric Data\n        'facial_recognition'\n    ]) as pattern\n),\nexposed_tables as (\n    select\n        n.nspname as schema_name,\n        c.relname as table_name,\n        c.oid as table_oid\n    from\n        pg_catalog.pg_class c\n        join pg_catalog.pg_namespace n\n            on c.relnamespace = n.oid\n    where\n        c.relkind = 'r' -- regular tables\n        and (\n            pg_catalog.has_table_privilege('anon', c.oid, 'SELECT')\n            or pg_catalog.has_table_privilege('authenticated', c.oid, 'SELECT')\n        )\n        and n.nspname = any(array(select trim(unnest(string_to_array(current_setting('pgrst.db_schemas', 't'), ',')))))\n        and n.nspname not in (\n            '_timescaledb_cache', '_timescaledb_catalog', '_timescaledb_config', '_timescaledb_internal', 'auth', 'cron', 'extensions', 'graphql', 'graphql_public', 'information_schema', 'net', 'pgmq', 'pgroonga', 'pgsodium', 'pgsodium_masks', 'pgtle', 'pgbouncer', 'pg_catalog', 'pgtle', 'realtime', 'repack', 'storage', 'supabase_functions', 'supabase_migrations', 'tiger', 'topology', 'vault'\n        )\n        -- Only flag tables without RLS enabled\n        and not c.relrowsecurity\n),\nsensitive_columns as (\n    select\n        et.schema_name,\n        et.table_name,\n        a.attname as column_name,\n        sp.pattern as matched_pattern\n    from\n        exposed_tables et\n        join pg_catalog.pg_attribute a\n            on a.attrelid = et.table_oid\n            and a.attnum > 0\n            and not a.attisdropped\n        cross join sensitive_patterns sp\n    where\n        -- Match column name against sensitive patterns (case insensitive), allowing '-'/'_' variants\n        replace(lower(a.attname), '-', '_') = sp.pattern\n)\nselect\n    'sensitive_columns_exposed' as \"name!\",\n    'Sensitive Columns Exposed' as \"title!\",\n    'ERROR' as \"level!\",\n    'EXTERNAL' as \"facing!\",\n    array['SECURITY'] as \"categories!\",\n    'Detects tables exposed via API that contain columns with potentially sensitive data (PII, credentials, financial info) without RLS protection.' as \"description!\",\n    format(\n        'Table `%s.%s` is exposed via API without RLS and contains potentially sensitive column(s): %s. This may lead to data exposure.',\n        schema_name,\n        table_name,\n        string_agg(distinct column_name, ', ' order by column_name)\n    ) as \"detail!\",\n    'https://supabase.com/docs/guides/database/database-linter?lint=0023_sensitive_columns_exposed' as \"remediation!\",\n    jsonb_build_object(\n        'schema', schema_name,\n        'name', table_name,\n        'type', 'table',\n        'sensitive_columns', array_agg(distinct column_name order by column_name),\n        'matched_patterns', array_agg(distinct matched_pattern order by matched_pattern)\n    ) as \"metadata!\",\n    format(\n        'sensitive_columns_exposed_%s_%s',\n        schema_name,\n        table_name\n    ) as \"cache_key!\"\nfrom\n    sensitive_columns\ngroup by\n    schema_name,\n    table_name\norder by\n    schema_name,\n    table_name)\n```\n\n## Configuration\n\nEnable or disable this rule in your configuration:\n\n```json\n{\n  \"splinter\": {\n    \"rules\": {\n      \"security\": {\n        \"sensitiveColumnsExposed\": \"warn\"\n      }\n    }\n  }\n}\n```\n\n## Remediation\n\nSee: <https://supabase.com/docs/guides/database/database-linter?lint=0023_sensitive_columns_exposed>"] pub SensitiveColumnsExposed { version : "1.0.0" , name : "sensitiveColumnsExposed" , severity : pgls_diagnostics :: Severity :: Error , recommended : true , } }
impl SplinterRule for SensitiveColumnsExposed {
    const SQL_FILE_PATH: &'static str = "security/sensitive_columns_exposed.sql";
    const DESCRIPTION: &'static str = "Detects tables exposed via API that contain columns with potentially sensitive data (PII, credentials, financial info) without RLS protection.";
    const REMEDIATION: &'static str = "https://supabase.com/docs/guides/database/database-linter?lint=0023_sensitive_columns_exposed";
    const REQUIRES_SUPABASE: bool = true;
}
